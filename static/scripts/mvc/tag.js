define(["mvc/base-mvc","utils/localization"],function(a,b){var c=Backbone.View.extend(a.LoggableMixin).extend(a.HiddenUntilActivatedViewMixin).extend({tagName:"div",className:"tags-display",select_width:"100%",events:{},initialize:function(a){this.show_editor=!1,this.label=a.usePrompt===!1?"":'<label class="prompt">'+b("Tags")+"</label>",this.workflow_mode=a.workflow_mode||!1,this.workflow_mode&&(this.events.click="showEditor",this.events.keydown="keydownHandler"),this.hiddenUntilActivated(a.$activator,a)},render:function(){var a=this;return this.$el.html(this.workflow_mode?this._workflowTemplate():this._defaultTemplate()),this.$input().select2({placeholder:"Add tags",width:this.workflow_mode?this.width:this.select_width,tags:function(){return a._getTagsUsed()}}),this._setUpBehaviors(),this},_hashToName:function(a){return a.startsWith("#")?"name:"+a.slice(1):a},_nameToHash:function(a){return a.startsWith("name:")&&(a="#"+a.slice(5)),a},_defaultTemplate:function(){return[this.label,this._renderEditor()].join("")},_workflowTemplate:function(){return[this.show_editor?this._renderEditor():this._renderTags()].join(" ")},keydownHandler:function(a){switch(a.which){case 27:this.hideEditor()}},showEditor:function(){this.show_editor=!0,this.render()},hideEditor:function(){this.show_editor=!1,this.render()},_renderEditor:function(){return'<input class="tags-input" value="'+this.tagsToCSV()+'"/>'},_renderTags:function(){var a=this.model.get("tags"),b="static/images/fugue/tag--plus.png",c=[];return _.each(a,function(a){a=0==a.indexOf("name:")?a.slice(5):a;var b='<span class="label label-info">'+a+"</span>";c.push(b)}),0===c.length&&c.push("<img src="+b+' class="add-tag-button" title="Add tags"/>'),c.join(" ")},tagsToCSV:function(){var a=this,b=this.model.get("tags");return!_.isArray(b)||_.isEmpty(b)?"":b.map(function(b){return _.escape(a._nameToHash(b))}).sort().join(",")},$input:function(){return this.$el.find("input.tags-input")},_getTagsUsed:function(){var a=this;return _.map(Galaxy.user.get("tags_used"),a._nameToHash)},_setUpBehaviors:function(){var a=this;this.$input().on("change",function(b){b.val=_.map(b.val,a._hashToName),a.model.save({tags:b.val}),b.added&&a._addNewTagToTagsUsed(b.added.text+"")})},_addNewTagToTagsUsed:function(a){var b=Galaxy.user.get("tags_used");_.contains(b,a)||(b.push(a),b.sort(),Galaxy.user.set("tags_used",b))},remove:function(){this.$input.off(),this.stopListening(this.model),Backbone.View.prototype.remove.call(this)},toString:function(){return["TagsEditor(",this.model+"",")"].join("")}});return{TagsEditor:c}});
//# sourceMappingURL=../../maps/mvc/tag.js.map