define(["mvc/ui/ui-modal","mvc/ui/error-modal","utils/localization"],function(a,b,c){"use strict";var d={defaultName:_.template("Copy of '<%- name %>'"),title:_.template(c("Copying history")+' "<%- name %>"'),submitLabel:c("Copy"),errorMessage:c("History could not be copied."),progressive:c("Copying history"),activeLabel:c("Copy only the active, non-deleted datasets"),allLabel:c("Copy all datasets including deleted ones"),anonWarning:c("As an anonymous user, unless you login or register, you will lose your current history ")+c("after copying this history. "),_template:_.template(["<% if( isAnon ){ %>",'<div class="warningmessage">',"<%- anonWarning %>",c("You can"),' <a href="/user/login">',c("login here"),"</a> ",c("or")," ",' <a href="/user/create">',c("register here"),"</a>.","</div>","<% } %>","<form>",'<label for="copy-modal-title">',c("Enter a title for the new history"),":","</label><br />",'<input id="copy-modal-title" class="form-control" style="width: 100%" value="<%= name %>" />','<p class="invalid-title bg-danger" style="color: red; margin: 8px 0px 8px 0px; display: none">',c("Please enter a valid history title"),"</p>","<% if( allowAll ){ %>","<br />","<p>",c("Choose which datasets from the original history to include:"),"</p>",'<input name="copy-what" type="radio" id="copy-non-deleted" value="copy-non-deleted" ','<% if( copyWhat === "copy-non-deleted" ){ print( "checked" ); } %>/>','<label for="copy-non-deleted"> <%- activeLabel %></label>',"<br />",'<input name="copy-what" type="radio" id="copy-all" value="copy-all" ','<% if( copyWhat === "copy-all" ){ print( "checked" ); } %>/>','<label for="copy-all"> <%- allLabel %></label>',"<% } %>","</form>"].join("")),_showAjaxIndicator:function(){var a='<p><span class="fa fa-spinner fa-spin"></span> '+this.progressive+"...</p>";this.modal.$(".modal-body").empty().append(a).css({"margin-top":"8px"})},dialog:function(a,d,e){function f(){var c=a.$("#copy-modal-title").val();if(!c)return void a.$(".invalid-title").show();var e="copy-all"===a.$('input[name="copy-what"]:checked').val();a.$("button").prop("disabled",!0),g._showAjaxIndicator(),d.copy(!0,c,e).done(function(a){h.resolve(a)}).fail(function(a){var f={name:c,copyAllDatasets:e};b.ajaxErrorModal(d,a,f,g.errorMessage),h.rejectWith(h,arguments)}).done(function(){m&&a.hide()})}e=e||{};var g=this,h=jQuery.Deferred(),i=e.nameFn||this.defaultName,j=i({name:d.get("name")}),k=e.allDatasets?"copy-all":"copy-non-deleted",l=_.isUndefined(e.allowAll)?!0:e.allowAll,m=_.isUndefined(e.autoClose)?!0:e.autoClose;this.modal=a;var n=e.closing_callback;return a.show(_.extend(e,{title:this.title({name:d.get("name")}),body:$(g._template({name:j,isAnon:Galaxy.user.isAnonymous(),allowAll:l,copyWhat:k,activeLabel:this.activeLabel,allLabel:this.allLabel,anonWarning:this.anonWarning})),buttons:_.object([[c("Cancel"),function(){a.hide()}],[this.submitLabel,f]]),height:"auto",closing_events:!0,closing_callback:function(a){a&&h.reject({cancelled:!0}),n&&n(a)}})),a.$("#copy-modal-title").focus().select(),a.$("#copy-modal-title").on("keydown",function(a){13===a.keyCode&&(a.preventDefault(),f())}),h}},e=_.extend({},d,{defaultName:_.template("imported: <%- name %>"),title:_.template(c("Importing history")+' "<%- name %>"'),submitLabel:c("Import"),errorMessage:c("History could not be imported."),progressive:c("Importing history"),activeLabel:c("Import only the active, non-deleted datasets"),allLabel:c("Import all datasets including deleted ones"),anonWarning:c("As an anonymous user, unless you login or register, you will lose your current history ")+c("after importing this history. ")}),f=function(b,c){c=c||{};var f=window.parent.Galaxy.modal||new a.View({});return c.useImport?e.dialog(f,b,c):d.dialog(f,b,c)};return f});
//# sourceMappingURL=../../../maps/mvc/history/copy-dialog.js.map