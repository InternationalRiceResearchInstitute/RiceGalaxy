define([],function(){var a=Backbone.View.extend({original_email:"",original_username:"",user_id:"",address_id:"",initialize:function(a){this.initializeSection(a)},initializeSection:function(a){this.render(this,a),this.user_id=a.user_id,this.original_email=a.email,this.original_username=a.username},validateString:function(a,b){var c=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,d=/^[a-z0-9\-]{3,255}$/;return"email"===b?c.test(a):"username"===b?d.test(a):void 0},renderError:function(a){var b=$(".validate.errormessage");$(".donemessage").hide(),1===b.length?(b.html(a),b.show()):$(".user-preferences-all").prepend("<div class='validate errormessage'>"+a+"</div>")},renderDone:function(a){var b=$(".donemessage");$(".validate.errormessage").hide(),1===b.length?(b.html(a),b.show()):$(".user-preferences-all").prepend("<div class='donemessage'>"+a+"</div>")},saveUserData:function(a,b){var c="Please enter your valid email address.",d="Email cannot be more than 255 characters in length.",e='Public name must contain only lowercase letters, numbers and "-". It also has to be shorter than 255 characters but longer than 2.',f=$("#email_input").val(),g=$("#name_input").val(),h=!0,i=a.original_email===f&&a.original_username===g,j='<input type="hidden" id="login_info_button" name="login_info_button" value="Submit"/>',k="";$("#send").attr("disabled","disabled"),$("#email_input").before(j),a.original_email!==f&&(f.length>255?(a.renderError(d),h=!1):a.validateString(f,"email")||(a.renderError(c),h=!1)),a.original_username!==g&&(g&&!a.validateString(g,"username")||g.length<3)&&(a.renderError(e),h=!1),i&&a.renderDone("Nothing has changed."),(!h||i)&&(b.preventDefault(),$("#send").removeAttr("disabled")),!i&&h&&(k=Galaxy.root+"api/user_preferences/edit_info/",data={id:a.user_id,email:f,username:g,button_name:b.target.attributes.name.nodeValue},$.getJSON(k,data,function(b){$(".manage-userinfo-section").remove(),$(".donemessage").remove(),$(".validate.errormessage").remove(),a.render(a,b),a.original_email=f,a.original_username=g},"json"))},renderMessage:function(a,b){return'<div class="'+(""===b?"done":b)+"message"+("error"===b?" validate":"")+'">'+a+"</div>"},render:function(a,b){var c="",d=["Active","Deleted","All"];if($(".manage-userinfo-section").remove(),$(".donemessage").remove(),$(".validate.errormessage").remove(),b.message.length>0&&(c=a.renderMessage(b.message,b.status)),c+='<div class="manage-userinfo-section"> <h2>Manage User Information</h2>',Galaxy.user.attributes.is_admin||(c+='<ul class="manage-table-actions"><li><a class="action-button back-user-pref" target="galaxy_main">User preferences</a></li></ul>'),c=c+'<div class="toolForm"><form name="login_info" id="login_info"><div class="toolFormTitle">Login Information</div><div class="form-row"><label>Email address:</label><input type="text" id ="email_input" name="email" value="'+b.email+'" size="40"/><div class="toolParamHelp" style="clear: both;">If you change your email address you will receive an activation link in the new mailbox and you have to activate your account by visiting it.</div></div><div class="form-row"><label>Public name:</label>',c="tool_shed"===b.webapp?b.active_repositories?c+'<input type="hidden" id="name_input" name="username" value="'+b.username+'"/>'+b.username+'<div class="toolParamHelp" style="clear: both;">You cannot change your public name after you have created a repository in this tool shed.</div>':c+'<input type="text" id="name_input" name="username" size="40" value="'+b.username+'"/><div class="toolParamHelp" style="clear: both;">Your public name provides a means of identifying you publicly within this tool shed. Public names must be at least three characters in length and contain only lower-case letters, numbers, and the "-" character.  You cannot change your public name after you have created a repository in this tool shed.</div>':c+'<input type="text" id="name_input" name="username" size="40" value="'+b.username+'"/><div class="toolParamHelp" style="clear: both;">Your public name is an identifier that will be used to generate addresses for information you share publicly. Public names must be at least three characters in length and contain only lower-case letters, numbers, and the "-" character.</div>',c+="</div>",c+='<div class="form-row"><input type="button" class="save-userdata action-button" name="login_info_button" value="Save"/></div></form></div>',b.values||b.user_info_forms.length>0){if(c+='<p></p><div class="toolForm"><form name="user_info" id="user_info"><div class="toolFormTitle">User information</div>',c=b.user_type_fd_id_select_field_options.length>0?c+'<div class="form-row"><label>User type:</label>'+b.user_type_fd_id_select_html+"</div>":c+'<input type="hidden" name="user_type_fd_id" value="'+b.user_type_fd_id_encoded+'"/>',"object"==typeof b.widgets&&Object.keys(b.widgets).length>0)for(var e in b.widgets){var f=b.widgets[e];c=c+'<div class="form-row"><label>'+f.label+":</label>"+f.html+'<div class="toolParamHelp" style="clear: both;">'+f.helptext+'</div><div style="clear: both"></div></div>'}c+='<div class="form-row"><input type="button" class="save-userdata action-button" name="edit_user_info_button" value="Save"/></div>',c+="</form></div><p></p>"}if(c+='<div class="toolForm"><form name="user_addresses" id="user_addresses"><div class="toolFormTitle">User Addresses</div><div class="toolFormBody">',b.addresses){c+='<div class="form-row"><div class="grid-header">';for(var g=0;g<d.length;g++)g>0&&(c+=" <span> | </span> "),c=b.show_filter===d[g]?c+'<span class="filter"><a class="link-filter" data-id="'+d[g]+'"><b>'+d[g]+"</b></a></span>":c+'<span class="filter"><a class="link-filter" data-id="'+d[g]+'">'+d[g]+"</a></span>";c+="</div></div>",c+='<table class="grid"><tbody>';for(var e in b.addresses){var f=b.addresses[e];c=c+'<tr class="libraryRow libraryOrFolderRow" id="libraryRow"><td><div class="form-row"><label>'+f.desc+":</label>"+f.html+'</div><div class="form-row"><ul class="manage-table-actions"><li>',c=f.deleted?c+'<a class="action-button undelete-address" data-id="'+f.address_id+'">Undelete</a>':c+'<a class="action-button edit-address" data-id="'+f.address_id+'">Edit</a><a class="action-button delete-address" data-id="'+f.address_id+'">Delete</a>',c+="</li></li></ul></div></td></tr>"}c+="</tbody></table>"}c+=' <div class="form-row"><input type="button" class="add-address action-button" value="Add a new address"></div>',c+="</div></form></div>",c+="</div>",$(".user-preferences-all").append(c),$(".back-user-pref").on("click",a.showUserPref),$(".save-userdata").on("click",function(b){a.saveUserData(a,b)}),$(".link-filter").on("click",function(b){a.setAddressFilter(a,b)}),$(".edit-address").on("click",function(b){a.editAddress(a,b)}),$(".delete-address").on("click",function(b){a.deleteAddress(a,b)}),$(".undelete-address").on("click",function(b){a.undeleteAddress(a,b)}),$(".add-address").on("click",function(b){a.addAddress(a,b)})},addAddress:function(a){var b="";b=a.getAddressTemplate(a,null,"Add new address","savenew-address","Save","add-address-section","new_address_button"),$(".user-preferences-all").append(b),$(".manage-userinfo-section").hide(),$(".back-manage-info").on("click",function(b){b.preventDefault(),$(".manage-userinfo-section").show(),$(".add-address-section").remove(),a.hideErrorDoneMessage()}),$(".savenew-address").on("click",function(b){a.saveNewAddress(a,b)})},saveNewAddress:function(a){var b=$("input[name='short_desc']").val(),c=$("input[name='name']").val(),d=$("input[name='institution']").val(),e=$("input[name='address']").val(),f=$("input[name='city']").val(),g=$("input[name='state']").val(),h=$("input[name='postal_code']").val(),i=$("input[name='country']").val(),j=$("input[name='phone']").val(),k={},l=Galaxy.root+"api/user_preferences/new_address/";k={new_address_button:!0,id:a.user_id,short_desc:b,name:c,institution:d,address:e,city:f,state:g,postal_code:h,country:i,phone:j},$.getJSON(l,k,function(b){return"error"===b.status?void a.renderError(b.message):(a.hideErrorDoneMessage(),a.initializeSection(b),a.renderDone(b.message),void $(".add-address-section").remove())})},getAddressTemplate:function(a,b,c,d,e,f,g){var h="",i=null;return b&&(i=b.address_obj,b.message.length>0&&(h=a.renderMessage(b.message,b.status))),h=h+'<div class="'+f+'"> <h3>'+c+'</h3><ul class="manage-table-actions"><li><a class="action-button back-manage-info">Manage user information</a></li></ul>',h=h+'<div class="toolForm"><div class="toolFormTitle">'+c+'</div><div class="toolFormBody"><form name="login_info" id="login_info"><div class="form-row"><label>Short Description:</label><div style="float: left; width: 250px; margin-right: 10px;"><input type="text" name="short_desc" value="'+(i?i.desc:"")+'" size="40"></div><div class="toolParamHelp" style="clear: both;">Required</div><div style="clear: both"></div></div><div class="form-row"><label>Name:</label><div style="float: left; width: 250px; margin-right: 10px;"><input type="text" name="name" value="'+(i?i.name:"")+'" size="40"></div><div class="toolParamHelp" style="clear: both;">Required</div><div style="clear: both"></div></div><div class="form-row"><label>Institution:</label><div style="float: left; width: 250px; margin-right: 10px;"><input type="text" name="institution" value="'+(i?i.institution:"")+'" size="40"></div><div class="toolParamHelp" style="clear: both;">Required</div><div style="clear: both"></div></div><div class="form-row"><label>Address:</label><div style="float: left; width: 250px; margin-right: 10px;"><input type="text" name="address" value="'+(i?i.address:"")+'" size="40"></div><div class="toolParamHelp" style="clear: both;">Required</div><div style="clear: both"></div></div><div class="form-row"><label>City:</label><div style="float: left; width: 250px; margin-right: 10px;"><input type="text" name="city" value="'+(i?i.city:"")+'" size="40"></div><div class="toolParamHelp" style="clear: both;">Required</div><div style="clear: both"></div></div><div class="form-row"><label>State/Province/Region:</label><div style="float: left; width: 250px; margin-right: 10px;"><input type="text" name="state" value="'+(i?i.state:"")+'" size="40"></div><div class="toolParamHelp" style="clear: both;">Required</div><div style="clear: both"></div></div><div class="form-row"><label>Postal Code:</label><div style="float: left; width: 250px; margin-right: 10px;"><input type="text" name="postal_code" value="'+(i?i.postal_code:"")+'" size="40"></div><div class="toolParamHelp" style="clear: both;">Required</div><div style="clear: both"></div></div><div class="form-row"><label>Country:</label><div style="float: left; width: 250px; margin-right: 10px;"><input type="text" name="country" value="'+(i?i.country:"")+'" size="40"></div><div class="toolParamHelp" style="clear: both;">Required</div><div style="clear: both"></div></div><div class="form-row"><label>Phone:</label><div style="float: left; width: 250px; margin-right: 10px;"><input type="text" name="phone" value="'+(i?i.phone:"")+'" size="40"></div><div style="clear: both"></div></div><div class="form-row"><input type="button" class="action-button '+d+'" name="'+g+'" value="'+e+'"></div>',h+="</form></div></div></div>"},renderEditAddress:function(a,b){var c="";$(".edit-address-section").remove(),c=a.getAddressTemplate(a,b,"Edit Address","saveedit-address","Save changes","edit-address-section","edit_address_button"),$(".user-preferences-all").append(c),$(".manage-userinfo-section").hide(),$(".back-manage-info").on("click",function(b){b.preventDefault(),$(".manage-userinfo-section").show(),$(".edit-address-section").remove(),a.hideErrorDoneMessage()}),$(".saveedit-address").on("click",function(b){a.saveEditedAddress(a,b)})},saveEditedAddress:function(a){var b=$("input[name='short_desc']").val(),c=$("input[name='name']").val(),d=$("input[name='institution']").val(),e=$("input[name='address']").val(),f=$("input[name='city']").val(),g=$("input[name='state']").val(),h=$("input[name='postal_code']").val(),i=$("input[name='country']").val(),j=$("input[name='phone']").val(),k={},l=Galaxy.root+"api/user_preferences/edit_address/";k={edit_address_button:!0,id:a.user_id,address_id:a.address_id,short_desc:b,name:c,institution:d,address:e,city:f,state:g,postal_code:h,country:i,phone:j},$.getJSON(l,k,function(b){return"error"===b.status?void a.renderError(b.message):(a.hideErrorDoneMessage(),a.initializeSection(b),a.renderDone(b.message),void $(".edit-address-section").remove())})},hideErrorDoneMessage:function(){$(".donemessage").hide(),$(".validate.errormessage").hide()},setAddressFilter:function(a,b){var c=Galaxy.root+"api/user_preferences/manage_user_info/",d={};d={id:a.user_id,show_filter:b.currentTarget.attributes["data-id"].nodeValue},$.getJSON(c,d,function(b){a.initializeSection(b)})},editAddress:function(a,b){var c=Galaxy.root+"api/user_preferences/edit_address/",d={};d={id:a.user_id,address_id:b.currentTarget.attributes["data-id"].nodeValue},$.getJSON(c,d,function(b){a.hideErrorDoneMessage(),a.renderEditAddress(a,b),a.address_id=b.address_id})},deleteAddress:function(a,b){var c=Galaxy.root+"api/user_preferences/delete_address/",d={};d={id:a.user_id,address_id:b.currentTarget.attributes["data-id"].nodeValue},$.getJSON(c,d,function(b){a.hideErrorDoneMessage(),a.initializeSection(b),a.renderDone(b.message)})},undeleteAddress:function(a,b){var c=Galaxy.root+"api/user_preferences/undelete_address/",d={};d={id:a.user_id,address_id:b.currentTarget.attributes["data-id"].nodeValue},$.getJSON(c,d,function(b){a.hideErrorDoneMessage(),a.initializeSection(b),a.renderDone(b.message)})},showUserPref:function(){require("mvc/user/user-preferences").UserPreferences.prototype.getUserPreferencesData()}});return{ManageUserInformation:a}});
//# sourceMappingURL=../../../maps/mvc/user/manage-user-information.js.map