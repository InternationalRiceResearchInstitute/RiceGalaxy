define(["libs/underscore"],function(a){var b=a.extend,c=2,d=5,e=function(a,b){this.slot=a,this.feature=b},f=function(a,b,c,d){this.slots={},this.start_end_dct={},this.w_scale=a,this.mode=b,this.include_label="Pack"===b,this.max_rows=c,this.measureText=d};return b(f.prototype,{_get_draw_coords:function(a){var b,e=Math.floor(a[1]*this.w_scale),f=Math.ceil(a[2]*this.w_scale),g=a[3];if(void 0!==g&&this.include_label){var h=this.measureText(g).width+(c+d);e-h>=0?(e-=h,b="left"):(f+=h,b="right")}return[e,f]},_find_slot:function(a){for(var b=a[0],c=a[1],d=0;d<=this.max_rows;d++){var e=!1,f=this.start_end_dct[d];if(void 0!==f)for(var g=0,h=f.length;h>g;g++){var i=f[g];if(c>i[0]&&b<i[1]){e=!0;break}}if(!e)return d}return-1},slot_features:function(a){for(var b,c,d=this.start_end_dct,f=[],g=0,h=0,i=a.length;i>h;h++){b=a[h],c=b[0];var j=this.slots[c];if(j){if(b[1]<j.feature[1]||j.feature[2]<b[2])for(var k=this._get_draw_coords(j.feature),l=this._get_draw_coords(b),m=this.start_end_dct[j.slot],n=0;n<m.length;n++){var o=m[n];o[0]===k[0]&&o[1]===k[1]&&(m[n]=l)}g=Math.max(g,this.slots[c].slot)}else f.push(h)}for(var h=0,i=f.length;i>h;h++){b=a[f[h]],c=b[0];var p=this._get_draw_coords(b),q=this._find_slot(p);q>=0&&(void 0===d[q]&&(d[q]=[]),d[q].push(p),this.slots[c]=new e(q,b),g=Math.max(g,q))}return g+1}}),{FeatureSlotter:f}});
//# sourceMappingURL=../../../maps/viz/trackster/slotting.js.map