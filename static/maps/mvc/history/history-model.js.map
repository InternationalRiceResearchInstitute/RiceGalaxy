{"version":3,"file":"history-model.js","sources":["../../../src/mvc/history/history-model.js"],"names":["define","HISTORY_CONTENTS","HISTORY_PREFS","CONTROLLED_FETCH_COLLECTION","UTILS","BASE_MVC","_l","History","Backbone","Model","extend","LoggableMixin","mixin","SearchableModelMixin","_logNamespace","UPDATE_DELAY","defaults","model_class","id","name","state","deleted","contents_active","contents_states","urlRoot","Galaxy","root","contentsClass","HistoryContents","searchAttributes","searchAliases","title","tag","initialize","historyJSON","options","this","logger","log","contents","history","historyId","get","order","_setUpListeners","_setUpCollectionListeners","updateTimeoutId","on","error","clearUpdateTimeout","change:id","model","newId","listenTo","trigger","apply","jQuery","makeArray","arguments","contentsShown","contentsActive","shown","active","includeDeleted","includeHidden","hidden","nice_size","size","bytesToString","toJSON","_","prototype","call","key","ownedByCurrUser","user","isAnonymous","numOfUnfinishedJobs","unfinishedJobIds","length","numOfUnfinishedShownContents","runningAndActive","_fetchContentRelatedAttributes","contentRelatedAttrs","fetch","data","$","param","keys","join","refresh","self","lastUpdateTime","allFetched","fetchFn","currentPage","fetchPage","fetchUpdated","done","response","status","xhr","serverResponseDatetime","Date","getResponseHeader","err","checkForUpdates","_delayThenUpdate","setTimeout","delay","nonReadyContentCount","clearTimeout","parse","parsed","create_time","update_time","fetchWithContents","contentsOptions","view","then","setHistoryId","fetchContents","fetchCurrentPage","_delete","when","save","purge","purged","undelete","copy","current","allDatasets","undefined","Error","postData","history_id","all_datasets","post","newHistory","setAsCurrent","getJSON","toString","_collectionSuper","InfinitelyScrollingCollection","HistoryCollection","limitOnFirstFetch","limitPerFetch","models","currentHistoryId","setUpListeners","url","change:deleted","debug","remove","copied","original","newData","setCurrent","set-as-current","oldCurrentId","_buildFetchData","_buildFetchFilters","superFilters","filters","fetchFirst","silent","limit","encoded_id-in","offset","fetchMore","comparators","clone","buildComparator","ascending","name-dsc","size-asc","sort","currentHistory","unshift","create","hdas","historyOptions","collection"],"mappings":"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"}