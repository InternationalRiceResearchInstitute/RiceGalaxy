define(function(){return function(t){function e(n){if(r[n])return r[n].exports;var a=r[n]={exports:{},id:n,loaded:!1};return t[n].call(a.exports,a,a.exports,e),a.loaded=!0,a.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}({0:function(t,e,r){var n,a;n=[r(5),r(160),r(159)],a=function(t,e){return Backbone.View.extend({_combinations:function(t,e,r){var n=this;_.each(e,function(a,i){var s=t.slice(),o=e.slice();o.splice(0,i+1),s.push(a),r.push(s),n._combinations(s,o,r)})},initialize:function(r){var n=this;t.request({dataset_id:r.chart.get("dataset_id"),dataset_groups:r.chart.groups,success:function(t){var a=[],i=[],s={},o=[];_.each(t,function(t,e){var r={};_.each(t.values,function(t){s[t.observation]=r[t.observation]=!0}),a.push(t.key),i.push(r),o.push(e)});var u=[];n._combinations([],o,u);var f=[];_.each(u,function(t){var e=0;for(var r in s){var n=0;_.each(t,function(t){i[t][r]&&n++}),n==t.length&&e++}if(e>0){var o=[];_.each(t,function(t){o.push(a[t])}),f.push({sets:o,size:e})}});var l=d3.select("#"+r.targets[0]).datum(f).call(e.VennDiagram()),c=null;l.selectAll("g").on("mouseover",function(t,r){e.sortAreas(l,t),c=d3.select("body").append("div").attr("class","venntooltip"),c.transition().duration(400).style("opacity",.9),c.text(t.size);var n=d3.select(this).transition("tooltip").duration(400);n.select("path").style("stroke-width",3).style("fill-opacity",1==t.sets.length?.4:.1).style("stroke-opacity",1)}).on("mousemove",function(){c.style("left",d3.event.pageX+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t,e){c.remove()}),r.chart.state("ok","Venn diagram drawn."),r.process.resolve()}})}})}.apply(e,n),!(void 0!==a&&(t.exports=a))},1:function(t,e,r){var n,a;n=[],a=function(){function t(t){return JSON.parse(JSON.stringify(t)||null)}function e(t){return/^[\],:{}\s]*$/.test(t.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))}function r(t){top.__utils__get__=top.__utils__get__||{};var e=JSON.stringify(t);t.cache&&top.__utils__get__[e]?(t.success&&t.success(top.__utils__get__[e]),window.console.debug("utils.js::get() - Fetching from cache ["+t.url+"].")):n({url:t.url,data:t.data,success:function(r){top.__utils__get__[e]=r,t.success&&t.success(r)},error:function(e){t.error&&t.error(e)}})}function n(t){var r={contentType:"application/json",type:t.type||"GET",data:t.data||{},url:t.url};"GET"==r.type||"DELETE"==r.type?($.isEmptyObject(r.data)||(r.url+=r.url.indexOf("?")==-1?"?":"&",r.url+=$.param(r.data,!0)),r.data=null):(r.dataType="json",r.url=r.url,r.data=JSON.stringify(r.data)),$.ajax(r).done(function(r){if("string"==typeof r&&e(r))try{r=r.replace("Infinity,",'"Infinity",'),r=jQuery.parseJSON(r)}catch(n){console.debug(n)}t.success&&t.success(r)}).fail(function(e){var r=null;try{r=jQuery.parseJSON(e.responseText)}catch(n){r=e.responseText}t.error&&t.error(r,e)}).always(function(){t.complete&&t.complete()})}function a(t,e){return t?_.defaults(t,e):e}function i(){return top.__utils__uid__=top.__utils__uid__||0,"uid-"+top.__utils__uid__++}return{get:r,merge:a,uid:i,request:n,clone:t,isJSON:e}}.apply(e,n),!(void 0!==a&&(t.exports=a))},5:function(t,e,r){var n,a;n=[r(1)],a=function(t){var e={},r=function(r){var i=r.dataset_groups,s=r.dataset_id,o=[];return i.each(function(t){_.each(t.get("__data_columns"),function(r,n){var i=t.get(n),u=a(s,i);o.indexOf(i)!==-1||e[u]||"auto"==i||"zero"==i||void 0===i||o.push(i)})}),0==o.length?void n(r):void t.get({url:Galaxy.root+"api/datasets/"+s,data:{data_type:"raw_data",provider:"dataset-column",indeces:o.toString()},success:function(t){for(var i=new Array(o.length),u=0;u<i.length;u++)i[u]=[];for(var u in t.data){var f=t.data[u];for(var l in f){var c=f[l];void 0!==c&&2147483647!=c&&i[l].push(c)}}console.debug("tabular-datasets::_fetch() - Fetching complete.");for(var u in i){var h=o[u],p=a(s,h);e[p]=i[u]}n(r)}})},n=function(r){var n=r.dataset_groups,i=r.dataset_id;console.debug("tabular-datasets::_fillFromCache() - Filling request from cache.");var s=0;n.each(function(t){_.each(t.get("__data_columns"),function(r,n){var o=t.get(n),u=a(i,o),f=e[u];f&&(s=Math.max(s,f.length))})}),0==s&&console.debug("tabular-datasets::_fillFromCache() - No data available.");var o=[];n.each(function(e,r){for(var n=t.merge({key:r+":"+e.get("key"),values:[]},e.attributes),a=0;a<s;a++)n.values[a]={x:parseInt(a)};o.push(n)}),n.each(function(t,r){var n=o[r].values;_.each(t.get("__data_columns"),function(r,o){var u=t.get(o);switch(u){case"auto":for(var f=0;f<s;f++)n[f][o]=parseInt(f);break;case"zero":for(var f=0;f<s;f++)n[f][o]=0;break;default:for(var l=a(i,u),c=e[l],f=0;f<s;f++){var h=n[f],p=c[f];isNaN(p)&&!r.is_label&&(p=0),h[o]=p}}})}),r.success(o)},a=function(t,e){return t+"__"+e};return{request:r}}.apply(e,n),!(void 0!==a&&(t.exports=a))},6:function(t,e){t.exports=function(){var t=[];return t.toString=function(){for(var t=[],e=0;e<this.length;e++){var r=this[e];r[2]?t.push("@media "+r[2]+"{"+r[1]+"}"):t.push(r[1])}return t.join("")},t.i=function(e,r){"string"==typeof e&&(e=[[null,e,""]]);for(var n={},a=0;a<this.length;a++){var i=this[a][0];"number"==typeof i&&(n[i]=!0)}for(a=0;a<e.length;a++){var s=e[a];"number"==typeof s[0]&&n[s[0]]||(r&&!s[2]?s[2]=r:r&&(s[2]="("+s[2]+") and ("+r+")"),t.push(s))}},t}},7:function(t,e,r){function n(t,e){for(var r=0;r<t.length;r++){var n=t[r],a=p[n.id];if(a){a.refs++;for(var i=0;i<a.parts.length;i++)a.parts[i](n.parts[i]);for(;i<n.parts.length;i++)a.parts.push(f(n.parts[i],e))}else{for(var s=[],i=0;i<n.parts.length;i++)s.push(f(n.parts[i],e));p[n.id]={id:n.id,refs:1,parts:s}}}}function a(t){for(var e=[],r={},n=0;n<t.length;n++){var a=t[n],i=a[0],s=a[1],o=a[2],u=a[3],f={css:s,media:o,sourceMap:u};r[i]?r[i].parts.push(f):e.push(r[i]={id:i,parts:[f]})}return e}function i(t,e){var r=x(),n=m[m.length-1];if("top"===t.insertAt)n?n.nextSibling?r.insertBefore(e,n.nextSibling):r.appendChild(e):r.insertBefore(e,r.firstChild),m.push(e);else{if("bottom"!==t.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");r.appendChild(e)}}function s(t){t.parentNode.removeChild(t);var e=m.indexOf(t);e>=0&&m.splice(e,1)}function o(t){var e=document.createElement("style");return e.type="text/css",i(t,e),e}function u(t){var e=document.createElement("link");return e.rel="stylesheet",i(t,e),e}function f(t,e){var r,n,a;if(e.singleton){var i=y++;r=g||(g=o(e)),n=l.bind(null,r,i,!1),a=l.bind(null,r,i,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(r=u(e),n=h.bind(null,r),a=function(){s(r),r.href&&URL.revokeObjectURL(r.href)}):(r=o(e),n=c.bind(null,r),a=function(){s(r)});return n(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n(t=e)}else a()}}function l(t,e,r,n){var a=r?"":n.css;if(t.styleSheet)t.styleSheet.cssText=_(e,a);else{var i=document.createTextNode(a),s=t.childNodes;s[e]&&t.removeChild(s[e]),s.length?t.insertBefore(i,s[e]):t.appendChild(i)}}function c(t,e){var r=e.css,n=e.media;if(n&&t.setAttribute("media",n),t.styleSheet)t.styleSheet.cssText=r;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(r))}}function h(t,e){var r=e.css,n=e.sourceMap;n&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(n))))+" */");var a=new Blob([r],{type:"text/css"}),i=t.href;t.href=URL.createObjectURL(a),i&&URL.revokeObjectURL(i)}var p={},d=function(t){var e;return function(){return"undefined"==typeof e&&(e=t.apply(this,arguments)),e}},v=d(function(){return/msie [6-9]\b/.test(window.navigator.userAgent.toLowerCase())}),x=d(function(){return document.head||document.getElementsByTagName("head")[0]}),g=null,y=0,m=[];t.exports=function(t,e){e=e||{},"undefined"==typeof e.singleton&&(e.singleton=v()),"undefined"==typeof e.insertAt&&(e.insertAt="bottom");var r=a(t);return n(r,e),function(t){for(var i=[],s=0;s<r.length;s++){var o=r[s],u=p[o.id];u.refs--,i.push(u)}if(t){var f=a(t);n(f,e)}for(var s=0;s<i.length;s++){var u=i[s];if(0===u.refs){for(var l=0;l<u.parts.length;l++)u.parts[l]();delete p[u.id]}}}};var _=function(){var t=[];return function(e,r){return t[e]=r,t.filter(Boolean).join("\n")}}()},66:function(t,e,r){e=t.exports=r(6)(),e.push([t.id,".venntooltip{position:absolute;text-align:center;width:128px;height:22px;background:#333;color:#ddd;border:0;border-radius:8px;opacity:0}.venn-area>.label{font-size:1em}",""])},159:function(t,e,r){var n=r(66);"string"==typeof n&&(n=[[t.id,n,""]]);r(7)(n,{});n.locals&&(t.exports=n.locals)},160:function(t,e,r){!function(t,r){r(e)}(this,function(t){"use strict";function e(t,e,r,n){n=n||{};var a=n.maxIterations||100,i=n.tolerance||1e-10,s=t(e),o=t(r),u=r-e;if(s*o>0)throw"Initial bisect points must have opposite signs";if(0===s)return e;if(0===o)return r;for(var f=0;f<a;++f){u/=2;var l=e+u,c=t(l);if(c*s>=0&&(e=l),Math.abs(u)<i||0===c)return l}return e+u}function r(t){for(var e=new Array(t),r=0;r<t;++r)e[r]=0;return e}function n(t,e){return r(t).map(function(){return r(e)})}function a(t,e){for(var r=0,n=0;n<t.length;++n)r+=t[n]*e[n];return r}function i(t){return Math.sqrt(a(t,t))}function s(t,e){for(var r=0;r<t.length;++r)t[r]*=e}function o(t,e,r,n,a){for(var i=0;i<t.length;++i)t[i]=e*r[i]+n*a[i]}function u(t,e,r){r=r||{};var n,a,i=r.maxIterations||200*e.length,s=r.nonZeroDelta||1.1,u=r.zeroDelta||.001,f=r.minErrorDelta||1e-6,l=r.minErrorDelta||1e-5,c=r.rho||1,h=r.chi||2,p=r.psi||-.5,d=r.sigma||.5,v=r.callback,x=e.length,g=new Array(x+1);g[0]=e,g[0].fx=t(e);for(var y=0;y<x;++y){var m=e.slice();m[y]=m[y]?m[y]*s:u,g[y+1]=m,g[y+1].fx=t(m)}for(var _=function(t,e){return t.fx-e.fx},b=e.slice(),M=e.slice(),w=e.slice(),z=e.slice(),R=0;R<i;++R){for(g.sort(_),v&&v(g),n=0,y=0;y<x;++y)n=Math.max(n,Math.abs(g[0][y]-g[1][y]));if(Math.abs(g[0].fx-g[x].fx)<f&&n<l)break;for(y=0;y<x;++y){b[y]=0;for(var I=0;I<x;++I)b[y]+=g[I][y];b[y]/=x}var A=g[x];if(o(M,1+c,b,-c,A),M.fx=t(M),M.fx<=g[0].fx)o(z,1+h,b,-h,A),z.fx=t(z),z.fx<M.fx?(a=g[x],g[x]=z,z=a):(a=g[x],g[x]=M,M=a);else if(M.fx>=g[x-1].fx){var O=!1;if(M.fx>A.fx?(o(w,1+p,b,-p,A),w.fx=t(w),w.fx<A.fx?(a=g[x],g[x]=w,w=a):O=!0):(o(w,1-p*c,b,p*c,A),w.fx=t(w),w.fx<=M.fx?(a=g[x],g[x]=w,w=a):O=!0),O)for(y=1;y<g.length;++y)o(g[y],1-d,g[0],d,g[y]),g[y].fx=t(g[y])}else a=g[x],g[x]=M,M=a}return g.sort(_),{f:g[0].fx,solution:g[0]}}function f(t,e,r){var n,u,f,c={x:e.slice(),fx:0,fxprime:e.slice()},h={x:e.slice(),fx:0,fxprime:e.slice()},p=e.slice(),d=1;r=r||{},f=r.maxIterations||5*e.length,c.fx=t(c.x,c.fxprime),n=c.fxprime.slice(),s(n,-1);for(var v=0;v<f;++v){if(r.history&&r.history.push({x:c.x.slice(),fx:c.fx,fxprime:c.fxprime.slice()}),d=l(t,n,c,h,d)){o(p,1,h.fxprime,-1,c.fxprime);var x=a(c.fxprime,c.fxprime),g=Math.max(0,a(p,h.fxprime)/x);o(n,g,n,-1,h.fxprime),u=c,c=h,h=u}else for(var y=0;y<n.length;++y)n[y]=-1*c.fxprime[y];if(i(c.fxprime)<=1e-5)break}return r.history&&r.history.push({x:c.x.slice(),fx:c.fx,fxprime:c.fxprime.slice()}),c}function l(t,e,r,n,i){function s(s,c,p){for(var d=0;d<16;++d)if(i=(s+c)/2,o(n.x,1,r.x,i,e),l=n.fx=t(n.x,n.fxprime),h=a(n.fxprime,e),l>u+G*i*f||l>=p)c=i;else{if(Math.abs(h)<=-V*f)return i;h*(c-s)>=0&&(c=s),s=i,p=l}return 0}var u=r.fx,f=a(r.fxprime,e),l=u,c=u,h=f,p=0;i=i||1;for(var d=0;d<10;++d){if(o(n.x,1,r.x,i,e),l=n.fx=t(n.x,n.fxprime),h=a(n.fxprime,e),l>u+G*i*f||d&&l>=c)return s(p,i,c);if(Math.abs(h)<=-V*f)return i;if(h>=0)return s(i,p,l);c=l,p=i,i*=2}return 0}function c(t,e){var r,n=p(t),a=n.filter(function(e){return h(e,t)}),i=0,s=0,o=[];if(a.length>1){var u=m(a);for(r=0;r<a.length;++r){var f=a[r];f.angle=Math.atan2(f.x-u.x,f.y-u.y)}a.sort(function(t,e){return e.angle-t.angle});var l=a[a.length-1];for(r=0;r<a.length;++r){var c=a[r];s+=(l.x+c.x)*(c.y-l.y);for(var d={x:(c.x+l.x)/2,y:(c.y+l.y)/2},g=null,y=0;y<c.parentIndex.length;++y)if(l.parentIndex.indexOf(c.parentIndex[y])>-1){var _=t[c.parentIndex[y]],b=Math.atan2(c.x-_.x,c.y-_.y),M=Math.atan2(l.x-_.x,l.y-_.y),w=M-b;w<0&&(w+=2*Math.PI);var z=M-w/2,R=x(d,{x:_.x+_.radius*Math.sin(z),y:_.y+_.radius*Math.cos(z)});(null===g||g.width>R)&&(g={circle:_,width:R,p1:c,p2:l})}null!==g&&(o.push(g),i+=v(g.circle.radius,g.width),l=c)}}else{var I=t[0];for(r=1;r<t.length;++r)t[r].radius<I.radius&&(I=t[r]);var A=!1;for(r=0;r<t.length;++r)if(x(t[r],I)>Math.abs(I.radius-t[r].radius)){A=!0;break}A?i=s=0:(i=I.radius*I.radius*Math.PI,o.push({circle:I,p1:{x:I.x,y:I.y+I.radius},p2:{x:I.x-$,y:I.y+I.radius},width:2*I.radius}))}return s/=2,e&&(e.area=i+s,e.arcArea=i,e.polygonArea=s,e.arcs=o,e.innerPoints=a,e.intersectionPoints=n),i+s}function h(t,e){for(var r=0;r<e.length;++r)if(x(t,e[r])>e[r].radius+$)return!1;return!0}function p(t){for(var e=[],r=0;r<t.length;++r)for(var n=r+1;n<t.length;++n)for(var a=y(t[r],t[n]),i=0;i<a.length;++i){var s=a[i];s.parentIndex=[r,n],e.push(s)}return e}function d(t,e){var r=Math.sqrt(t*t-e*e);return e*r+t*t*Math.atan2(e,r)}function v(t,e){return d(t,e-t)-d(t,-t)}function x(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))}function g(t,e,r){if(r>=t+e)return 0;if(r<=Math.abs(t-e))return Math.PI*Math.min(t,e)*Math.min(t,e);var n=t-(r*r-e*e+t*t)/(2*r),a=e-(r*r-t*t+e*e)/(2*r);return v(t,n)+v(e,a)}function y(t,e){var r=x(t,e),n=t.radius,a=e.radius;if(r>=n+a||r<=Math.abs(n-a))return[];var i=(n*n-a*a+r*r)/(2*r),s=Math.sqrt(n*n-i*i),o=t.x+i*(e.x-t.x)/r,u=t.y+i*(e.y-t.y)/r,f=-(e.y-t.y)*(s/r),l=-(e.x-t.x)*(s/r);return[{x:o+f,y:u-l},{x:o-f,y:u+l}]}function m(t){for(var e={x:0,y:0},r=0;r<t.length;++r)e.x+=t[r].x,e.y+=t[r].y;return e.x/=t.length,e.y/=t.length,e}function _(t,e){e=e||{},e.maxIterations=e.maxIterations||500;var r=e.initialLayout||R;t=M(t);var n,a=r(t),i=[],s=[];for(n in a)a.hasOwnProperty(n)&&(i.push(a[n].x),i.push(a[n].y),s.push(n));for(var o=0,f=u(function(e){o+=1;for(var r={},n=0;n<s.length;++n){var i=s[n];r[i]={x:e[2*n],y:e[2*n+1],radius:a[i].radius}}return O(r,t)},i,e),l=f.solution,c=0;c<s.length;++c)n=s[c],a[n].x=l[2*c],a[n].y=l[2*c+1];return a}function b(t,r,n){return Math.min(t,r)*Math.min(t,r)*Math.PI<=n+Q?Math.abs(t-r):e(function(e){return g(t,r,e)-n},0,t+r)}function M(t){t=t.slice();var e,r,n,a,i=[],s={};for(e=0;e<t.length;++e){var o=t[e];1==o.sets.length?i.push(o.sets[0]):2==o.sets.length&&(n=o.sets[0],a=o.sets[1],s[[n,a]]=!0,s[[a,n]]=!0)}for(i.sort(function(t,e){return t>e}),e=0;e<i.length;++e)for(n=i[e],r=e+1;r<i.length;++r)a=i[r],[n,a]in s||t.push({sets:[n,a],size:0});return t}function w(t,e,r){var a=n(e.length,e.length),i=n(e.length,e.length);return t.filter(function(t){return 2==t.sets.length}).map(function(t){var n=r[t.sets[0]],s=r[t.sets[1]],o=Math.sqrt(e[n].size/Math.PI),u=Math.sqrt(e[s].size/Math.PI),f=b(o,u,t.size);a[n][s]=a[s][n]=f;var l=0;t.size+1e-10>=Math.min(e[n].size,e[s].size)?l=1:t.size<=1e-10&&(l=-1),i[n][s]=i[s][n]=l}),{distances:a,constraints:i}}function z(t,e,r,n){var a,i=0;for(a=0;a<e.length;++a)e[a]=0;for(a=0;a<r.length;++a)for(var s=t[2*a],o=t[2*a+1],u=a+1;u<r.length;++u){var f=t[2*u],l=t[2*u+1],c=r[a][u],h=n[a][u],p=(f-s)*(f-s)+(l-o)*(l-o),d=Math.sqrt(p),v=p-c*c;h>0&&d<=c||h<0&&d>=c||(i+=2*v*v,e[2*a]+=4*v*(s-f),e[2*a+1]+=4*v*(o-l),e[2*u]+=4*v*(f-s),e[2*u+1]+=4*v*(l-o))}return i}function R(t,e){var r=A(t,e);if(t.length>=8){var n=I(t,e),a=O(n,t),i=O(r,t);a+1e-8<i&&(r=n)}return r}function I(t,e){e=e||{};var n,a=e.restarts||10,o=[],u={};for(n=0;n<t.length;++n){var l=t[n];1==l.sets.length&&(u[l.sets[0]]=o.length,o.push(l))}var c=w(t,o,u),h=c.distances,p=c.constraints,d=i(h.map(i))/h.length;h=h.map(function(t){return t.map(function(t){return t/d})});var v,x,g=function(t,e){return z(t,e,h,p)};for(n=0;n<a;++n){var y=r(2*h.length).map(Math.random);x=f(g,y,e),(!v||x.fx<v.fx)&&(v=x)}var m=v.x,_={};for(n=0;n<o.length;++n){var b=o[n];_[b.sets[0]]={x:m[2*n]*d,y:m[2*n+1]*d,radius:Math.sqrt(b.size/Math.PI)}}if(e.history)for(n=0;n<e.history.length;++n)s(e.history[n].x,d);return _}function A(t){function e(t,e){return e.size-t.size}function r(t){return t.set in v}function n(t,e){i[e].x=t.x,i[e].y=t.y,v[e]=!0}for(var a,i={},s={},o=0;o<t.length;++o){var u=t[o];1==u.sets.length&&(a=u.sets[0],i[a]={x:1e10,y:1e10,rowid:i.length,size:u.size,radius:Math.sqrt(u.size/Math.PI)},s[a]=[])}for(t=t.filter(function(t){return 2==t.sets.length}),o=0;o<t.length;++o){var f=t[o],l=f.hasOwnProperty("weight")?f.weight:1,c=f.sets[0],h=f.sets[1];f.size+Q>=Math.min(i[c].size,i[h].size)&&(l=0),s[c].push({set:h,size:f.size,weight:l}),s[h].push({set:c,size:f.size,weight:l})}var p=[];for(a in s)if(s.hasOwnProperty(a)){var d=0;for(o=0;o<s[a].length;++o)d+=s[a][o].size*s[a][o].weight;p.push({set:a,size:d})}p.sort(e);var v={};for(n({x:0,y:0},p[0].set),o=1;o<p.length;++o){var x=p[o].set,g=s[x].filter(r);if(a=i[x],g.sort(e),0===g.length)throw"ERROR: missing pairwise overlap information";for(var m=[],_=0;_<g.length;++_){var M=i[g[_].set],w=b(a.radius,M.radius,g[_].size);m.push({x:M.x+w,y:M.y}),m.push({x:M.x-w,y:M.y}),m.push({y:M.y+w,x:M.x}),m.push({y:M.y-w,x:M.x});for(var z=_+1;z<g.length;++z)for(var R=i[g[z].set],I=b(a.radius,R.radius,g[z].size),A=y({x:M.x,y:M.y,radius:w},{x:R.x,y:R.y,radius:I}),P=0;P<A.length;++P)m.push(A[P])}var j=1e50,k=m[0];for(_=0;_<m.length;++_){i[x].x=m[_].x,i[x].y=m[_].y;var C=O(i,t);C<j&&(j=C,k=m[_])}n(k,x)}return i}function O(t,e){function r(e){return e.map(function(e){return t[e]})}for(var n=0,a=0;a<e.length;++a){var i,s=e[a];if(1!=s.sets.length){if(2==s.sets.length){var o=t[s.sets[0]],u=t[s.sets[1]];i=g(o.radius,u.radius,x(o,u))}else i=c(r(s.sets));var f=s.hasOwnProperty("weight")?s.weight:1;n+=f*(i-s.size)*(i-s.size)}}return n}function P(t,e,r){null===r?t.sort(function(t,e){return e.radius-t.radius}):t.sort(r);var n;if(t.length>0){var a=t[0].x,i=t[0].y;for(n=0;n<t.length;++n)t[n].x-=a,t[n].y-=i}if(t.length>1){var s,o,u=Math.atan2(t[1].x,t[1].y)-e,f=Math.cos(u),l=Math.sin(u);for(n=0;n<t.length;++n)s=t[n].x,o=t[n].y,t[n].x=f*s-l*o,t[n].y=l*s+f*o}if(t.length>2){for(var c=Math.atan2(t[2].x,t[2].y)-e;c<0;)c+=2*Math.PI;for(;c>2*Math.PI;)c-=2*Math.PI;if(c>Math.PI){var h=t[1].y/(1e-10+t[1].x);for(n=0;n<t.length;++n){var p=(t[n].x+h*t[n].y)/(1+h*h);t[n].x=2*p-t[n].x,t[n].y=2*p*h-t[n].y}}}}function j(t){function e(t){return t.parent!==t&&(t.parent=e(t.parent)),t.parent}function r(t,r){var n=e(t),a=e(r);n.parent=a}t.map(function(t){t.parent=t});for(var n=0;n<t.length;++n)for(var a=n+1;a<t.length;++a){var i=t[n].radius+t[a].radius;x(t[n],t[a])+1e-10<i&&r(t[a],t[n])}var s,o={};for(n=0;n<t.length;++n)s=e(t[n]).parent.setid,s in o||(o[s]=[]),o[s].push(t[n]);t.map(function(t){delete t.parent});var u=[];for(s in o)o.hasOwnProperty(s)&&u.push(o[s]);return u}function k(t){var e=function(e){var r=Math.max.apply(null,t.map(function(t){return t[e]+t.radius})),n=Math.min.apply(null,t.map(function(t){return t[e]-t.radius}));return{max:r,min:n}};return{xRange:e("x"),yRange:e("y")}}function C(t,e,r){function n(t,e,r){if(t){var n,a,i,o=t.bounds;e?n=l.xRange.max-o.xRange.min+c:(n=l.xRange.max-o.xRange.max,i=(o.xRange.max-o.xRange.min)/2-(l.xRange.max-l.xRange.min)/2,i<0&&(n+=i)),r?a=l.yRange.max-o.yRange.min+c:(a=l.yRange.max-o.yRange.max,i=(o.yRange.max-o.yRange.min)/2-(l.yRange.max-l.yRange.min)/2,i<0&&(a+=i));for(var u=0;u<t.length;++u)t[u].x+=n,t[u].y+=a,s.push(t[u])}}null===e&&(e=Math.PI/2);var a,i,s=[];for(i in t)if(t.hasOwnProperty(i)){var o=t[i];s.push({x:o.x,y:o.y,radius:o.radius,setid:i})}var u=j(s);for(a=0;a<u.length;++a){P(u[a],e,r);var f=k(u[a]);u[a].size=(f.xRange.max-f.xRange.min)*(f.yRange.max-f.yRange.min),u[a].bounds=f}u.sort(function(t,e){return e.size-t.size}),s=u[0];for(var l=s.bounds,c=(l.xRange.max-l.xRange.min)/50,h=1;h<u.length;)n(u[h],!0,!1),n(u[h+1],!1,!0),n(u[h+2],!0,!0),h+=3,l=k(s);var p={};for(a=0;a<s.length;++a)p[s[a].setid]=s[a];return p}function S(t,e,r,n){var a=[],i=[];for(var s in t)t.hasOwnProperty(s)&&(i.push(s),a.push(t[s]));e-=2*n,r-=2*n;for(var o=k(a),u=o.xRange,f=o.yRange,l=e/(u.max-u.min),c=r/(f.max-f.min),h=Math.min(c,l),p=(e-(u.max-u.min)*h)/2,d=(r-(f.max-f.min)*h)/2,v={},x=0;x<a.length;++x){var g=a[x];v[i[x]]={radius:h*g.radius,x:n+p+(g.x-u.min)*h,y:n+d+(g.y-f.min)*h}}return v}function L(){function t(t){var h=t.datum(),p=x(h);o&&(p=C(p,s,c));var d=S(p,r,n,a),g=U(d,h);t.selectAll("svg").data([d]).enter().append("svg");var y=t.select("svg").attr("width",r).attr("height",n),m={},_=!1;y.selectAll("g path").each(function(t){var e=d3.select(this).attr("d");1==t.sets.length&&e&&(_=!0,m[t.sets[0]]=D(e))});var b=function(t){return function(e){var a=t.sets.map(function(t){var a=m[t],i=d[t];return a||(a={x:r/2,y:n/2,radius:1}),i||(i={x:r/2,y:n/2,radius:1}),{x:a.x*(1-e)+i.x*e,y:a.y*(1-e)+i.y*e,radius:a.radius*(1-e)+i.radius*e}});return J(a)}},M=y.selectAll("g").data(h,function(t){return t.sets}),w=M.enter().append("g").attr("class",function(t){return"venn-area venn-"+(1==t.sets.length?"circle":"intersection")}).attr("data-venn-sets",function(t){return t.sets.join("_")}),z=w.append("path"),R=w.append("text").attr("class","label").text(function(t){return e(t)}).attr("text-anchor","middle").attr("dy",".35em").attr("x",r/2).attr("y",n/2);f&&(z.style("fill-opacity","0").filter(function(t){return 1==t.sets.length}).style("fill",function(t){return v(e(t))}).style("fill-opacity",".25"),R.style("fill",function(t){return 1==t.sets.length?v(e(t)):"#444"}));var I=t;_?(I=t.transition("venn").duration(i),I.selectAll("path").attrTween("d",b)):I.selectAll("path").attr("d",function(t){return J(t.sets.map(function(t){return d[t]}))});var A=I.selectAll("text").filter(function(t){return t.sets in g}).text(function(t){return e(t)}).attr("x",function(t){return Math.floor(g[t.sets].x)}).attr("y",function(t){return Math.floor(g[t.sets].y)});u&&(_?"on"in A?A.on("end",N(d,e)):A.each("end",N(d,e)):A.each(N(d,e)));var O=M.exit().transition("venn").duration(i).remove();O.selectAll("path").attrTween("d",b);var P=O.selectAll("text").attr("x",r/2).attr("y",n/2);return null!==l&&(R.style("font-size","0px"),A.style("font-size",l),P.style("font-size","0px")),{circles:d,textCentres:g,nodes:M,enter:w,update:I,exit:O}}function e(t){return t.label?t.label:1==t.sets.length?""+t.sets[0]:void 0}var r=600,n=350,a=15,i=1e3,s=Math.PI/2,o=!0,u=!0,f=!0,l=null,c=null,h={},p=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],d=0,v=function(t){if(t in h)return h[t];var e=h[t]=p[d];return d+=1,d>=p.length&&(d=0),e},x=_;return t.wrap=function(e){return arguments.length?(u=e,t):u},t.width=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(n=e,t):n},t.padding=function(e){return arguments.length?(a=e,t):a},t.colours=function(e){return arguments.length?(v=e,t):v},t.fontSize=function(e){return arguments.length?(l=e,t):l},t.duration=function(e){return arguments.length?(i=e,t):i},t.layoutFunction=function(e){return arguments.length?(x=e,t):x},t.normalize=function(e){return arguments.length?(o=e,t):o},t.styled=function(e){return arguments.length?(f=e,t):f},t.orientation=function(e){return arguments.length?(s=e,t):s},t.orientationOrder=function(e){return arguments.length?(c=e,t):c},t}function N(t,e){return function(){for(var r,n=d3.select(this),a=n.datum(),i=t[a.sets[0]].radius||50,s=e(a)||"",o=s.split(/\s+/).reverse(),u=3,f=(s.length+o.length)/u,l=o.pop(),c=[l],h=0,p=1.1,d=n.text(null).append("tspan").text(l);;){if(l=o.pop(),!l)break;c.push(l),r=c.join(" "),d.text(r),r.length>f&&d.node().getComputedTextLength()>i&&(c.pop(),d.text(c.join(" ")),c=[l],d=n.append("tspan").text(l),h++)}var v=.35-h*p/2,x=n.attr("x"),g=n.attr("y");n.selectAll("tspan").attr("x",x).attr("y",g).attr("dy",function(t,e){return v+e*p+"em"})}}function T(t,e,r){var n,a,i=e[0].radius-x(e[0],t);for(n=1;n<e.length;++n)a=e[n].radius-x(e[n],t),a<=i&&(i=a);for(n=0;n<r.length;++n)a=x(r[n],t)-r[n].radius,a<=i&&(i=a);return i}function E(t,e){var r,n=[];for(r=0;r<t.length;++r){var a=t[r];n.push({x:a.x,y:a.y}),n.push({x:a.x+a.radius/2,y:a.y}),n.push({x:a.x-a.radius/2,y:a.y}),n.push({x:a.x,y:a.y+a.radius/2}),n.push({x:a.x,y:a.y-a.radius/2})}var i=n[0],s=T(n[0],t,e);for(r=1;r<n.length;++r){var o=T(n[r],t,e);o>=s&&(i=n[r],s=o)}var f=u(function(r){return-1*T({x:r[0],y:r[1]},t,e)},[i.x,i.y],{maxIterations:500,minErrorDelta:1e-10}).solution,l={x:f[0],y:f[1]},h=!0;for(r=0;r<t.length;++r)if(x(l,t[r])>t[r].radius){h=!1;break}for(r=0;r<e.length;++r)if(x(l,e[r])<e[r].radius){h=!1;break}if(!h)if(1==t.length)l={x:t[0].x,y:t[0].y};else{var p={};c(t,p),l=0===p.arcs.length?{x:0,y:-1e3,disjoint:!0}:1==p.arcs.length?{x:p.arcs[0].circle.x,y:p.arcs[0].circle.y}:e.length?E(t,[]):m(p.arcs.map(function(t){return t.p1}))}return l}function q(t){var e={},r=[];for(var n in t)r.push(n),e[n]=[];for(var a=0;a<r.length;a++)for(var i=t[r[a]],s=a+1;s<r.length;++s){var o=t[r[s]],u=x(i,o);u+o.radius<=i.radius+1e-10?e[r[s]].push(r[a]):u+i.radius<=o.radius+1e-10&&e[r[a]].push(r[s])}return e}function U(t,e){for(var r={},n=q(t),a=0;a<e.length;++a){for(var i=e[a].sets,s={},o={},u=0;u<i.length;++u){s[i[u]]=!0;for(var f=n[i[u]],l=0;l<f.length;++l)o[f[l]]=!0}var c=[],h=[];for(var p in t)p in s?c.push(t[p]):p in o||h.push(t[p]);var d=E(c,h);r[i]=d,d.disjoint&&e[a].size>0&&console.log("WARNING: area "+i+" not represented on screen")}return r}function F(t,e){function r(t){for(var e=0;e<t.length;++e)if(!(t[e]in a))return!1;return!0}for(var n=q(t.selectAll("svg").datum()),a={},i=0;i<e.sets.length;++i){var s=e.sets[i];for(var o in n)for(var u=n[o],f=0;f<u.length;++f)if(u[f]==s){a[o]=!0;break}}t.selectAll("g").sort(function(t,n){return t.sets.length!=n.sets.length?t.sets.length-n.sets.length:t==e?r(n.sets)?-1:1:n==e?r(t.sets)?1:-1:n.size-t.size})}function B(t,e,r){var n=[];return n.push("\nM",t,e),n.push("\nm",-r,0),n.push("\na",r,r,0,1,0,2*r,0),n.push("\na",r,r,0,1,0,2*-r,0),n.join(" ")}function D(t){var e=t.split(" ");return{x:parseFloat(e[1]),y:parseFloat(e[2]),radius:-parseFloat(e[4])}}function J(t){var e={};c(t,e);var r=e.arcs;if(0===r.length)return"M 0 0";if(1==r.length){var n=r[0].circle;return B(n.x,n.y,n.radius)}for(var a=["\nM",r[0].p2.x,r[0].p2.y],i=0;i<r.length;++i){var s=r[i],o=s.circle.radius,u=s.width>o;a.push("\nA",o,o,0,u?1:0,1,s.p1.x,s.p1.y)}return a.join(" ")}var G=1e-6,V=.1,$=1e-10,Q=1e-10;t.fmin=u,t.minimizeConjugateGradient=f,t.bisect=e,t.intersectionArea=c,t.circleCircleIntersection=y,t.circleOverlap=g,t.circleArea=v,t.distance=x,t.circleIntegral=d,t.venn=_,t.greedyLayout=A,t.scaleSolution=S,t.normalizeSolution=C,t.bestInitialLayout=R,t.lossFunction=O,t.disjointCluster=j,t.distanceFromIntersectArea=b,t.VennDiagram=L,t.wrapText=N,t.computeTextCentres=U,t.computeTextCentre=E,t.sortAreas=F,t.circlePath=B,t.circleFromPath=D,t.intersectionAreaPath=J})}})});
//# sourceMappingURL=benfred_venn.js.map