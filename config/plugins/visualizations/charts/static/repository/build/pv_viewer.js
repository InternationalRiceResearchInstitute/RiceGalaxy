define(function(){return function(t){function e(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return t[n].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}({0:function(t,e,r){var n,i;n=[r(1),r(176)],i=function(t,e){return Backbone.Model.extend({initialize:function(r){var n=r.chart.settings,i=e.Viewer(document.getElementById(r.targets[0]),{quality:n.get("quality"),width:"auto",height:"auto",antialias:!0,outline:!0});t.get({url:r.dataset.download_url,cache:!0,success:function(t){var o=e.io.pdb(t),s={};_.each(n.attributes,function(t,e){e.startsWith("viewer|")&&(s[e.replace("viewer|","")]=t)}),i.clear(),i.renderAs("protein",o,s.mode,s),i.centerOn(o),i.autoZoom(),r.chart.state("ok","Chart drawn."),r.process.resolve()},error:function(){r.chart.state("ok","Failed to load pdb file."),r.process.resolve()}}),$(window).resize(function(){i.fitParent()})}})}.apply(e,n),!(void 0!==i&&(t.exports=i))},1:function(t,e,r){var n,i;n=[],i=function(){function t(t){return JSON.parse(JSON.stringify(t)||null)}function e(t){return/^[\],:{}\s]*$/.test(t.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))}function r(t){top.__utils__get__=top.__utils__get__||{};var e=JSON.stringify(t);t.cache&&top.__utils__get__[e]?(t.success&&t.success(top.__utils__get__[e]),window.console.debug("utils.js::get() - Fetching from cache ["+t.url+"].")):n({url:t.url,data:t.data,success:function(r){top.__utils__get__[e]=r,t.success&&t.success(r)},error:function(e){t.error&&t.error(e)}})}function n(t){var r={contentType:"application/json",type:t.type||"GET",data:t.data||{},url:t.url};"GET"==r.type||"DELETE"==r.type?($.isEmptyObject(r.data)||(r.url+=r.url.indexOf("?")==-1?"?":"&",r.url+=$.param(r.data,!0)),r.data=null):(r.dataType="json",r.url=r.url,r.data=JSON.stringify(r.data)),$.ajax(r).done(function(r){if("string"==typeof r&&e(r))try{r=r.replace("Infinity,",'"Infinity",'),r=jQuery.parseJSON(r)}catch(n){console.debug(n)}t.success&&t.success(r)}).fail(function(e){var r=null;try{r=jQuery.parseJSON(e.responseText)}catch(n){r=e.responseText}t.error&&t.error(r,e)}).always(function(){t.complete&&t.complete()})}function i(t,e){return t?_.defaults(t,e):e}function o(){return top.__utils__uid__=top.__utils__uid__||0,"uid-"+top.__utils__uid__++}return{get:r,merge:i,uid:o,request:n,clone:t,isJSON:e}}.apply(e,n),!(void 0!==i&&(t.exports=i))},176:function(t,e,r){var n,i,o;!function(r,s){i=[],n=s,o="function"==typeof n?n.apply(e,i):n,!(void 0!==o&&(t.exports=o))}(this,function(){var t,e,r,n,i,o,s,a,h,u,c,l,f,_,d,v,m,b,p,g,A,y,C,R,S,w,E,x,T,M,F,I,D,P,V,N,L,O,q,B,U,k,z,j,H,G,W,X,Y,K;return t=function(){var t={};if(!e)var e=1e-6;if(!r)var r="undefined"!=typeof Float32Array?Float32Array:Array;if(!n)var n=Math.random;var i={};i.setMatrixArrayType=function(t){r=t},t.glMatrix=i;var o={};o.create=function(){var t=new r(3);return t[0]=0,t[1]=0,t[2]=0,t},o.clone=function(t){var e=new r(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},o.fromValues=function(t,e,n){var i=new r(3);return i[0]=t,i[1]=e,i[2]=n,i},o.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},o.set=function(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t},o.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},o.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t},o.sub=o.subtract,o.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t},o.mul=o.multiply,o.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t},o.div=o.divide,o.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t},o.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t},o.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},o.scaleAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t},o.distance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(r*r+n*n+i*i)},o.dist=o.distance,o.squaredDistance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return r*r+n*n+i*i},o.sqrDist=o.squaredDistance,o.length=function(t){var e=t[0],r=t[1],n=t[2];return Math.sqrt(e*e+r*r+n*n)},o.len=o.length,o.squaredLength=function(t){var e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n},o.sqrLen=o.squaredLength,o.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},o.normalize=function(t,e){var r=e[0],n=e[1],i=e[2],o=r*r+n*n+i*i;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t},o.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},o.cross=function(t,e,r){var n=e[0],i=e[1],o=e[2],s=r[0],a=r[1],h=r[2];return t[0]=i*h-o*a,t[1]=o*s-n*h,t[2]=n*a-i*s,t},o.lerp=function(t,e,r,n){var i=e[0],o=e[1],s=e[2];return t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t[2]=s+n*(r[2]-s),t},o.random=function(t,e){e=e||1;var r=2*n()*Math.PI,i=2*n()-1,o=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(r)*o,t[1]=Math.sin(r)*o,t[2]=i*e,t},o.transformMat4=function(t,e,r){var n=e[0],i=e[1],o=e[2];return t[0]=r[0]*n+r[4]*i+r[8]*o+r[12],t[1]=r[1]*n+r[5]*i+r[9]*o+r[13],t[2]=r[2]*n+r[6]*i+r[10]*o+r[14],t},o.transformMat3=function(t,e,r){var n=e[0],i=e[1],o=e[2];return t[0]=n*r[0]+i*r[3]+o*r[6],t[1]=n*r[1]+i*r[4]+o*r[7],t[2]=n*r[2]+i*r[5]+o*r[8],t},o.transformQuat=function(t,e,r){var n=e[0],i=e[1],o=e[2],s=r[0],a=r[1],h=r[2],u=r[3],c=u*n+a*o-h*i,l=u*i+h*n-s*o,f=u*o+s*i-a*n,_=-s*n-a*i-h*o;return t[0]=c*u+_*-s+l*-h-f*-a,t[1]=l*u+_*-a+f*-s-c*-h,t[2]=f*u+_*-h+c*-a-l*-s,t},o.forEach=function(){var t=o.create();return function(e,r,n,i,o,s){var a,h;for(r||(r=3),n||(n=0),h=i?Math.min(i*r+n,e.length):e.length,a=n;h>a;a+=r)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],o(t,t,s),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}}(),o.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},t.vec3=o;var s={};s.create=function(){var t=new r(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},s.clone=function(t){var e=new r(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},s.fromValues=function(t,e,n,i){var o=new r(4);return o[0]=t,o[1]=e,o[2]=n,o[3]=i,o},s.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},s.set=function(t,e,r,n,i){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t},s.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},s.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t},s.sub=s.subtract,s.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t},s.mul=s.multiply,s.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t},s.div=s.divide,s.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t},s.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t},s.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},s.scaleAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t},s.distance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return Math.sqrt(r*r+n*n+i*i+o*o)},s.dist=s.distance,s.squaredDistance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return r*r+n*n+i*i+o*o},s.sqrDist=s.squaredDistance,s.length=function(t){var e=t[0],r=t[1],n=t[2],i=t[3];return Math.sqrt(e*e+r*r+n*n+i*i)},s.len=s.length,s.squaredLength=function(t){var e=t[0],r=t[1],n=t[2],i=t[3];return e*e+r*r+n*n+i*i},s.sqrLen=s.squaredLength,s.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},s.normalize=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],s=r*r+n*n+i*i+o*o;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s),t},s.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},s.lerp=function(t,e,r,n){var i=e[0],o=e[1],s=e[2],a=e[3];return t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t[2]=s+n*(r[2]-s),t[3]=a+n*(r[3]-a),t},s.random=function(t,e){return e=e||1,t[0]=n(),t[1]=n(),t[2]=n(),t[3]=n(),s.normalize(t,t),s.scale(t,t,e),t},s.transformMat4=function(t,e,r){var n=e[0],i=e[1],o=e[2],s=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*s,t[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*s,t[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*s,t[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*s,t},s.transformQuat=function(t,e,r){var n=e[0],i=e[1],o=e[2],s=r[0],a=r[1],h=r[2],u=r[3],c=u*n+a*o-h*i,l=u*i+h*n-s*o,f=u*o+s*i-a*n,_=-s*n-a*i-h*o;return t[0]=c*u+_*-s+l*-h-f*-a,t[1]=l*u+_*-a+f*-s-c*-h,t[2]=f*u+_*-h+c*-a-l*-s,t},s.forEach=function(){var t=s.create();return function(e,r,n,i,o,s){var a,h;for(r||(r=4),n||(n=0),h=i?Math.min(i*r+n,e.length):e.length,a=n;h>a;a+=r)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],o(t,t,s),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}}(),s.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},t.vec4=s;var a={};a.create=function(){var t=new r(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},a.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},a.clone=function(t){var e=new r(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},a.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},a.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},a.transpose=function(t,e){if(t===e){var r=e[1],n=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},a.invert=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],s=e[4],a=e[5],h=e[6],u=e[7],c=e[8],l=c*s-a*u,f=-c*o+a*h,_=u*o-s*h,d=r*l+n*f+i*_;return d?(d=1/d,t[0]=l*d,t[1]=(-c*n+i*u)*d,t[2]=(a*n-i*s)*d,t[3]=f*d,t[4]=(c*r-i*h)*d,t[5]=(-a*r+i*o)*d,t[6]=_*d,t[7]=(-u*r+n*h)*d,t[8]=(s*r-n*o)*d,t):null},a.adjoint=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],s=e[4],a=e[5],h=e[6],u=e[7],c=e[8];return t[0]=s*c-a*u,t[1]=i*u-n*c,t[2]=n*a-i*s,t[3]=a*h-o*c,t[4]=r*c-i*h,t[5]=i*o-r*a,t[6]=o*u-s*h,t[7]=n*h-r*u,t[8]=r*s-n*o,t},a.determinant=function(t){var e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],s=t[5],a=t[6],h=t[7],u=t[8];return e*(u*o-s*h)+r*(-u*i+s*a)+n*(h*i-o*a)},a.multiply=function(t,e,r){var n=e[0],i=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=e[6],c=e[7],l=e[8],f=r[0],_=r[1],d=r[2],v=r[3],m=r[4],b=r[5],p=r[6],g=r[7],A=r[8];return t[0]=f*n+_*s+d*u,t[1]=f*i+_*a+d*c,t[2]=f*o+_*h+d*l,t[3]=v*n+m*s+b*u,t[4]=v*i+m*a+b*c,t[5]=v*o+m*h+b*l,t[6]=p*n+g*s+A*u,t[7]=p*i+g*a+A*c,t[8]=p*o+g*h+A*l,t},a.mul=a.multiply,a.translate=function(t,e,r){var n=e[0],i=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=e[6],c=e[7],l=e[8],f=r[0],_=r[1];return t[0]=n,t[1]=i,t[2]=o,t[3]=s,t[4]=a,t[5]=h,t[6]=f*n+_*s+u,t[7]=f*i+_*a+c,t[8]=f*o+_*h+l,t},a.rotate=function(t,e,r){var n=e[0],i=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=e[6],c=e[7],l=e[8],f=Math.sin(r),_=Math.cos(r);return t[0]=_*n+f*s,t[1]=_*i+f*a,t[2]=_*o+f*h,t[3]=_*s-f*n,t[4]=_*a-f*i,t[5]=_*h-f*o,t[6]=u,t[7]=c,t[8]=l,t},a.fromQuat=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],s=r+r,a=n+n,h=i+i,u=r*s,c=r*a,l=r*h,f=n*a,_=n*h,d=i*h,v=o*s,m=o*a,b=o*h;return t[0]=1-(f+d),t[3]=c+b,t[6]=l-m,t[1]=c-b,t[4]=1-(u+d),t[7]=_+v,t[2]=l+m,t[5]=_-v,t[8]=1-(u+f),t},a.normalFromMat4=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],s=e[4],a=e[5],h=e[6],u=e[7],c=e[8],l=e[9],f=e[10],_=e[11],d=e[12],v=e[13],m=e[14],b=e[15],p=r*a-n*s,g=r*h-i*s,A=r*u-o*s,y=n*h-i*a,C=n*u-o*a,R=i*u-o*h,S=c*v-l*d,w=c*m-f*d,E=c*b-_*d,x=l*m-f*v,T=l*b-_*v,M=f*b-_*m,F=p*M-g*T+A*x+y*E-C*w+R*S;return F?(F=1/F,t[0]=(a*M-h*T+u*x)*F,t[1]=(h*E-s*M-u*w)*F,t[2]=(s*T-a*E+u*S)*F,t[3]=(i*T-n*M-o*x)*F,t[4]=(r*M-i*E+o*w)*F,t[5]=(n*E-r*T-o*S)*F,t[6]=(v*R-m*C+b*y)*F,t[7]=(m*A-d*R-b*g)*F,t[8]=(d*C-v*A+b*p)*F,t):null},a.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},t.mat3=a;var h={};h.create=function(){var t=new r(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},h.fromValues=function(t,e,n,i,o,s,a,h,u,c,l,f,_,d,v,m){var b=new r(16);return b[0]=t,b[1]=e,b[2]=n,b[3]=i,b[4]=o,b[5]=s,b[6]=a,b[7]=h,b[8]=u,b[9]=c,b[10]=l,b[11]=f,b[12]=_,b[13]=d,b[14]=v,b[15]=m,b},h.clone=function(t){var e=new r(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},h.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},h.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},h.transpose=function(t,e){if(t===e){var r=e[1],n=e[2],i=e[3],o=e[6],s=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=o,t[11]=e[14],t[12]=i,t[13]=s,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},h.invert=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],s=e[4],a=e[5],h=e[6],u=e[7],c=e[8],l=e[9],f=e[10],_=e[11],d=e[12],v=e[13],m=e[14],b=e[15],p=r*a-n*s,g=r*h-i*s,A=r*u-o*s,y=n*h-i*a,C=n*u-o*a,R=i*u-o*h,S=c*v-l*d,w=c*m-f*d,E=c*b-_*d,x=l*m-f*v,T=l*b-_*v,M=f*b-_*m,F=p*M-g*T+A*x+y*E-C*w+R*S;return F?(F=1/F,t[0]=(a*M-h*T+u*x)*F,t[1]=(i*T-n*M-o*x)*F,t[2]=(v*R-m*C+b*y)*F,t[3]=(f*C-l*R-_*y)*F,t[4]=(h*E-s*M-u*w)*F,t[5]=(r*M-i*E+o*w)*F,t[6]=(m*A-d*R-b*g)*F,t[7]=(c*R-f*A+_*g)*F,t[8]=(s*T-a*E+u*S)*F,t[9]=(n*E-r*T-o*S)*F,t[10]=(d*C-v*A+b*p)*F,t[11]=(l*A-c*C-_*p)*F,t[12]=(a*w-s*x-h*S)*F,t[13]=(r*x-n*w+i*S)*F,t[14]=(v*g-d*y-m*p)*F,t[15]=(c*y-l*g+f*p)*F,t):null},h.adjoint=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],s=e[4],a=e[5],h=e[6],u=e[7],c=e[8],l=e[9],f=e[10],_=e[11],d=e[12],v=e[13],m=e[14],b=e[15];return t[0]=a*(f*b-_*m)-l*(h*b-u*m)+v*(h*_-u*f),t[1]=-(n*(f*b-_*m)-l*(i*b-o*m)+v*(i*_-o*f)),t[2]=n*(h*b-u*m)-a*(i*b-o*m)+v*(i*u-o*h),t[3]=-(n*(h*_-u*f)-a*(i*_-o*f)+l*(i*u-o*h)),t[4]=-(s*(f*b-_*m)-c*(h*b-u*m)+d*(h*_-u*f)),t[5]=r*(f*b-_*m)-c*(i*b-o*m)+d*(i*_-o*f),t[6]=-(r*(h*b-u*m)-s*(i*b-o*m)+d*(i*u-o*h)),t[7]=r*(h*_-u*f)-s*(i*_-o*f)+c*(i*u-o*h),t[8]=s*(l*b-_*v)-c*(a*b-u*v)+d*(a*_-u*l),t[9]=-(r*(l*b-_*v)-c*(n*b-o*v)+d*(n*_-o*l)),t[10]=r*(a*b-u*v)-s*(n*b-o*v)+d*(n*u-o*a),t[11]=-(r*(a*_-u*l)-s*(n*_-o*l)+c*(n*u-o*a)),t[12]=-(s*(l*m-f*v)-c*(a*m-h*v)+d*(a*f-h*l)),t[13]=r*(l*m-f*v)-c*(n*m-i*v)+d*(n*f-i*l),t[14]=-(r*(a*m-h*v)-s*(n*m-i*v)+d*(n*h-i*a)),t[15]=r*(a*f-h*l)-s*(n*f-i*l)+c*(n*h-i*a),t},h.determinant=function(t){var e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],s=t[5],a=t[6],h=t[7],u=t[8],c=t[9],l=t[10],f=t[11],_=t[12],d=t[13],v=t[14],m=t[15],b=e*s-r*o,p=e*a-n*o,g=e*h-i*o,A=r*a-n*s,y=r*h-i*s,C=n*h-i*a,R=u*d-c*_,S=u*v-l*_,w=u*m-f*_,E=c*v-l*d,x=c*m-f*d,T=l*m-f*v;return b*T-p*x+g*E+A*w-y*S+C*R},h.multiply=function(t,e,r){var n=e[0],i=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=e[6],c=e[7],l=e[8],f=e[9],_=e[10],d=e[11],v=e[12],m=e[13],b=e[14],p=e[15],g=r[0],A=r[1],y=r[2],C=r[3];return t[0]=g*n+A*a+y*l+C*v,t[1]=g*i+A*h+y*f+C*m,t[2]=g*o+A*u+y*_+C*b,t[3]=g*s+A*c+y*d+C*p,g=r[4],A=r[5],y=r[6],C=r[7],t[4]=g*n+A*a+y*l+C*v,t[5]=g*i+A*h+y*f+C*m,t[6]=g*o+A*u+y*_+C*b,t[7]=g*s+A*c+y*d+C*p,g=r[8],A=r[9],y=r[10],C=r[11],t[8]=g*n+A*a+y*l+C*v,t[9]=g*i+A*h+y*f+C*m,t[10]=g*o+A*u+y*_+C*b,t[11]=g*s+A*c+y*d+C*p,g=r[12],A=r[13],y=r[14],C=r[15],t[12]=g*n+A*a+y*l+C*v,t[13]=g*i+A*h+y*f+C*m,t[14]=g*o+A*u+y*_+C*b,t[15]=g*s+A*c+y*d+C*p,t},h.fromMat3=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=0,t[4]=e[3],t[5]=e[4],t[6]=e[5],t[7]=0,t[8]=e[6],t[9]=e[7],t[10]=e[8],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},h.mul=h.multiply,h.translate=function(t,e,r){var n,i,o,s,a,h,u,c,l,f,_,d,v=r[0],m=r[1],b=r[2];return e===t?(t[12]=e[0]*v+e[4]*m+e[8]*b+e[12],t[13]=e[1]*v+e[5]*m+e[9]*b+e[13],t[14]=e[2]*v+e[6]*m+e[10]*b+e[14],t[15]=e[3]*v+e[7]*m+e[11]*b+e[15]):(n=e[0],i=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=e[6],c=e[7],l=e[8],f=e[9],_=e[10],d=e[11],t[0]=n,t[1]=i,t[2]=o,t[3]=s,t[4]=a,t[5]=h,t[6]=u,t[7]=c,t[8]=l,t[9]=f,t[10]=_,t[11]=d,t[12]=n*v+a*m+l*b+e[12],t[13]=i*v+h*m+f*b+e[13],t[14]=o*v+u*m+_*b+e[14],t[15]=s*v+c*m+d*b+e[15]),t},h.scale=function(t,e,r){var n=r[0],i=r[1],o=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},h.rotate=function(t,r,n,i){var o,s,a,h,u,c,l,f,_,d,v,m,b,p,g,A,y,C,R,S,w,E,x,T,M=i[0],F=i[1],I=i[2],D=Math.sqrt(M*M+F*F+I*I);return Math.abs(D)<e?null:(D=1/D,M*=D,F*=D,I*=D,o=Math.sin(n),s=Math.cos(n),a=1-s,h=r[0],u=r[1],c=r[2],l=r[3],f=r[4],_=r[5],d=r[6],v=r[7],m=r[8],b=r[9],p=r[10],g=r[11],A=M*M*a+s,y=F*M*a+I*o,C=I*M*a-F*o,R=M*F*a-I*o,S=F*F*a+s,w=I*F*a+M*o,E=M*I*a+F*o,x=F*I*a-M*o,T=I*I*a+s,t[0]=h*A+f*y+m*C,t[1]=u*A+_*y+b*C,t[2]=c*A+d*y+p*C,t[3]=l*A+v*y+g*C,t[4]=h*R+f*S+m*w,t[5]=u*R+_*S+b*w,t[6]=c*R+d*S+p*w,t[7]=l*R+v*S+g*w,t[8]=h*E+f*x+m*T,t[9]=u*E+_*x+b*T,t[10]=c*E+d*x+p*T,t[11]=l*E+v*x+g*T,r!==t&&(t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t)},h.rotateX=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[4],s=e[5],a=e[6],h=e[7],u=e[8],c=e[9],l=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+u*n,t[5]=s*i+c*n,t[6]=a*i+l*n,t[7]=h*i+f*n,t[8]=u*i-o*n,t[9]=c*i-s*n,t[10]=l*i-a*n,t[11]=f*i-h*n,t},h.rotateY=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[0],s=e[1],a=e[2],h=e[3],u=e[8],c=e[9],l=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-u*n,t[1]=s*i-c*n,t[2]=a*i-l*n,t[3]=h*i-f*n,t[8]=o*n+u*i,t[9]=s*n+c*i,t[10]=a*n+l*i,t[11]=h*n+f*i,t},h.rotateZ=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[0],s=e[1],a=e[2],h=e[3],u=e[4],c=e[5],l=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+u*n,t[1]=s*i+c*n,t[2]=a*i+l*n,t[3]=h*i+f*n,t[4]=u*i-o*n,t[5]=c*i-s*n,t[6]=l*i-a*n,t[7]=f*i-h*n,t},h.fromRotationTranslation=function(t,e,r){var n=e[0],i=e[1],o=e[2],s=e[3],a=n+n,h=i+i,u=o+o,c=n*a,l=n*h,f=n*u,_=i*h,d=i*u,v=o*u,m=s*a,b=s*h,p=s*u;return t[0]=1-(_+v),t[1]=l+p,t[2]=f-b,t[3]=0,t[4]=l-p,t[5]=1-(c+v),t[6]=d+m,t[7]=0,t[8]=f+b,t[9]=d-m,t[10]=1-(c+_),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},h.fromQuat=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],s=r+r,a=n+n,h=i+i,u=r*s,c=r*a,l=r*h,f=n*a,_=n*h,d=i*h,v=o*s,m=o*a,b=o*h;return t[0]=1-(f+d),t[1]=c+b,t[2]=l-m,t[3]=0,t[4]=c-b,t[5]=1-(u+d),t[6]=_+v,t[7]=0,t[8]=l+m,t[9]=_-v,t[10]=1-(u+f),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},h.frustum=function(t,e,r,n,i,o,s){var a=1/(r-e),h=1/(i-n),u=1/(o-s);return t[0]=2*o*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*h,t[6]=0,t[7]=0,t[8]=(r+e)*a,t[9]=(i+n)*h,t[10]=(s+o)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*o*2*u,t[15]=0,t},h.perspective=function(t,e,r,n,i){var o=1/Math.tan(e/2),s=1/(n-i);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(i+n)*s,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*i*n*s,t[15]=0,t},h.ortho=function(t,e,r,n,i,o,s){var a=1/(e-r),h=1/(n-i),u=1/(o-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+r)*a,t[13]=(i+n)*h,t[14]=(s+o)*u,t[15]=1,t},h.lookAt=function(t,r,n,i){var o,s,a,u,c,l,f,_,d,v,m=r[0],b=r[1],p=r[2],g=i[0],A=i[1],y=i[2],C=n[0],R=n[1],S=n[2];return Math.abs(m-C)<e&&Math.abs(b-R)<e&&Math.abs(p-S)<e?h.identity(t):(f=m-C,_=b-R,d=p-S,v=1/Math.sqrt(f*f+_*_+d*d),f*=v,_*=v,d*=v,o=A*d-y*_,s=y*f-g*d,a=g*_-A*f,v=Math.sqrt(o*o+s*s+a*a),v?(v=1/v,o*=v,s*=v,a*=v):(o=0,s=0,a=0),u=_*a-d*s,c=d*o-f*a,l=f*s-_*o,v=Math.sqrt(u*u+c*c+l*l),v?(v=1/v,u*=v,c*=v,l*=v):(u=0,c=0,l=0),t[0]=o,t[1]=u,t[2]=f,t[3]=0,t[4]=s,t[5]=c,t[6]=_,t[7]=0,t[8]=a,t[9]=l,t[10]=d,t[11]=0,t[12]=-(o*m+s*b+a*p),t[13]=-(u*m+c*b+l*p),t[14]=-(f*m+_*b+d*p),t[15]=1,t)},h.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},t.mat4=h;var u={};return u.create=function(){var t=new r(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},u.rotationTo=function(){var t=o.create(),e=o.fromValues(1,0,0),r=o.fromValues(0,1,0);return function(n,i,s){var a=o.dot(i,s);return-.999999>a?(o.cross(t,e,i),o.length(t)<1e-6&&o.cross(t,r,i),o.normalize(t,t),u.setAxisAngle(n,t,Math.PI),n):a>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(o.cross(t,i,s),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+a,u.normalize(n,n))}}(),u.setAxes=function(){var t=a.create();return function(e,r,n,i){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=r[0],t[5]=r[1],t[8]=r[2],u.normalize(e,u.fromMat3(e,t))}}(),u.clone=s.clone,u.fromValues=s.fromValues,u.copy=s.copy,u.set=s.set,u.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},u.setAxisAngle=function(t,e,r){r=.5*r;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t},u.add=s.add,u.multiply=function(t,e,r){var n=e[0],i=e[1],o=e[2],s=e[3],a=r[0],h=r[1],u=r[2],c=r[3];return t[0]=n*c+s*a+i*u-o*h,t[1]=i*c+s*h+o*a-n*u,t[2]=o*c+s*u+n*h-i*a,t[3]=s*c-n*a-i*h-o*u,t},u.mul=u.multiply,u.scale=s.scale,u.rotateX=function(t,e,r){r*=.5;var n=e[0],i=e[1],o=e[2],s=e[3],a=Math.sin(r),h=Math.cos(r);return t[0]=n*h+s*a,t[1]=i*h+o*a,t[2]=o*h-i*a,t[3]=s*h-n*a,t},u.rotateY=function(t,e,r){r*=.5;var n=e[0],i=e[1],o=e[2],s=e[3],a=Math.sin(r),h=Math.cos(r);return t[0]=n*h-o*a,t[1]=i*h+s*a,t[2]=o*h+n*a,t[3]=s*h-i*a,t},u.rotateZ=function(t,e,r){r*=.5;var n=e[0],i=e[1],o=e[2],s=e[3],a=Math.sin(r),h=Math.cos(r);return t[0]=n*h+i*a,t[1]=i*h-n*a,t[2]=o*h+s*a,t[3]=s*h-o*a,t},u.calculateW=function(t,e){var r=e[0],n=e[1],i=e[2];return t[0]=r,t[1]=n,t[2]=i,t[3]=-Math.sqrt(Math.abs(1-r*r-n*n-i*i)),t},u.dot=s.dot,u.lerp=s.lerp,u.slerp=function(t,e,r,n){var i,o,s,a,h,u=e[0],c=e[1],l=e[2],f=e[3],_=r[0],d=r[1],v=r[2],m=r[3];return o=u*_+c*d+l*v+f*m,0>o&&(o=-o,_=-_,d=-d,v=-v,m=-m),1-o>1e-6?(i=Math.acos(o),s=Math.sin(i),a=Math.sin((1-n)*i)/s,h=Math.sin(n*i)/s):(a=1-n,h=n),t[0]=a*u+h*_,t[1]=a*c+h*d,t[2]=a*l+h*v,t[3]=a*f+h*m,t},u.invert=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],s=r*r+n*n+i*i+o*o,a=s?1/s:0;return t[0]=-r*a,t[1]=-n*a,t[2]=-i*a,t[3]=o*a,t},u.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},u.length=s.length,u.len=u.length,u.squaredLength=s.squaredLength,u.sqrLen=u.squaredLength,u.normalize=s.normalize,u.fromMat3=function(){var t="undefined"!=typeof Int8Array?new Int8Array([1,2,0]):[1,2,0];return function(e,r){var n,i=r[0]+r[4]+r[8];if(i>0)n=Math.sqrt(i+1),e[3]=.5*n,n=.5/n,e[0]=(r[7]-r[5])*n,e[1]=(r[2]-r[6])*n,e[2]=(r[3]-r[1])*n;else{var o=0;r[4]>r[0]&&(o=1),r[8]>r[3*o+o]&&(o=2);var s=t[o],a=t[s];n=Math.sqrt(r[3*o+o]-r[3*s+s]-r[3*a+a]+1),e[o]=.5*n,n=.5/n,e[3]=(r[3*a+s]-r[3*s+a])*n,e[s]=(r[3*s+o]+r[3*o+s])*n,e[a]=(r[3*a+o]+r[3*o+a])*n}return e}}(),u.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},t.quat=u,t}(),e=function(){"use strict";function e(t,e){this._G=t;for(var r=0;r<this._G.length;++r)this._G[r]=s.forceRGB(this._G[r]);this._V=e}function r(t,e,r){this.colorFor=t,this._dD=e,this._dw=r}function n(t,e,r){var n=null,i=null;return t[e](function(t){var e=t.prop(r);return null===n&&null===i?void(n=i=e):(n=Math.min(n,e),void(i=Math.max(i,e)))}),{min:n,max:i}}function i(t,e,i,o,s){return e||(e=c("rainbow")),new r(function(r,n,i){var o=0;this._y!==this._B&&(o=(s(r).prop(t)-this._y)/(this._B-this._y)),f(n,i,e,o)},function(e){return void 0!==i?(this._y=i[0],void(this._B=i[1])):(i=n(e,o,t),this._y=i.min,void(this._B=i.max))},function(){})}var o=t.vec4,s={};s.rgb={};var a=s.rgb;s.rgb.create=o.create,s.rgb.scale=o.scale,s.rgb.copy=o.copy,s.rgb.clone=o.clone,s.rgb.fromValues=o.fromValues,s.rgb.mix=function(t,e,r,n){var i=1-n;return t[0]=e[0]*n+r[0]*i,t[1]=e[1]*n+r[1]*i,t[2]=e[2]*n+r[2]*i,t[3]=e[3]*n+r[3]*i,t};var h={white:a.fromValues(1,1,1,1),black:a.fromValues(0,0,0,1),grey:a.fromValues(.5,.5,.5,1),lightgrey:a.fromValues(.8,.8,.8,1),darkgrey:a.fromValues(.3,.3,.3,1),red:a.fromValues(1,0,0,1),darkred:a.fromValues(.5,0,0,1),lightred:a.fromValues(1,.5,.5,1),green:a.fromValues(0,1,0,1),darkgreen:a.fromValues(0,.5,0,1),lightgreen:a.fromValues(.5,1,.5,1),blue:a.fromValues(0,0,1,1),darkblue:a.fromValues(0,0,.5,1),lightblue:a.fromValues(.5,.5,1,1),yellow:a.fromValues(1,1,0,1),darkyellow:a.fromValues(.5,.5,0,1),lightyellow:a.fromValues(1,1,.5,1),cyan:a.fromValues(0,1,1,1),darkcyan:a.fromValues(0,.5,.5,1),lightcyan:a.fromValues(.5,1,1,1),magenta:a.fromValues(1,0,1,1),darkmagenta:a.fromValues(.5,0,.5,1),lightmagenta:a.fromValues(1,.5,1,1),orange:a.fromValues(1,.5,0,1),darkorange:a.fromValues(.5,.25,0,1),lightorange:a.fromValues(1,.75,.5,1)};s.hex2rgb=function(t,e){e=void 0===e?1:+e;var r,n,i,o;if(4===t.length||5===t.length){r=parseInt(t[1],16),n=parseInt(t[2],16),i=parseInt(t[3],16),o=Math.round(15*e),5===t.length&&(o=parseInt(t[4],16));var s=1/15;return a.fromValues(s*r,s*n,s*i,s*o)}if(7===t.length||9===t.length){r=parseInt(t.substr(1,2),16),n=parseInt(t.substr(3,2),16),i=parseInt(t.substr(5,2),16),o=Math.round(255*e),9===t.length&&(o=parseInt(t.substr(7,2),16));var h=1/255;return a.fromValues(h*r,h*n,h*i,h*o)}},s.setColorPalette=function(t){h=t,s.initGradients()},s.forceRGB=function(t,e){if(e=void 0===e?1:+e,"string"==typeof t){var r=h[t];if(void 0!==r&&(t=a.clone(r),t[3]=e),t.length>0&&"#"===t[0])return s.hex2rgb(t,e)}return 3===t.length?[t[0],t[1],t[2],e]:t},e.prototype={colorAt:function(t,e){if(e<=this._V[0])return o.copy(t,this._G[0]);if(e>=this._V[this._V.length-1])return o.copy(t,this._G[this._V.length-1]);for(var r=0,n=1;n<this._V.length&&!(this._V[n]>e);++n)r=n;var i=r+1,s=this._V[r],h=this._V[i],u=(e-s)/(h-s);return a.mix(t,this._G[i],this._G[r],u)}};var u={};s.gradient=function(t,r){if("string"==typeof t)return u[t];if(r=r||"equal","equal"===r){r=[];for(var n=0;n<t.length;++n)r.push(1*n/(t.length-1))}return new e(t,r)};var c=s.gradient;s.initGradients=function(){u.rainbow=c(["blue","green","yellow","red"]),u.reds=c(["lightred","darkred"]),u.greens=c(["lightgreen","darkgreen"]),u.blues=c(["lightblue","darkblue"]),u.trafficlight=c(["green","yellow","red"]),u.heatmap=c(["red","white","blue"])},r.prototype={begin:function(t){this._dD&&this._dD(t)},end:function(t){this._dw&&this._dw(t)}},s.ColorOp=r,s.uniform=function(t){return t=s.forceRGB(t||"white"),new r(function(e,r,n){r[n+0]=t[0],r[n+1]=t[1],r[n+2]=t[2],r[n+3]=t[3]},null,null)};var l={H:[.87,.87,.87],C:[.61,.61,.61],N:[0,.47,.84],O:[.97,.18,.18],F:[.12,.94,.12],CL:[.12,.94,.12],BR:[.6,.13,0],I:[.4,0,.73],HE:[0,1,1],NE:[0,1,1],AR:[0,1,1],XE:[0,1,1],KR:[0,1,1],P:[1,.43,.13],S:[1,.73,.22],B:[1,.67,.47],LI:[.47,0,1],NA:[.47,0,1],K:[.47,0,1],RB:[.47,0,1],CS:[.47,0,1],FR:[.47,0,1],BE:[0,.47,0],MG:[0,.47,0],SR:[0,.47,0],BA:[0,.47,0],RA:[0,.47,0],TI:[.6,.6,.6],FE:[.56,.31,.12]};s.byElement=function(t){return t||(t=l),new r(function(e,r,n){var i=e.element(),o=t[i];return void 0!==o?(r[n]=o[0],r[n+1]=o[1],r[n+2]=o[2],r[n+3]=1,r):(r[n]=1,r[n+1]=0,r[n+2]=1,r[n+3]=1,r)},null,null)},s.bySS=function(t){var e;return e=t&&t._G?{C:t._G[0],H:t._G[1],E:t._G[2]}:t?{C:s.forceRGB(t.C),H:s.forceRGB(t.H),E:s.forceRGB(t.E)}:{C:[.8,.8,.8,1],H:[.6,.6,.9,1],E:[.2,.8,.2,1]},new r(function(t,r,n){var i=t.residue().ss(),o=e[i];void 0!==o&&(r[n]=o[0],r[n+1]=o[1],r[n+2]=o[2],r[n+3]=o[3])},null,null)},s.rainbow=function(t){t||(t=c("rainbow"));var e=new r(function(e,r,n){var i=0,o=this.chainLimits[e.residue().chain().name()];if(void 0!==o){var s=e.residue().index();i=(s-o[0])/(o[1]-o[0])}var a=[1,1,1,1];t.colorAt(a,i),r[n]=a[0],r[n+1]=a[1],r[n+2]=a[2],r[n+3]=a[3]},function(t){var e=t.chains();this.chainLimits={};for(var r=0;r<e.length;++r){var n=e[r].backboneTraces();if(0!==n.length){for(var i=n[0].residueAt(0).index(),o=n[0].residueAt(n[0].length()-1).index(),s=1;s<n.length;++s){var a=n[s];i=Math.min(i,a.residueAt(0).index()),o=Math.max(o,a.residueAt(a.length()-1).index())}i!==o&&(this.chainLimits[e[r].name()]=[i,o])}}},function(){this.chainLimits=null});return e},s.ssSuccession=function(t,e){t||(t=c("rainbow")),e=e?s.forceRGB(e):s.forceRGB("lightgrey");var n=new r(function(r,n,i){var o=r.residue().index(),s=this.chainLimits[r.residue().chain().name()],a=s.indices[o];if(-1===a)return n[i]=e[0],n[i+1]=e[1],n[i+2]=e[2],void(n[i+3]=e[3]);var h=0;null===s.max,null!==s.max&&(h=a/(s.max>0?s.max:1));var u=[0,0,0,0];t.colorAt(u,h),n[i]=u[0],n[i+1]=u[1],n[i+2]=u[2],n[i+3]=u[3]},function(t){var e=t.chains();this.chainLimits={};for(var r=0;r<e.length;++r){for(var n=e[r].residues(),i=null,o={},s=0,a="C",h=0;h<n.length;++h){var u=n[h].ss();"C"===u?("C"!==a&&s++,o[n[h].index()]=-1):(i=s,o[n[h].index()]=s),a=u}this.chainLimits[e[r].name()]={indices:o,max:i}}},function(){this.chainLimits=null});return n},s.byChain=function(t){t||(t=c("rainbow"));var e=new r(function(e,r,n){var i=this.chainIndices[e.residue().chain().name()],o=i*this.scale,s=[0,0,0,0];t.colorAt(s,o),r[n+0]=s[0],r[n+1]=s[1],r[n+2]=s[2],r[n+3]=s[3]},function(t){var e=t.chains();this.chainIndices={};for(var r=0;r<e.length;++r)this.chainIndices[e[r].name()]=r;this.scale=e.length>1?1/(e.length-1):1},function(){this.chainIndices=null});return e};var f=function(){var t=o.create();return function(e,r,n,i){n.colorAt(t,i),e[r+0]=t[0],e[r+1]=t[1],e[r+2]=t[2],e[r+3]=t[3]}}();return s.byAtomProp=function(t,e,r){return i(t,e,r,"eachAtom",function(t){return t})},s.byResidueProp=function(t,e,r){return i(t,e,r,"eachResidue",function(t){return t.residue()})},s.interpolateColor=function(t,e){for(var r=new Float32Array(4*(e*(t.length/4-1)+1)),n=0,i=o.create(),s=o.create(),a=e/2,h=0;h<t.length/4-1;++h){o.set(i,t[4*h+0],t[4*h+1],t[4*h+2],t[4*h+3]),o.set(s,t[4*h+4],t[4*h+5],t[4*h+6],t[4*h+7]);for(var u=0;e>u;++u){var c=a>u?0:1;r[n+0]=i[0]*(1-c)+s[0]*c,r[n+1]=i[1]*(1-c)+s[1]*c,r[n+2]=i[2]*(1-c)+s[2]*c,r[n+3]=i[3]*(1-c)+s[3]*c,n+=4}}return r[n+0]=s[0],r[n+1]=s[1],r[n+2]=s[2],r[n+3]=s[3],r},s.initGradients(),s}(),r=function(){"use strict";function t(t,e,r){this._c3=t,this._bw=e,this._bE=e,this._dx=r}function e(){this.clear()}return t.prototype={nextId:function(t){var e=this._bE;return this._bE++,this._c3._m[e]=t,e},hasLeft:function(){return this._bE<this._dx},recycle:function(){this._c3.recycle(this)},length:function(){return this._dx-this._bw}},e.prototype={MAX_ID:16777216,getContinuousRange:function(e){for(var r=-1,n=null,i=0;i<this._bp.length;++i){var o=this._bp[i],s=o.length();s>=e&&(null===n||n>s)&&(n=s,r=i)}if(-1!==r){var a=this._bp[r];return this._bp.splice(r,1),this._bM++,a}var h=this._cN,u=h+e;if(u>this.MAX_ID)return null;this._cN=u;var c=new t(this,h,u);return this._bM++,c},clear:function(){this._m={},this._cN=1,this._bp=[],this._bM=0},recycle:function(t){for(var e=t._bw;e<t._bE;++e)delete this._m[e];t._bE=t._bw,this._bp.push(t),this._bM--,this._bp.length>0&&0===this._bM&&this.clear()},objectForId:function(t){return this._m[t]}},e}(),n=function(){"use strict";function t(t,e){return e>t}function e(t,e){void 0===t||void 0===e?(this._b6=!0,this._y=this._B=null):(this._b6=!1,this._y=t,this._B=e)}var r={};return r.derive=function(t,e,r){for(var n in e.prototype)t.prototype[n]=e.prototype[n];if(void 0!==r)for(var i in r)t.prototype[i]=r[i]},r.bind=function(t,e){return function(){return e.apply(t,arguments)}},r.update=function(t,e){e=e||{};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t},r.copy=function(t){var e={};return r.update(e,t),e},r.binarySearch=function(e,r,n){if(0===e.length)return-1;n=n||t;for(var i=0,o=e.length,s=i+o>>1;;){var a=e[s];if(n(r,a))o=s;else{if(!n(a,r))return s;i=s}var h=i+o>>1;if(h===s)return-1;
s=h}return-1},r.indexFirstLargerEqualThan=function(e,r,n){if(n=n||t,0===e.length||n(e[e.length-1],r))return-1;for(var i=0,o=e.length,s=i+o>>1;;){var a=e[s];n(r,a)?o=s:n(a,r)?i=s+1:o=s;var h=i+o>>1;if(h===s)return s;s=h}},r.indexLastSmallerThan=function(e,r,n){if(n=n||t,0===e.length||n(e[e.length-1],r))return e.length-1;if(n(r,e[0])||!n(e[0],r))return-1;for(var i=0,o=e.length,s=i+o>>1;;){var a=e[s];n(r,a)||!n(a,r)?o=s:i=s;var h=i+o>>1;if(h===s)return s;s=h}},r.indexLastSmallerEqualThan=function(e,r,n){if(n=n||t,0===e.length||n(e[e.length-1],r))return e.length-1;if(n(r,e[0]))return-1;for(var i=0,o=e.length,s=i+o>>1;;){var a=e[s];n(r,a)?o=s:i=s;var h=i+o>>1;if(h===s)return s;s=h}},e.prototype={min:function(){return this._y},max:function(){return this._B},length:function(){return this._B-this._y},empty:function(){return this._b6},center:function(){return.5*(this._B+this._y)},extend:function(t){this._y-=t,this._B+=t},update:function(t){return this._b6?(this._y=this._B=t,void(this._b6=!1)):void(t<this._y?this._y=t:t>this._B&&(this._B=t))}},r.Range=e,r}(),i=function(){"use strict";function t(t){if("complete"!==document.readyState&&"loaded"!==document.readyState&&"interactive"!==document.readyState)return!1;if(void 0===t)try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("experimental-webgl"))}catch(r){return!1}return!!t}function e(t,e){this._k=e.width,this._dF=e.antialias,this._l=e.height,this._6=!1,this._eg=null,this._F=t,this._ct(),this._cJ=e.backgroundColor,this._do=e.forceManualAntialiasing}return e.prototype={_cC:function(){if(this._6){this._6=!1;var t=this._k*this._bx,e=this._l*this._bx;this._bh=t,this._bi=e,this._b.viewport(0,0,t,e),this._c.width=t,this._c.height=e,this._bx>1&&this._dj(this._bx)}},resize:function(t,e){(t!==this._k||e!==this._l)&&(this._6=!0,this._k=t,this._l=e)},fitParent:function(){var t=this._F.getBoundingClientRect();this.resize(t.width,t.height)},gl:function(){return this._b},imageData:function(){return this._c.toDataURL()},_eo:function(){try{var t={antialias:this._dF&&!this._do,preserveDrawingBuffer:!0};this._b=this._c.getContext("experimental-webgl",t)}catch(e){return!1}return!!this._b},_dj:function(t){var e=1/t,r=.5*-(1-e)*this._bh,n=.5*-(1-e)*this._bi,i="translate("+r+"px, "+n+"px)",o="scale("+e+", "+e+")",s=i+" "+o;this._c.style.webkitTransform=s,this._c.style.transform=s,this._c.style.ieTransform=s,this._c.width=this._bh,this._c.height=this._bi},initGL:function(){var t=1;if(!this._eo())return!1;var e=this._b;return!e.getContextAttributes().antialias&&this._do&&this._dF&&(t=2),this._bh=this._k*t,this._bi=this._l*t,this._bx=t,t>1&&this._dj(t),e.viewportWidth=this._bh,e.viewportHeight=this._bi,e.clearColor(this._cJ[0],this._cJ[1],this._cJ[2],1),e.lineWidth(2),e.cullFace(e.FRONT),e.enable(e.CULL_FACE),e.enable(e.DEPTH_TEST),!0},_cT:function(t,e,r){var n,i=this._b;if("fragment"===e)n=i.createShader(i.FRAGMENT_SHADER);else{if("vertex"!==e)return null;n=i.createShader(i.VERTEX_SHADER)}var o=t.replace("${PRECISION}",r);return i.shaderSource(n,o),i.compileShader(n),i.getShaderParameter(n,i.COMPILE_STATUS)?n:null},initShader:function(t,e,r){var i=this._b,o=this._cT(e,"fragment",r),s=this._cT(t,"vertex",r),a=i.createProgram();if(i.attachShader(a,s),i.attachShader(a,o),i.linkProgram(a),!i.getProgramParameter(a,i.LINK_STATUS))return null;var h=n.bind(i,i.getAttribLocation),u=n.bind(i,i.getUniformLocation);return a.posAttrib=h(a,"attrPos"),a.colorAttrib=h(a,"attrColor"),a.normalAttrib=h(a,"attrNormal"),a.objIdAttrib=h(a,"attrObjId"),a.selectAttrib=h(a,"attrSelect"),a.symId=u(a,"symId"),a.projection=u(a,"projectionMat"),a.modelview=u(a,"modelviewMat"),a.rotation=u(a,"rotationMat"),a.fog=u(a,"fog"),a.fogFar=u(a,"fogFar"),a.fogNear=u(a,"fogNear"),a.fogColor=u(a,"fogColor"),a.outlineColor=u(a,"outlineColor"),a.outlineWidth=u(a,"outlineWidth"),a.relativePixelSize=u(a,"relativePixelSize"),a.screenDoorTransparency=u(a,"screenDoorTransparency"),a.selectionColor=u(a,"selectionColor"),a.pointSize=u(a,"pointSize"),a.zoom=u(a,"zoom"),a.outlineEnabled=u(a,"outlineEnabled"),a},on:function(t,e){this._c.addEventListener(t,e,!1)},removeEventListener:function(t,e){this._c.removeEventListener(t,e,!1)},onWheel:function(t,e){"onwheel"in this._c?this.on("wheel",t):this.on("mousewheel",e)},domElement:function(){return this._c},bind:function(){this._cC(),this._b.viewport(0,0,this._bh,this._bi)},superSamplingFactor:function(){return this._bx},viewportWidth:function(){return this._bh},viewportHeight:function(){return this._bi},width:function(){return this._k},height:function(){return this._l},_ct:function(){this._c=document.createElement("canvas"),this._c.width=this._k,this._c.height=this._l,this._F.appendChild(this._c)},isWebGLSupported:function(){return t(this._b)},destroy:function(){this._c.width=1,this._c.height=1,this._c.parentElement.removeChild(this._c),this._c=null}},{Canvas:e,isWebGLSupported:t}}(),o=function(){"use strict";function t(t,e){this._k=e.width,this._l=e.height,this._dA=this._k,this._dB=this._l,this._b=t,this._dz=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this._dz),this._bG=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this._bG),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,this._k,this._l),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this._bG),this._bI=t.createTexture(),this._ep()}return t.prototype={width:function(){return this._k},height:function(){return this._l},bind:function(){var t=this._b;t.bindFramebuffer(t.FRAMEBUFFER,this._dz),t.bindRenderbuffer(t.RENDERBUFFER,this._bG),(this._dA!==this._k||this._dB!==this._l)&&this._dU(),t.viewport(0,0,this._k,this._l)},colorTexture:function(){return this._bI},_ep:function(){this.bind();var t=this._b;t.bindTexture(t.TEXTURE_2D,this._bI),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this._k,this._l,0,t.RGBA,t.UNSIGNED_BYTE,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this._bI,0),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(t.TEXTURE_2D,null),this.release()},_dU:function(){var t=this._b;t.bindRenderbuffer(t.RENDERBUFFER,this._bG),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,this._k,this._l),t.bindTexture(t.TEXTURE_2D,this._bI),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this._k,this._l,0,t.RGBA,t.UNSIGNED_BYTE,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this._bI,0),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this._bG),t.bindTexture(t.TEXTURE_2D,null),this._dA=this._k,this._dB=this._l},resize:function(t,e){this._k=t,this._l=e},release:function(){var t=this._b;t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null)}},t}(),s=function(){"use strict";function t(t){this._bF=[],this._eC=t}return t.prototype.request=function(t){for(var e=-1,r=null,n=0;n<this._bF.length;++n){var i=this._bF[n],o=i.length;o>=t&&(null===r||r>o)&&(r=o,e=n)}if(-1!==e){var s=this._bF[e];return this._bF.splice(e,1),s}return new this._eC(t)},t.prototype.release=function(t){this._bF.push(t)},t}(),a=function(){"use strict";function e(t,e){if(t.length!==e.length)return!1;for(var r=0;r<t.length;++r)if(Math.abs(t[r]-e[r])>1e-6)return!1;return!0}function r(t){this._ci=o.create(),this._S=o.create(),this._dc=o.create(),this._o=o.create(),this._bN=o.create(),this._bj=.1,this._c6=[],this._ba=4e3,this._dp=-5,this._dq=50,this._b5=!0,this._cz=45*Math.PI/180,this._dr=n.fromValues(1,1,1),this._c5=n.fromValues(.1,.1,.1),this._cm=1,this._c4=!0,this._bP=i.fromValues(.1,1,.1,.7),this._R=n.create(),this._H=50,this._cV=!1,this._be=!0,this._I=!0,this._3=1,this._b=t,this._b8=null,this._bv=0,this.setViewportSize(t.viewportWidth,t.viewportHeight)}var n=t.vec3,i=t.vec4,o=t.mat4;return r.prototype={_7:function(){this._bv+=1,this._bv>68719476735&&(this._bv=0)},setOutlineEnabled:function(t){this._c4=t,this._7()},setScreenDoorTransparency:function(t){this._cV=t,this._7()},setOutlineWidth:function(t){this._cm!==t&&(this._cm=t,this._7())},addOnCameraChanged:function(t){this._c6.push(t)},_bo:function(){var t=this;this._c6.forEach(function(e){e(t)})},setRotation:function(t){var r=!1;16===t.length?e(this._o,t)||(o.copy(this._o,t),r=!0):(o.fromMat3(this._o,t),r=!0),r&&(this._bo(),this._I=!0)},upsamplingFactor:function(){return this._3},setUpsamplingFactor:function(t){if(this._3!==t){this._7(),this._3=t;var e=this._3/this._k,r=this._3/this._l;this._c0=new Float32Array([e,r])}},mainAxes:function(){return[n.fromValues(this._o[0],this._o[4],this._o[8]),n.fromValues(this._o[1],this._o[5],this._o[9]),n.fromValues(this._o[2],this._o[6],this._o[10])]},fieldOfViewY:function(){return this._cz},setFieldOfViewY:function(t){this._cz=t,this._be=!0},aspectRatio:function(){return this._k/this._l},rotation:function(){return this._o},_dL:function(){var t=!1;return this._I&&(o.identity(this._S),o.translate(this._S,this._S,[-this._R[0],-this._R[1],-this._R[2]]),o.mul(this._S,this._o,this._S),o.identity(this._bN),o.translate(this._bN,this._bN,[0,0,-this._H]),o.mul(this._S,this._bN,this._S),t=!0),this._be&&(o.identity(this._ci),o.perspective(this._ci,this._cz,this._k/this._l,this._bj,this._ba),t=!0),this._be=!1,this._I=!1,t&&this._7(),t},setViewportSize:function(t,e){this._be=!0,this._k=t,this._l=e,this._c0=new Float32Array([this._3/t,this._3/e])},viewportWidth:function(){return this._k},viewportHeight:function(){return this._l},setCenter:function(t){e(this._R,t)||(this._I=!0,n.copy(this._R,t),this._bo())},fog:function(t){return void 0!==t&&t!==this._b5&&(this._b5=t,this._7()),this._b5},rotateZ:function(){var t=o.create();return function(e){o.identity(t),this._I=!0,o.rotate(t,t,e,[0,0,1]),o.mul(this._o,t,this._o),this._bo()}}(),rotateX:function(){var t=o.create();return function(e){o.identity(t),this._I=!0,o.rotate(t,t,e,[1,0,0]),o.mul(this._o,t,this._o),this._bo()}}(),rotateY:function(){var t=o.create();return function(e){o.identity(t),this._I=!0,o.rotate(t,t,e,[0,1,0]),o.mul(this._o,t,this._o),this._bo()}}(),panX:function(t){return this.panXY(t,0)},panY:function(t){return this.panXY(0,t)},panXY:function(){var t=o.create(),e=n.create();return function(r,i){o.transpose(t,this._o),this._I=!0,n.set(e,-r,i,0),n.transformMat4(e,e,t),n.add(e,e,this._R),this.setCenter(e)}}(),nearOffset:function(){return this._bj},farOffset:function(){return this._ba},setNearFar:function(t,e){(t!==this._bj||e!==this._ba)&&(this._bj=t,this._ba=e,this._be=!0)},setFogNearFar:function(t,e){this._dp=t,this._dq=e,this._be=!0},setZoom:function(t){return Math.abs(this._H-t)>1e-8&&(this._I=!0,this._H=t),this._H},zoom:function(t){if(void 0===t)return this._H;this._I=!0;var e=1+.1*t;return this._H=Math.min(1e3,Math.max(2,e*this._H)),this._bo(),this._H},center:function(){return this._R},setFogColor:function(t){this._dr=n.clone(t)},currentShader:function(){return this._b8},invalidateCurrentShader:function(){this._b8=null},setOutlineColor:function(t){this._c5=n.clone(t)},setSelectionColor:function(t){this._bP=n.clone(t),3===t.length?this._bP=i.fromValues(t[0],t[1],t[2],.7):this._bP=i.clone(t),this._7()},bind:function(t,e){var r=!1,n=this._b;if(this._b8!==t&&(this._b8=t,n.useProgram(t),r=!0),r=this._dL()||r,e?(o.mul(this._dc,this._S,e),n.uniformMatrix4fv(t.modelview,!1,this._dc)):n.uniformMatrix4fv(t.modelview,!1,this._S),this._bv!==t.stateId){t.stateId=this._bv,n.uniformMatrix4fv(t.projection,!1,this._ci),t.rotation&&n.uniformMatrix4fv(t.rotation,!1,this._o),n.uniform1i(t.fog,this._b5);var i=this._H;n.uniform1f(t.fogFar,this._dq+i),n.uniform1f(t.zoom,this._H),n.uniform1f(t.fogNear,this._dp+i),n.uniform3fv(t.fogColor,this._dr),n.uniform3fv(t.outlineColor,this._c5),n.uniform4fv(t.selectionColor,this._bP),n.uniform2fv(t.relativePixelSize,this._c0),n.uniform1f(t.outlineWidth,this._cm),n.uniform1i(t.screenDoorTransparency,this._cV),n.uniform1i(t.outlineEnabled,this._c4)}}},r}(),h={PRELUDE_FS:"\nprecision ${PRECISION} float;\nuniform bool screenDoorTransparency;\nvec4 handleAlpha(vec4 inColor) {\n  if (screenDoorTransparency) {\n    ivec2 pxCoord = ivec2(gl_FragCoord.xy);\n    ivec2 mod = pxCoord - (pxCoord/2) * 2;\n    if (inColor.a < 0.99 &&\n        (inColor.a < 0.01 || mod.x != 0 || mod.y != 0)) { discard; }\n    return vec4(inColor.rgb, 1.0);\n  } else {\n    if (inColor.a == 0.0) { discard; }\n    return inColor;\n  } \n} \n\nint intMod(int x, int y) { \n  int z = x/y;\n  return x-y*z;\n}\n\nuniform vec4 selectionColor;\n\nvec3 handleSelect(vec3 inColor, float vertSelect) { \n  return mix(inColor, selectionColor.rgb, \n             step(0.5, vertSelect) * selectionColor.a); \n} \n\nuniform bool fog;\nuniform float fogNear;\nuniform float fogFar;\nuniform vec3 fogColor;\nvec3 handleFog(vec3 inColor) {\n  if (fog) {\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\n    float fogFactor = smoothstep(fogNear, fogFar, depth);\n    return mix(inColor, fogColor, fogFactor);\n  } else {\n    return inColor;\n  }\n}",LINES_FS:"\nvarying vec4 vertColor;\nvarying vec3 vertNormal;\n\nvoid main(void) {\n  gl_FragColor = handleAlpha(vertColor);\n  gl_FragColor.rgb = handleFog(gl_FragColor.rgb);\n}",SELECT_LINES_FS:"\nprecision ${PRECISION} float;\n\nvarying float vertSelect;\nvarying vec3 vertNormal;\nuniform float fogNear;\nuniform float fogFar;\nuniform vec3 fogColor;\nuniform bool fog;\nuniform vec4 selectionColor;\n\nvoid main(void) {\n  gl_FragColor = mix(vec4(0.0, 0.0, 0.0, 0.0), \n                     vec4(selectionColor.rgb, 1.0), vertSelect);\n  gl_FragColor.a = step(0.5, vertSelect);\n  if (gl_FragColor.a == 0.0) { discard; }\n  float depth = gl_FragCoord.z / gl_FragCoord.w;\n  if (fog) {\n    float fog_factor = smoothstep(fogNear, fogFar, depth);\n    gl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w),\n                        fog_factor);\n  }\n}",SELECT_LINES_VS:"\nattribute vec3 attrPos;\nattribute float attrSelect;\n\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nuniform float pointSize;\nvarying float vertSelect;\nvoid main(void) {\n  gl_Position = projectionMat * modelviewMat * vec4(attrPos, 1.0);\n  gl_Position.z += gl_Position.w * 0.000001; \n  float distToCamera = vec4(modelviewMat * vec4(attrPos, 1.0)).z;\n  gl_PointSize = pointSize * 200.0 / abs(distToCamera); \n  vertSelect = attrSelect;\n}",SELECT_VS:"\nprecision ${PRECISION} float;\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nuniform float pointSize;\nattribute vec3 attrPos;\nattribute float attrObjId;\nattribute vec4 attrColor;\n\nvarying float objId;\nvarying float objAlpha;\n\nvoid main(void) {\n  gl_Position = projectionMat * modelviewMat * vec4(attrPos, 1.0);\n  float distToCamera = vec4(modelviewMat * vec4(attrPos, 1.0)).z;\n  gl_PointSize = pointSize * 200.0 / abs(distToCamera); \n  objId = attrObjId;\n  objAlpha = attrColor.a;\n}",SELECT_FS:"\nprecision ${PRECISION} float;\n\nvarying float objId;\nvarying float objAlpha;\nuniform int symId;\n\nint intMod(int x, int y) { \n  int z = x/y;\n  return x-y*z;\n}\nvoid main(void) {\n  if (objAlpha == 0.0) { discard; }\n  // ints are only required to be 7bit...\n  int integralObjId = int(objId+0.5);\n  int red = intMod(integralObjId, 256);\n  integralObjId/=256;\n  int green = intMod(integralObjId, 256);\n  integralObjId/=256;\n  int blue = intMod(integralObjId, 256);\n  int alpha = symId;\n  gl_FragColor = vec4(float(red), float(green), \n                      float(blue), float(alpha))/255.0;\n}",LINES_VS:"\nattribute vec3 attrPos;\nattribute vec4 attrColor;\n\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nvarying vec4 vertColor;\nuniform float pointSize;\nvoid main(void) {\n  gl_Position = projectionMat * modelviewMat * vec4(attrPos, 1.0);\n  float distToCamera = vec4(modelviewMat * vec4(attrPos, 1.0)).z;\n  gl_PointSize = pointSize * 200.0 / abs(distToCamera); \n  vertColor = attrColor;\n}",HEMILIGHT_FS:"\nvarying vec4 vertColor;\nvarying vec3 vertNormal;\nvarying float vertSelect;\n\nvoid main(void) {\n  float dp = dot(vertNormal, vec3(0.0, 0.0, 1.0));\n  float hemi = min(1.0, max(0.0, dp)*0.6+0.5);\n  gl_FragColor = vec4(vertColor.rgb*hemi, vertColor.a);\n  gl_FragColor.rgb = handleFog(handleSelect(gl_FragColor.rgb, vertSelect));\n  gl_FragColor = handleAlpha(gl_FragColor);\n}",PHONG_FS:"\nvarying vec4 vertColor;\nvarying vec3 vertNormal;\nvarying vec3 vertPos;\nuniform float zoom;\nvarying float vertSelect;\n\nvoid main(void) {\n  vec3 eyePos = vec3(0.0, 0.0, zoom);\n  float dp = dot(vertNormal, normalize(eyePos - vertPos));\n  float hemi = min(1.0, max(0.3, dp)+0.2);\n  //hemi *= vertColor.a;\n  vec3 rgbColor = vertColor.rgb * hemi; \n  //gl_FragDepthEXT = gl_FragCoord.z;\n  rgbColor += min(vertColor.rgb, 0.8) * pow(max(0.0, dp), 18.0);\n  rgbColor = handleSelect(rgbColor, vertSelect);\n  gl_FragColor = vec4(clamp(rgbColor, 0.0, 1.0), vertColor.a);\n  gl_FragColor.rgb = handleFog(gl_FragColor.rgb);\n  gl_FragColor = handleAlpha(gl_FragColor);\n}",HEMILIGHT_VS:"\nattribute vec3 attrPos;\nattribute vec4 attrColor;\nattribute vec3 attrNormal;\nattribute float attrSelect;\n\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nvarying vec4 vertColor;\nvarying vec3 vertNormal;\nvarying vec3 vertPos;\nvarying float vertSelect;\nvoid main(void) {\n  vertPos = (modelviewMat * vec4(attrPos, 1.0)).xyz;\n  gl_Position = projectionMat * modelviewMat * vec4(attrPos, 1.0);\n  vec4 n = (modelviewMat * vec4(attrNormal, 0.0));\n  vertNormal = n.xyz;\n  vertColor = attrColor;\n  vertSelect = attrSelect;\n}",OUTLINE_FS:"\nvarying float vertAlpha;\nvarying float vertSelect;\n\nuniform vec3 outlineColor;\n\nvoid main() {\n  gl_FragColor = vec4(mix(outlineColor, selectionColor.rgb, \n                          step(0.5, vertSelect)), \n                      vertAlpha);\n  gl_FragColor.rgb = handleFog(gl_FragColor.rgb);\n  gl_FragColor = handleAlpha(gl_FragColor);\n}",OUTLINE_VS:"\nprecision ${PRECISION} float;\n\nattribute vec3 attrPos;\nattribute vec3 attrNormal;\nattribute vec4 attrColor;\nattribute float attrSelect;\n\nuniform vec3 outlineColor;\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nvarying float vertAlpha;\nvarying float vertSelect;\nuniform vec2 relativePixelSize;\nuniform float outlineWidth;\n\nvoid main(void) {\n  gl_Position = projectionMat * modelviewMat * vec4(attrPos, 1.0);\n  vec4 normal = modelviewMat * vec4(attrNormal, 0.0);\n  vertAlpha = attrColor.a;\n  vertSelect = attrSelect;\n  vec2 expansion = relativePixelSize * \n       (outlineWidth + 2.0 * step(0.5, attrSelect));\n  vec2 offset = normal.xy * expansion;\n  gl_Position.xy += gl_Position.w * offset;\n}",TEXT_VS:"\nprecision ${PRECISION} float;\n\nattribute vec3 attrCenter;\nattribute vec2 attrCorner;\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nuniform mat4 rotationMat;\nvarying vec2 vertTex;\nuniform float width;\nuniform float height;\nvoid main() { \n  vec4 pos = modelviewMat* vec4(attrCenter, 1.0);\n  pos.z += 4.0;\n  gl_Position = projectionMat * pos;\n  gl_Position.xy += vec2(width,height)*attrCorner*gl_Position.w; \n  vertTex = (attrCorner+abs(attrCorner))/(2.0*abs(attrCorner)); \n}",TEXT_FS:"\nprecision ${PRECISION} float;\n\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nuniform sampler2D sampler;\nuniform float xScale;\nuniform float yScale;\nvarying vec2 vertTex;\nvoid main() { \n  vec2 texCoord = vec2(vertTex.x*xScale, vertTex.y*yScale);\n  gl_FragColor = texture2D(sampler, texCoord);\n  if (gl_FragColor.a == 0.0) { discard; }\n}",SPHERES_FS:"\n#extension GL_EXT_frag_depth : enable\n\nvarying vec2 vertTex;\nvarying vec4 vertCenter;\nvarying vec4 vertColor;\nvarying float vertSelect;\nvarying float radius;\nuniform mat4 projectionMat;\nuniform vec3 outlineColor;\nvarying float border;\nuniform bool outlineEnabled;\n\nvoid main(void) {\n  float zz = dot(vertTex, vertTex);\n  if (zz > 1.0)\n    discard;\n  vec3 normal = vec3(vertTex.x, vertTex.y, sqrt(1.0-zz));\n  vec3 pos = vertCenter.xyz + normal * radius;\n  float dp = normal.z;\n  float hemi = sqrt(min(1.0, max(0.3, dp) + 0.2));\n  vec4 projected = projectionMat * vec4(pos, 1.0);\n  float depth = projected.z / projected.w;\n  gl_FragDepthEXT = (depth + 1.0) * 0.5;\n  vec3 rgbColor = vertColor.rgb * hemi; \n  rgbColor += min(vertColor.rgb, 0.8) * pow(max(0.0, dp), 18.0);\n  if (outlineEnabled) { \n    rgbColor = mix(rgbColor * hemi, outlineColor, step(border, sqrt(zz)));\n  } else { \n    rgbColor *= hemi; \n  } \n  rgbColor = handleSelect(rgbColor, vertSelect);\n  vec4 fogged = vec4(handleFog(rgbColor), vertColor.a);\n  gl_FragColor = handleAlpha(fogged);\n}",SPHERES_VS:"\nprecision ${PRECISION} float;\nattribute vec3 attrPos;\nattribute vec4 attrColor;\nattribute vec3 attrNormal;\nattribute float attrSelect;\nuniform vec2 relativePixelSize;\nuniform float outlineWidth;\nvarying float radius;\n\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nuniform mat4 rotationMat;\nvarying vec4 vertColor;\nvarying vec2 vertTex;\nvarying float border;\nvarying vec4 vertCenter;\nvarying float vertSelect;\nvoid main() {\n  vec3 d = vec3(attrNormal.xy * attrNormal.z, 0.0);\n  vec4 rotated = vec4(d, 0.0)*rotationMat;\n  gl_Position = projectionMat * modelviewMat * \n                (vec4(attrPos, 1.0)+rotated);\n  vertTex = attrNormal.xy;\n  vertColor = attrColor;\n  vertSelect = attrSelect;\n  vertCenter = modelviewMat* vec4(attrPos, 1.0);\n  float dist = length((projectionMat * vertCenter).xy - gl_Position.xy);\n  float dd = dist / gl_Position.w;\n  border = 1.0 - outlineWidth * 1.4 * length(relativePixelSize)/dd;\n  radius = attrNormal.z;\n}",SELECT_SPHERES_FS:"\n#extension GL_EXT_frag_depth : enable\n\nvarying vec2 vertTex;\nvarying vec4 vertCenter;\nvarying vec4 vertColor;\nuniform mat4 projectionMat;\nvarying float objId;\nvarying float radius;\nuniform int symId;\n\nvoid main(void) {\n  float zz = dot(vertTex, vertTex);\n  if (zz > 1.0)\n    discard;\n  vec3 normal = vec3(vertTex.x, vertTex.y, sqrt(1.0-zz));\n  vec3 pos = vertCenter.xyz + normal * radius;\n  vec4 projected = projectionMat * vec4(pos, 1.0);\n  float depth = projected.z / projected.w;\n  gl_FragDepthEXT = (depth + 1.0) * 0.5;\n  // ints are only required to be 7bit...\n  int integralObjId = int(objId+0.5);\n  int red = intMod(integralObjId, 256);\n  integralObjId/=256;\n  int green = intMod(integralObjId, 256);\n  integralObjId/=256;\n  int blue = intMod(integralObjId, 256);\n  int alpha = symId;\n  gl_FragColor = vec4(float(red), float(green), \n                      float(blue), float(alpha))/255.0;\n}",SELECT_SPHERES_VS:"\nprecision ${PRECISION} float;\nattribute vec3 attrPos;\nattribute vec4 attrColor;\nattribute vec3 attrNormal;\nattribute float attrObjId;\nvarying float radius;\n\nuniform mat4 projectionMat;\nuniform mat4 modelviewMat;\nuniform mat4 rotationMat;\nvarying vec2 vertTex;\nvarying vec4 vertCenter;\nvarying float objId;\nvoid main() {\n  vec3 d = vec3(attrNormal.xy * attrNormal.z, 0.0);\n  vec4 rotated = vec4(d, 0.0)*rotationMat;\n  //vec4 rotated = vec4(d, 0.0);\n  gl_Position = projectionMat * modelviewMat * \n                (vec4(attrPos, 1.0)+rotated);\n  vertTex = attrNormal.xy;\n  vertCenter = modelviewMat* vec4(attrPos, 1.0);\n  radius = attrNormal.z;\n  objId = attrObjId;\n}"},u=function(){"use strict";function t(t,e,r){this._bb=t,this._bb.addEventListener("touchmove",n.bind(this,this._dN)),this._bb.addEventListener("touchstart",n.bind(this,this._dM)),this._bb.addEventListener("touchend",n.bind(this,this._cO)),this._bb.addEventListener("touchcancel",n.bind(this,this._cO)),this._4={scale:1,rotation:0,center:null},this._bk=null,this._u=e,this._d=r}function e(t){for(var e=0,r=0,n=0;n<t.length;++n)e+=t[n].clientX,r+=t[n].clientY;return e/=t.length,r/=t.length,{x:e,y:r}}function r(t,e){var r=e.x-t.x,n=e.y-t.y;return Math.sqrt(r*r+n*n)}function i(t,e){var n=r(t[0],t[1]),i=r(e[0],e[1]);return i/(0===n?1:n)}function o(t,e){var r=e.x-t.x,n=e.y-t.y;return Math.atan2(n,r)}function s(t,e){return o(e[1],e[0])-o(t[1],t[0])}return t.prototype={_dt:function(t,r){var n={};n.center=e(r.targetTouches),n.pointers=[];for(var o=0;o<r.targetTouches.length;++o){var a=r.targetTouches[o];n.pointers.push({x:a.clientX,y:a.clientY})}return n.numTouches=r.targetTouches.length,n.rotation=0,n.scale=1,n.deltaScale=0,n.deltaRotation=0,t.center&&(n.deltaCenter={x:n.center.x-t.center.x,y:n.center.y-t.center.y}),2!==t.numTouches||2!==n.numTouches?n:(t.initialPointers?n.initialPointers=t.initialPointers:n.initialPointers=t.pointers,n.scale=i(n.initialPointers,n.pointers),n.deltaScale=n.scale-t.scale,n.rotation=s(n.initialPointers,n.pointers),n.deltaRotation=n.rotation-t.rotation,n)},_dN:function(t){t.preventDefault();var e=this._dt(this._4,t),r=4*-e.deltaScale;if(0!==r&&this._d.zoom(r),2===e.numTouches&&2===this._4.numTouches){var n=.002*Math.tan(.5*this._d.fieldOfViewY())*this._d.zoom();this._d.panXY(e.deltaCenter.x*n,e.deltaCenter.y*n)}var i=-e.deltaRotation;this._d.rotateZ(i),1===e.numTouches&&1===this._4.numTouches&&(this._d.rotateX(.005*e.deltaCenter.y),this._d.rotateY(.005*e.deltaCenter.x)),this._u.requestRedraw(),this._4=e,this._bk=null},_dM:function(t){if(t.preventDefault(),1===t.targetTouches.length){var e=(new Date).getTime();if(null!==this._bk){var r=e-this._bk;300>r&&(this._u._b1._da({clientX:t.targetTouches[0].clientX,clientY:t.targetTouches[0].clientY}),e=null)}this._bk=e}else this._bk=null;this._4=this._dt(this._4,t)},_cO:function(t){if(t.preventDefault(),this._bk){var e=this._bb.getBoundingClientRect(),r=this._4.pointers[0],n=this._u.pick({x:r.x-e.left,y:r.y-e.top});this._u._b7(t,"click",n)}}},t}(),c=function(){"use strict";function t(t,e,r,n){this._u=e,this._c=t,this._d=r,this._c=t,this._eF=n,this._cq=null,this._eq()}return t.prototype={_ez:function(t){null!==t&&this._u.setCenter(t.pos(),this._eF)},_d9:function(t){var e=this._c,r=(new Date).getTime();if((null===this._cq||r-this._cq>300)&r-this._eh<300){var n=this._c.domElement().getBoundingClientRect(),i=this._u.pick({x:t.clientX-n.left,y:t.clientY-n.top});this._u._b7(t,"click",i)}this._cq=r,e.removeEventListener("mousemove",this._bW),e.removeEventListener("mousemove",this._b0),e.removeEventListener("mouseup",this._bV),document.removeEventListener("mouseup",this._bV),document.removeEventListener("mousemove",this._bW),document.removeEventListener("mousemove",this._b0)},setCam:function(t){this._d=t},_eq:function(){return this._b0=n.bind(this,this._eb),this._bW=n.bind(this,this._ea),this._bV=n.bind(this,this._d9),this._c.onWheel(n.bind(this,this._d7),n.bind(this,this._d8)),this._c.on("dblclick",n.bind(this,this._da)),this._c.on("mousedown",n.bind(this,this._ec)),!0},_d8:function(t){this._d.zoom(t.wheelDelta<0?-1:1),t.preventDefault(),this._u.requestRedraw()},_d7:function(t){this._d.zoom(t.deltaY<0?1:-1),t.preventDefault(),this._u.requestRedraw()},_da:function(){return function(t){var e=this._c.domElement().getBoundingClientRect(),r=this._u.pick({x:t.clientX-e.left,y:t.clientY-e.top});this._u._b7(t,"doubleClick",r),this._u.requestRedraw()}}(),_ec:function(t){(0===t.button||1===t.button)&&(this._eh=(new Date).getTime(),t.preventDefault(),t.shiftKey===!0||1===t.button?(this._c.on("mousemove",this._b0),document.addEventListener("mousemove",this._b0,!1)):(this._c.on("mousemove",this._bW),document.addEventListener("mousemove",this._bW,!1)),this._c.on("mouseup",this._bV),document.addEventListener("mouseup",this._bV,!1),this._bl={x:t.pageX,y:t.pageY})},_ea:function(t){var e={x:t.pageX,y:t.pageY},r={x:e.x-this._bl.x,y:e.y-this._bl.y},n=.005;this._d.rotateX(n*r.y),this._d.rotateY(n*r.x),this._bl=e,this._u.requestRedraw()},_eb:function(t){var e={x:t.pageX,y:t.pageY},r={x:e.x-this._bl.x,y:e.y-this._bl.y},n=.002*Math.tan(.5*this._d.fieldOfViewY())*this._d.zoom();this._d.panXY(n*r.x,n*r.y),this._bl=e,this._u.requestRedraw()}},t}(),l=function(){"use strict";function e(t,e,r){return r?t*e:e*(t-1)+1}function r(t,r,n,i,s,a){s=s||!1,i=i||.5;var h=null,u=3*e(r,n,s);h=a?a.request(u):new Float32Array(u);var c,l,_,d=0,v=1/n,m=o.create(),b=o.create(),p=o.create(),g=o.create(),A=o.create(),y=o.create();for(o.set(g,t[0],t[1],t[2]),o.set(A,t[3],t[4],t[5]),s?(o.set(p,t[t.length-3],t[t.length-2],t[t.length-1]),o.sub(m,A,p),o.scale(m,m,i)):(o.set(p,t[0],t[1],t[2]),o.set(m,0,0,0)),c=1,_=r-1;_>c;++c){for(o.set(y,t[3*(c+1)],t[3*(c+1)+1],t[3*(c+1)+2]),o.sub(b,y,g),o.scale(b,b,i),l=0;n>l;++l)f(h,g,m,A,b,v*l,d),d+=3;o.copy(p,g),o.copy(g,A),o.copy(A,y),o.copy(m,b)}for(s?(o.set(y,t[0],t[1],t[3]),o.sub(b,y,g),o.scale(b,b,i)):o.set(b,0,0,0),l=0;n>l;++l)f(h,g,m,A,b,v*l,d),d+=3;if(!s)return h[d]=t[3*(r-1)+0],h[d+1]=t[3*(r-1)+1],h[d+2]=t[3*(r-1)+2],h;for(o.copy(p,g),o.copy(g,A),o.copy(A,y),o.copy(m,b),o.set(y,t[3],t[4],t[5]),o.sub(b,y,g),o.scale(b,b,i),l=0;n>l;++l)f(h,g,m,A,b,v*l,d),d+=3;return h}function n(t,e){this._R=t||o.create(),this._dW=e||1}function i(t,e){for(var r=new Float32Array(e*(t.length-1)+1),n=0,i=0,o=0,s=1/e,a=0;a<t.length-1;++a){i=t[a],o=t[a+1];for(var h=0;e>h;++h){var u=s*h;r[n+0]=i*(1-u)+o*u,n+=1}}return r[n+0]=o,r}var o=t.vec3,s=t.vec4,a=t.mat3,h=t.quat,u=function(){var t=o.create();return function(e,r,n){return o.cross(t,e,r),Math.atan2(o.dot(t,n),o.dot(e,r))}}(),c=function(){var t=o.create();return function(e,r){return o.copy(t,r),Math.abs(r[0])<Math.abs(r[1])?Math.abs(r[0])<Math.abs(r[2])?t[0]+=1:t[2]+=1:Math.abs(r[1])<Math.abs(r[2])?t[1]+=1:t[2]+=1,o.cross(e,r,t)}}(),l=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[0],s=e[1],a=e[2],h=o*o,u=o*s,c=o*a,l=s*s,f=s*a,_=a*a;return t[0]=h+i-h*i,t[1]=u-i*u-n*a,t[2]=c-i*c+n*s,t[3]=u-i*u+n*a,t[4]=l+i-i*l,t[5]=f-i*f-n*o,t[6]=c-i*c-n*s,t[7]=f-i*f+n*o,t[8]=_+i-i*_,t},f=function(){var t=o.create();return function(e,r,n,i,s,a,h){var u=a*a,c=3-2*a,l=u*c,f=1-l,_=u*(a-2)+a,d=u*(a-1);o.copy(t,r),o.scale(t,t,f),o.scaleAndAdd(t,t,n,_),o.scaleAndAdd(t,t,i,l),o.scaleAndAdd(t,t,s,d),e[h]=t[0],e[h+1]=t[1],e[h+2]=t[2]}}(),_=function(){var t=a.create(),e=a.create(),r=a.create(),n=a.create(),i=h.create(),u=o.create(),c=o.create();return function(l){for(var f=24,_=h.fromValues(0,0,0,1),d=0;f>d;++d){a.fromQuat(t,_);var v=a.transpose(r,t);a.mul(e,t,a.mul(n,l,v)),o.set(u,e[5],e[2],e[1]),o.set(c,Math.abs(u[0]),Math.abs(u[1]),Math.abs(u[2]));var m=c[0]>c[1]&&c[0]>c[2]?0:c[1]>c[2]?1:2,b=(m+1)%3,p=(m+2)%3;if(0===u[m])break;var g=(e[3*p+p]-e[3*b+b])/(2*u[m]),A=g>0?1:-1;g*=A;var y=g+(1e6>g?Math.sqrt(g*g+1):g),C=A/y,R=1/Math.sqrt(C*C+1);if(1===R)break;if(s.set(i,0,0,0,0),i[m]=A*Math.sqrt((1-R)/2),i[m]*=-1,i[3]=Math.sqrt(1-i[m]*i[m]),1===i[3])break;_=h.mul(_,_,i),h.normalize(_,_)}return _}}();n.prototype.center=function(){return this._R},n.prototype.radius=function(){return this._dW};var d=function(){return function(t,e,r,n,i){i?o.cross(n,e,r):c(n,e),o.cross(r,n,e),o.normalize(n,n),o.normalize(r,r),t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=n[0],t[4]=n[1],t[5]=n[2],t[6]=e[0],t[7]=e[1],t[8]=e[2]}}();return{signedAngle:u,axisRotation:l,ortho:c,diagonalizer:_,catmullRomSpline:r,cubicHermiteInterpolate:f,interpolateScalars:i,catmullRomSplineNumPoints:e,Sphere:n,buildRotation:d}}(),f=H=function(){"use strict";function t(t){this._bJ=[],this._U=!0,this._L=name||"",this._b=t,this._cn=1}return t.prototype={order:function(t){return void 0!==t&&(this._cn=t),this._cn},add:function(t){this._bJ.push(t)},draw:function(t,e,r,n){for(var i=0,o=this._bJ.length;i!==o;++i)this._bJ[i].draw(t,e,r,n)},show:function(){this._U=!0},hide:function(){this._U=!1},name:function(t){return void 0!==t&&(this._L=t),this._L},destroy:function(){for(var t=0;t<this._bJ.length;++t)this._bJ[t].destroy()},visible:function(){return this._U}},t}(),_=X=function(){"use strict";function e(t,e){t.eachResidue(function(t){var r=t.centralAtom();null!==r&&e(r,r.pos())})}function r(t){H.call(this,t),this._8=[],this._O=[],this._cS=null,this._bQ=null}var i=t.vec3,o=function(){var t=i.create();return function(e,r,n){for(var o=0;o<r.length;++o)for(var s=r[o],a=e.chainsByName(s.chains()),h=0;h<s.matrices().length;++h)for(var u=s.matrix(h),c=0;c<a.length;++c)for(var l=a[c],f=0;f<l.residues().length;++f){
var _=l.residues()[f].centralAtom();null!==_&&(i.transformMat4(t,_.pos(),u),n(_,t))}}}();return n.derive(r,H,{setShowRelated:function(t){return t&&"asym"!==t&&null===this.structure().assembly(t)?void 0:(this._cS=t,t)},symWithIndex:function(t){if("asym"===this.showRelated())return null;var e=this.structure().assembly(this.showRelated());if(!e)return null;for(var r=e.generators(),n=0;n<r.length;++n){if(r[n].matrices().length>t)return r[n].matrix(t);t-=r[n].matrices().length}return null},showRelated:function(){return this._cS},select:function(t){return this.structure().select(t)},structure:function(){return this._O[0]._g},getColorForAtom:function(t,e){return this._O[0].getColorForAtom(t,e)},addIdRange:function(t){this._8.push(t)},destroy:function(){H.prototype.destroy.call(this);for(var t=0;t<this._8.length;++t)this._8[t].recycle()},eachCentralAtom:function(t){var r=this,n=r.structure(),i=n.assembly(r.showRelated());return null===i?e(n,t):o(n,i.generators(),t)},addVertAssoc:function(t){this._O.push(t)},_cb:function(t){for(var e=this.vertArrays(),r=[],n={},i=0;i<t.length;++i)n[t[i]]=!0;for(var o=0;o<e.length;++o)n[e[o].chain()]===!0&&r.push(e[o]);return r},_es:function(t,e,r){for(var n=r.generators(),i=0;i<n.length;++i){var o=n[i],s=this._cb(o.chains());this._cE(t,e,s,o.matrices())}},_dK:function(t,e,r,n,i,o){for(var s=this.vertArrays(),a=0;a<s.length;++a)s[a].updateProjectionIntervals(t,e,r,n,i,o)},updateProjectionIntervals:function(t,e,r,n,i,o){if(this._U){var s=this.showRelated();if("asym"===s)return this._dK(t,e,r,n,i,o);for(var a=this.structure().assembly(s),h=a.generators(),u=0;u<h.length;++u)for(var c=h[u],l=this._cb(c.chains()),f=0;f<c.matrices().length;++f)for(var _=0;_<l.length;++_){var d=c.matrix(f);l[_].updateProjectionIntervals(t,e,r,n,i,o,d)}}},_dJ:function(t,e){for(var r=this.vertArrays(),n=0;n<r.length;++n)e=r[n].updateSquaredSphereRadius(t,e);return e},updateSquaredSphereRadius:function(t,e){if(!this._U)return e;var r=this.showRelated();if("asym"===r)return this._dJ(t,e);for(var n=this.structure().assembly(r),i=n.generators(),o=0;o<i.length;++o)for(var s=i[o],a=this._cb(s.chains()),h=0;h<s.matrices().length;++h)for(var u=0;u<a.length;++u)e=a[u].updateSquaredSphereRadius(t,e);return e},draw:function(t,e,r,n){if(this._U){var i=this.shaderForStyleAndPass(e,r,n);if(i){var o=this.showRelated();if("asym"===o)return this._cE(t,i,this.vertArrays(),null);var s=this.structure().assembly(o);return this._es(t,i,s)}}},colorBy:function(t,e){this._p=!1,e=e||this.structure();for(var r=0;r<this._O.length;++r)this._O[r].recolor(t,e)},setOpacity:function(t,e){this._p=!1,e=e||this.structure();for(var r=0;r<this._O.length;++r)this._O[r].setOpacity(t,e)},setSelection:function(t){this._bQ=t,this._p=!1;for(var e=0;e<this._O.length;++e)this._O[e].setSelection(t)},selection:function(){return null===this._bQ&&(this._bQ=this.structure().createEmptyView()),this._bQ}}),r}(),d=G=function(){"use strict";function e(t,e,r){this._b=t,this._cL=t.createBuffer(),this._C=r||null,this._p=!1,this._b9=null;var n=this._w*e;this._e=r.request(n)}var r=t.vec3;return e.prototype={setColor:function(t,e,r,n,i){var o=t*this._w+this._bL;this._e[o+0]=e,this._e[o+1]=r,this._e[o+2]=n,this._e[o+3]=i,this._p=!1},getColor:function(t,e){var r=t*this._w+this._bL;return e[0]=this._e[r+0],e[1]=this._e[r+1],e[2]=this._e[r+2],e[3]=this._e[r+3],e},setOpacity:function(t,e){var r=t*this._w+this._bL;this._e[r+3]=e,this._p=!1},setSelected:function(t,e){var r=t*this._w+this._cK;this._e[r]=e,this._p=!1},boundingSphere:function(){return this._b9||(this._b9=this._eA()),this._b9},_eA:function(){var t=this.numVerts();if(0===t)return null;var e,n,i=r.create();for(n=0;t>n;++n)e=n*this._w,i[0]+=this._e[e+0],i[1]+=this._e[e+1],i[2]+=this._e[e+2];r.scale(i,i,1/t);var o=0;for(n=0;t>n;++n){e=n*this._w;var s=i[0]-this._e[e+0],a=i[1]-this._e[e+1],h=i[2]-this._e[e+2];o=Math.max(o,s*s+a*a+h*h)}return new l.Sphere(i,Math.sqrt(o))},destroy:function(){this._b.deleteBuffer(this._cL),this._C.release(this._e)},bindBuffers:function(){this._b.bindBuffer(this._b.ARRAY_BUFFER,this._cL),this._p||(this._b.bufferData(this._b.ARRAY_BUFFER,this._e,this._b.STATIC_DRAW),this._p=!0)},updateSquaredSphereRadius:function(){var t=r.create();return function(e,n,i){var o=this.boundingSphere();if(!o)return n;if(i)return r.transformMat4(t,o.center(),i),Math.max(r.sqrDist(t,e),n);var s=o.radius()*o.radius();return Math.max(r.sqrDist(o.center(),e)+s,n)}}(),updateProjectionIntervals:function(){var t=r.create();return function(e,n,i,o,s,a,h){var u=this.boundingSphere();if(u){h?r.transformMat4(t,u.center(),h):r.copy(t,u.center());var c=r.dot(e,t),l=r.dot(n,t),f=r.dot(i,t);o.update(c-u.radius()),o.update(c+u.radius()),s.update(l-u.radius()),s.update(l+u.radius()),a.update(f-u.radius()),a.update(f+u.radius())}}}()},e}(),v=function(){"use strict";function t(t,e,r){G.call(this,t,e,r),this._x=0,this._cj=this._b.LINES}return n.derive(t,G,{_w:9,_dG:0,_bL:3,_eL:7,_cK:8,numVerts:function(){return this._x},setDrawAsPoints:function(t){t?this._cj=this._b.POINTS:this._cj=this._b.LINES},addPoint:function(t,e,r){var n=this._w*this._x;this._e[n++]=t[0],this._e[n++]=t[1],this._e[n++]=t[2],this._e[n++]=e[0],this._e[n++]=e[1],this._e[n++]=e[2],this._e[n++]=e[3],this._e[n++]=r,this._e[n++]=0,this._x+=1,this._p=!1,this._b9=null},addLine:function(t,e,r,n,i,o){this.addPoint(t,e,i),this.addPoint(r,n,o)},bindAttribs:function(t){this._b.vertexAttribPointer(t.posAttrib,3,this._b.FLOAT,!1,4*this._w,4*this._dG),-1!==t.colorAttrib&&(this._b.vertexAttribPointer(t.colorAttrib,4,this._b.FLOAT,!1,4*this._w,4*this._bL),this._b.enableVertexAttribArray(t.colorAttrib)),this._b.enableVertexAttribArray(t.posAttrib),-1!==t.objIdAttrib&&(this._b.vertexAttribPointer(t.objIdAttrib,1,this._b.FLOAT,!1,4*this._w,4*this._eL),this._b.enableVertexAttribArray(t.objIdAttrib)),-1!==t.selectAttrib&&(this._b.vertexAttribPointer(t.selectAttrib,1,this._b.FLOAT,!1,4*this._w,4*this._cK),this._b.enableVertexAttribArray(t.selectAttrib))},releaseAttribs:function(t){this._b.disableVertexAttribArray(t.posAttrib),-1!==t.colorAttrib&&this._b.disableVertexAttribArray(t.colorAttrib),-1!==t.objIdAttrib&&this._b.disableVertexAttribArray(t.objIdAttrib),-1!==t.selectAttrib&&this._b.disableVertexAttribArray(t.selectAttrib)},bind:function(t){this.bindBuffers(),this.bindAttribs(t)},draw:function(){this._b.drawArrays(this._cj,0,this._x)}}),t}(),m=W=function(){"use strict";function t(t,e,r,n,i){G.call(this,t,e,n),this._dk=t.createBuffer(),this._J=i,this._x=0,this._dd=e,this._bD=0,this._E=i.request(r)}return n.derive(t,G,{destroy:function(){G.prototype.destroy.call(this),this._b.deleteBuffer(this._dk),this._J.release(this._E)},setIndexData:function(t){this._p=!1,this._bD=t.length/3;for(var e=0;e<t.length;++e)this._E[e]=t[e]},setVertData:function(t){this._p=!1,this._x=t.length/this._w;for(var e=0;e<t.length;++e)this._e[e]=t[e]},numVerts:function(){return this._x},maxVerts:function(){return this._dd},numIndices:function(){return 3*this._bD},addVertex:function(t,e,r,n){if(this._x!==this._dd){var i=this._x*this._w;this._e[i++]=t[0],this._e[i++]=t[1],this._e[i++]=t[2],this._e[i++]=e[0],this._e[i++]=e[1],this._e[i++]=e[2],this._e[i++]=r[0],this._e[i++]=r[1],this._e[i++]=r[2],this._e[i++]=r[3],this._e[i++]=n,this._e[i++]=0,this._x+=1,this._p=!1}},_w:12,_eN:48,_eU:10,_eJ:40,_cK:11,_eH:44,_bL:6,_eM:24,_eV:3,_eK:12,_dG:0,_eI:0,addTriangle:function(t,e,r){var n=3*this._bD;n+2>=this._E.length||(this._E[n++]=t,this._E[n++]=e,this._E[n++]=r,this._bD+=1,this._p=!1)},bindBuffers:function(){var t=this._p,e=this._b;G.prototype.bindBuffers.call(this),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._dk),t||e.bufferData(e.ELEMENT_ARRAY_BUFFER,this._E,e.STATIC_DRAW)},bindAttribs:function(t){var e=this._b,r=this._eN;e.enableVertexAttribArray(t.posAttrib),e.vertexAttribPointer(t.posAttrib,3,e.FLOAT,!1,r,this._eI),-1!==t.normalAttrib&&(e.enableVertexAttribArray(t.normalAttrib),e.vertexAttribPointer(t.normalAttrib,3,e.FLOAT,!1,r,this._eK)),-1!==t.colorAttrib&&(e.vertexAttribPointer(t.colorAttrib,4,e.FLOAT,!1,r,this._eM),e.enableVertexAttribArray(t.colorAttrib)),-1!==t.objIdAttrib&&(e.vertexAttribPointer(t.objIdAttrib,1,e.FLOAT,!1,r,this._eJ),e.enableVertexAttribArray(t.objIdAttrib)),-1!==t.selectAttrib&&(e.vertexAttribPointer(t.selectAttrib,1,e.FLOAT,!1,r,this._eH),e.enableVertexAttribArray(t.selectAttrib))},releaseAttribs:function(t){var e=this._b;e.disableVertexAttribArray(t.posAttrib),-1!==t.colorAttrib&&e.disableVertexAttribArray(t.colorAttrib),-1!==t.normalAttrib&&e.disableVertexAttribArray(t.normalAttrib),-1!==t.objIdAttrib&&e.disableVertexAttribArray(t.objIdAttrib),-1!==t.selectAttrib&&e.disableVertexAttribArray(t.selectAttrib)},bind:function(t){this.bindBuffers(),this.bindAttribs(t)},draw:function(){var t=this._b;t.drawElements(t.TRIANGLES,3*this._bD,t.UNSIGNED_SHORT,0)}}),t}(),b=function(t){"use strict";function e(e,r,n,i){t.call(this,r,n,i),this._M=e}function r(t,e,r,n,i,o){W.call(this,e,r,n,i,o),this._M=t}return n.derive(e,t,{chain:function(){return this._M},drawSymmetryRelated:function(t,e,r){this.bind(e);for(var n=0;n<r.length;++n)t.bind(e,r[n]),this._b.uniform1i(e.symId,n),this.draw();this.releaseAttribs(e)}}),n.derive(r,W,{chain:function(){return this._M}}),r.prototype.drawSymmetryRelated=e.prototype.drawSymmetryRelated,{LineChainData:e,MeshChainData:r}}(v),p=Y=function(t){"use strict";function e(t,e,r){X.call(this,t),this._z=[],this._C=e,this._J=r,this._bU=null,this._bz=null}var r=t.MeshChainData;return n.derive(e,X,{_cH:function(t){return Math.min(65536,t)},addChainVertArray:function(t,e,n){this._bU=e,this._bz=n;var i=new r(t.name(),this._b,this._cH(e),n,this._C,this._J);return this._z.push(i),i},addVertArray:function(t,e){this._bU=t,this._bz=e;var r=new W(this._b,this._cH(t),e,this._C,this._J);return this._z.push(r),r},vertArrayWithSpaceFor:function(t){var e=this._z[this._z.length-1],n=e.maxVerts()-e.numVerts();if(n>=t)return e;this._bU-=e.numVerts(),this._bz-=e.numIndices(),t=this._cH(this._bU);var i=null;return i=e instanceof r?new r(e.chain(),this._b,t,this._bz,this._C,this._J):new W(this._b,t,this._bz,this._C,this._J),this._z.push(i),i},vertArray:function(t){return this._z[t]},destroy:function(){X.prototype.destroy.call(this);for(var t=0;t<this._z.length;++t)this._z[t].destroy();this._z=[]},numVerts:function(){return this._z[0].numVerts()},shaderForStyleAndPass:function(t,e,r){if("normal"===r)return"hemilight"===e?t.hemilight:t.phong;if("select"===r)return t.select;if("outline"===r)return t.outline;var n=t[r];return void 0!==n?n:null},_cE:function(t,e,r,n){var i;if(n)for(i=0;i<r.length;++i)r[i].drawSymmetryRelated(t,e,n);else for(t.bind(e),this._b.uniform1i(e.symId,255),i=0;i<r.length;++i)r[i].bind(e),r[i].draw(),r[i].releaseAttribs(e)},vertArrays:function(){return this._z},addVertex:function(t,e,r,n){var i=this._z[0];i.addVertex(t,e,r,n)},addTriangle:function(t,e,r){var n=this._z[0];n.addTriangle(t,e,r)}}),e}(b),g=function(){"use strict";function t(t,e,r){Y.call(this,t,e,r)}return n.derive(t,Y,{draw:function(t,e,r,n){this._b.disable(this._b.CULL_FACE),Y.prototype.draw.call(this,t,e,r,n),this._b.enable(this._b.CULL_FACE)},shaderForStyleAndPass:function(t,e,r){return"normal"===r?t.spheres:"select"===r?t.selectSpheres:null}}),t}(),A=function(t){"use strict";function e(t,e){X.call(this,t),this._bu=[],this._C=e,this._cp=.5,this._ck=1}var r=t.LineChainData;return n.derive(e,X,{addChainVertArray:function(t,e){var n=new r(t.name(),this._b,e,this._C);return this._bu.push(n),n},setLineWidth:function(t){this._cp=t},setPointSize:function(t){this._ck=t},vertArrays:function(){return this._bu},shaderForStyleAndPass:function(t,e,r){return"outline"===r?t.selectLines:"select"===r?t.select:t.lines},destroy:function(){X.prototype.destroy.call(this);for(var t=0;t<this._bu.length;++t)this._bu[t].destroy();this._bu=[]},_cE:function(t,e,r,n){var i=t.upsamplingFactor();-1!==e.selectAttrib&&(i=4*t.upsamplingFactor());var o;if(n)for(t.bind(e),this._b.lineWidth(i*this._cp),e.pointSize&&this._b.uniform1f(e.pointSize,i*this._ck),o=0;o<r.length;++o)r[o].drawSymmetryRelated(t,e,n);else for(t.bind(e),this._b.lineWidth(i*this._cp),this._b.uniform1i(e.symId,255),e.pointSize&&this._b.uniform1f(e.pointSize,i*this._ck),o=0;o<r.length;++o)r[o].bind(e),r[o].draw(),r[o].releaseAttribs(e)},vertArray:function(){return this._2}}),e}(b),y=function(){"use strict";function e(t,e){this._f=e,this._cd=t,this._i=new Uint16Array(3*e*t*2),this._n=new Float32Array(3*e*t);var r,n,i=Math.PI/(t-1),o=2*Math.PI/e;for(r=0;r<this._cd;++r){var s=Math.sin(r*i),a=Math.cos(r*i);for(n=0;n<this._f;++n){var h=s*Math.cos(n*o),u=s*Math.sin(n*o);this._n[3*(n+r*this._f)]=h,this._n[3*(n+r*this._f)+1]=u,this._n[3*(n+r*this._f)+2]=a}}var c=0;for(r=0;r<this._cd-1;++r)for(n=0;n<this._f;++n)this._i[c]=r*this._f+n,this._i[c+1]=r*this._f+(n+1)%this._f,this._i[c+2]=(r+1)*this._f+n,c+=3,this._i[c]=r*this._f+(n+1)%this._f,this._i[c+1]=(r+1)*this._f+(n+1)%this._f,this._i[c+2]=(r+1)*this._f+n,c+=3}function r(t,e,r){var n=l.catmullRomSpline(t,t.length/3,e,r,!0);this._i=new Uint16Array(2*n.length),this._n=n,this._K=new Float32Array(n.length),this._f=n.length/3;for(var o=i.create(),s=0;s<this._f;++s){var a=0===s?this._f-1:s-1,h=s===this._f-1?0:s+1;o[0]=this._n[3*h+1]-this._n[3*a+1],o[1]=this._n[3*a]-this._n[3*h],i.normalize(o,o),this._K[3*s]=o[0],this._K[3*s+1]=o[1],this._K[3*s+2]=o[2]}for(s=0;s<this._f;++s)this._i[6*s]=s,this._i[6*s+1]=s+this._f,this._i[6*s+2]=(s+1)%this._f+this._f,this._i[6*s+3]=s,this._i[6*s+4]=(s+1)%this._f+this._f,this._i[6*s+5]=(s+1)%this._f}function n(t){this._f=t,this._i=new Uint16Array(3*t*2),this._n=new Float32Array(3*t*2),this._K=new Float32Array(3*t*2);for(var e=2*Math.PI/this._f,r=0;r<this._f;++r){var n=Math.cos(e*r),i=Math.sin(e*r);this._n[3*r]=n,this._n[3*r+1]=i,this._n[3*r+2]=-.5,this._n[3*t+3*r]=n,this._n[3*t+3*r+1]=i,this._n[3*t+3*r+2]=.5,this._K[3*r]=n,this._K[3*r+1]=i,this._K[3*t+3*r]=n,this._K[3*t+3*r+1]=i}for(r=0;r<this._f;++r)this._i[6*r]=r%this._f,this._i[6*r+1]=t+(r+1)%this._f,this._i[6*r+2]=(r+1)%this._f,this._i[6*r+3]=r%this._f,this._i[6*r+4]=t+r%this._f,this._i[6*r+5]=t+(r+1)%this._f}var i=t.vec3;return e.prototype={addTransformed:function(){var t=i.create(),e=i.create();return function(r,n,o,s,a){for(var h=r.numVerts(),u=0;u<this._cd*this._f;++u)i.set(e,this._n[3*u],this._n[3*u+1],this._n[3*u+2]),i.copy(t,e),i.scale(t,t,o),i.add(t,t,n),r.addVertex(t,e,s,a);for(u=0;u<this._i.length/3;++u)r.addTriangle(h+this._i[3*u],h+this._i[3*u+1],h+this._i[3*u+2])}}(),numIndices:function(){return this._i.length},numVerts:function(){return this._n.length/3}},r.prototype={addTransformed:function(){var t=i.create(),e=i.create();return function(r,n,o,s,a,h,u,c){for(var l=this._f,f=this._K,_=this._n,d=r.numVerts()-l,v=0;l>v;++v)i.set(t,o*_[3*v],o*_[3*v+1],0),i.transformMat3(t,t,s),i.add(t,t,n),i.set(e,f[3*v],f[3*v+1],0),i.transformMat3(e,e,s),r.addVertex(t,e,a,c);if(!h)if(0!==u)for(v=0;l>v;++v)r.addTriangle(d+(v+u)%l,d+v+l,d+(v+1)%l+l),r.addTriangle(d+(v+u)%l,d+(v+1)%l+l,d+(v+1+u)%l);else for(v=0;v<this._i.length/3;++v)r.addTriangle(d+this._i[3*v],d+this._i[3*v+1],d+this._i[3*v+2])}}()},n.prototype={numVerts:function(){return this._n.length/3},numIndices:function(){return this._i.length},addTransformed:function(){var t=i.create(),e=i.create();return function(r,n,o,s,a,h,u,c,l){for(var f=r.numVerts(),_=this._n,d=this._K,v=this._f,m=0;2*v>m;++m){i.set(t,s*_[3*m],s*_[3*m+1],o*_[3*m+2]),i.transformMat3(t,t,a),i.add(t,t,n),i.set(e,d[3*m],d[3*m+1],d[3*m+2]),i.transformMat3(e,e,a);var b=v>m?c:l;r.addVertex(t,e,v>m?h:u,b)}var p=this._i;for(m=0;m<p.length/3;++m)r.addTriangle(f+p[3*m],f+p[3*m+1],f+p[3*m+2])}}()},{TubeProfile:r,ProtoCylinder:n,ProtoSphere:e}}(),C=function(){"use strict";function t(t,e){this._g=t,this._s=[],this._bK=e}function r(t,e,r){this._g=t,this._s=[],this._bK=r,this._bn=e||1,this._bC={}}return t.prototype={addAssoc:function(t,e,r,n){this._s.push({atom:t,vertexArray:e,vertStart:r,vertEnd:n})},recolor:function(t,e){var r=new Float32Array(4*e.atomCount());this._bK&&t.begin(this._g);var n={};e.eachAtom(function(e,i){n[e.index()]=i,t.colorFor(e,r,4*i)}),this._bK&&t.end(this._g);for(var i=0;i<this._s.length;++i){var o=this._s[i],s=n[o.atom.index()];if(void 0!==s)for(var a=r[4*s+0],h=r[4*s+1],u=r[4*s+2],c=r[4*s+3],l=o.vertexArray,f=o.vertStart;f<o.vertEnd;++f)l.setColor(f,a,h,u,c)}},getColorForAtom:function(t,e){for(var r=0;r<this._s.length;++r){var n=this._s[r];if(n.atom.full()===t.full())return n.vertexArray.getColor(n.vertStart,e)}return null},setSelection:function(t){var e={};t.eachAtom(function(t){e[t.index()]=!0});for(var r=0;r<this._s.length;++r)for(var n=this._s[r],i=e[n.atom.index()],o=i!==!0?0:1,s=n.vertexArray,a=n.vertStart;a<n.vertEnd;++a)s.setSelected(a,o)},setOpacity:function(t,e){var r={};e.eachAtom(function(t){r[t.index()]=!0});for(var n=0;n<this._s.length;++n){var i=this._s[n],o=r[i.atom.index()];if(o===!0)for(var s=i.vertexArray,a=i.vertStart;a<i.vertEnd;++a)s.setOpacity(a,t)}}},r.prototype={setPerResidueColors:function(t,e){this._bC[t]=e},addAssoc:function(t,e,r,n,i){this._s.push({traceIndex:t,slice:r,vertStart:n,vertEnd:i,vertexArray:e})},recolor:function(t,r){this._bK&&t.begin(this._g);var n,i,o=[],s=this._g.backboneTraces();for(n=0;n<s.length;++n){var a=this._bC[n],h=0,u=s[n];for(i=0;i<u.length();++i)r.containsResidue(u.residueAt(i))?(t.colorFor(u.centralAtomAt(i),a,h),h+=4):h+=4;this._bn>1?o.push(e.interpolateColor(a,this._bn)):o.push(a)}for(n=0;n<this._s.length;++n){var c=this._s[n],l=c.slice,f=o[c.traceIndex],_=f[4*l],d=f[4*l+1],v=f[4*l+2],m=f[4*l+3],b=c.vertexArray;for(i=c.vertStart;i<c.vertEnd;++i)b.setColor(i,_,d,v,m)}this._bK&&t.end(this._g)},getColorForAtom:function(t,e){var r,n,i=this._g.backboneTraces(),o=t.full().residue();for(r=0;r<i.length;++r){var s=this._bC[r],a=0,h=i[r];for(n=0;n<h.length();++n){if(o===h.residueAt(n).full())return e[0]=s[a+0],e[1]=s[a+1],e[2]=s[a+2],e[3]=s[a+3],e;a+=4}}return null},setSelection:function(t){var e,r,n=[],i=this._g.backboneTraces();for(e=0;e<i.length;++e){var o=new Float32Array(this._bC[e].length),s=0,a=i[e];for(r=0;r<a.length();++r){var h=t.containsResidue(a.residueAt(r))?1:0;o[s]=h,s+=1}this._bn>1?n.push(l.interpolateScalars(o,this._bn)):n.push(o)}for(e=0;e<this._s.length;++e){var u=this._s[e],c=u.slice,f=n[u.traceIndex],_=f[c],d=u.vertexArray;for(r=u.vertStart;r<u.vertEnd;++r)d.setSelected(r,_)}},setOpacity:function(t,r){var n,i,o=[],s=this._g.backboneTraces();for(n=0;n<s.length;++n){var a=this._bC[n],h=0,u=s[n];for(i=0;i<u.length();++i)r.containsResidue(u.residueAt(i))?(a[h+3]=t,h+=4):h+=4;this._bn>1?o.push(e.interpolateColor(a,this._bn)):o.push(a)}for(n=0;n<this._s.length;++n){var c=this._s[n],l=c.slice,f=o[c.traceIndex],_=f[4*l+3],d=c.vertexArray;for(i=c.vertStart;i<c.vertEnd;++i)d.setOpacity(i,_)}}},{TraceVertexAssoc:r,AtomVertexAssoc:t}}(),R=function(r,n){"use strict";function i(t,e,r){for(var n=0;r-1>n;++n)t.addTriangle(e,e+1+n,e+2+n);t.addTriangle(e,e+r,e+1)}function o(t,e,r){for(var n=e+r,i=0;r-1>i;++i)t.addTriangle(n,e+i+1,e+i);t.addTriangle(n,e,e+r-1)}var s=t.vec3,a=t.vec4,h=t.mat3,u=y.TubeProfile,c=y.ProtoSphere,f=y.ProtoCylinder,_=C.TraceVertexAssoc,d=C.AtomVertexAssoc,v=e.interpolateColor,m={},b=.6,p=.8071,g=[-b,-b,0,b,-b,0,b,b,0,-b,b,0],A=[-6*b,-.9*p,0,-5.8*b,-1*p,0,5.8*b,-1*p,0,6*b,-.9*p,0,6*b,.9*p,0,5.8*b,1*p,0,-5.8*b,1*p,0,-6*b,.9*p,0],R=[-10*b,-.9*p,0,-9.8*b,-1*p,0,9.8*b,-1*p,0,10*b,-.9*p,0,10*b,.9*p,0,9.8*b,1*p,0,-9.8*b,1*p,0,-10*b,.9*p,0],S={H:1.1,C:1.7,N:1.55,O:1.52,F:1.47,CL:1.75,BR:1.85,I:1.98,HE:1.4,NE:1.54,AR:1.88,XE:2.16,KR:2.02,P:1.8,S:1.8,B:1.92,LI:1.82,NA:2.27,K:2.75,RB:3.03,CS:3.43,FR:3.48,BE:1.53,MG:1.73,SR:2.49,BA:2.68,RA:2.83,TI:2.11,FE:2.04,CU:1.96},w=function(){var t=s.create(),e=s.create(),r=s.create();return function(n,i,o,a){i=Math.max(i,1),o=Math.min(a-1,o);var h=3*(i-1);s.set(t,n[h],n[h+1],n[h+2]),s.set(r,n[3*i],n[3*i+1],n[3*i+2]);for(var u=i;o>u;++u)h=3*(u+1),s.set(e,n[h],n[h+1],n[h+2]),n[3*u+0]=.25*e[0]+.5*r[0]+.25*t[0],n[3*u+1]=.25*e[1]+.5*r[1]+.25*t[1],n[3*u+2]=.25*e[2]+.5*r[2]+.25*t[2],s.copy(t,r),s.copy(r,e)}}(),E=function(){var t=a.fromValues(0,0,0,1);return function(e,r,n,i){var o=i.atomCount(),s=n.idPool.getContinuousRange(o);e.addIdRange(s);var a=n.protoSphere.numVerts(),h=n.protoSphere.numIndices(),u=1.5*n.radiusMultiplier;e.addChainVertArray(i,a*o,h*o),i.eachAtom(function(i){var o=e.vertArrayWithSpaceFor(a);n.color.colorFor(i,t,0);var h=o.numVerts(),c=s.nextId({geom:e,atom:i});n.protoSphere.addTransformed(o,i.pos(),u,t,c);var l=o.numVerts();r.addAssoc(i,o,h,l)})}}();m.spheres=function(t,e,r){var n=new c(r.sphereDetail,r.sphereDetail);r.protoSphere=n;var i=new Y(e,r.float32Allocator,r.uint16Allocator),o=new d(t,(!0));return i.addVertAssoc(o),i.setShowRelated(r.showRelated),r.color.begin(t),t.eachChain(function(t){E(i,o,r,t)}),r.color.end(t),i};var x=function(){var t=a.fromValues(0,0,0,1);return function(e,r,n,i){var o=i.atomCount(),s=n.idPool.getContinuousRange(o);e.addIdRange(s);var a=4,h=6,u=1.5*n.radiusMultiplier;e.addChainVertArray(i,a*o,h*o),i.eachAtom(function(i){var o=e.vertArrayWithSpaceFor(a);n.color.colorFor(i,t,0);var h=s.nextId({geom:e,atom:i}),c=o.numVerts(),l=i.pos();o.addVertex(l,[-1,-1,u],t,h),o.addVertex(l,[1,1,u],t,h),o.addVertex(l,[1,-1,u],t,h),o.addVertex(l,[-1,1,u],t,h),o.addTriangle(c+0,c+1,c+2),o.addTriangle(c+0,c+3,c+1);var f=o.numVerts();r.addAssoc(i,o,c,f)})}}();m.billboardedSpheres=function(t,e,n){var i=new r(e,n.float32Allocator,n.uint16Allocator),o=new d(t,(!0));return i.addVertAssoc(o),i.setShowRelated(n.showRelated),n.color.begin(t),t.eachChain(function(t){x(i,o,n,t)}),n.color.end(t),i};var T=function(){var t=s.create(),e=s.create(),r=a.fromValues(0,0,0,1),n=s.create(),i=s.create(),o=h.create();return function(a,h,u,c){var f=c.atomCount(),_=0;c.eachAtom(function(t){_+=t.bonds().length});var d=f*u.protoSphere.numVerts()+_*u.protoCyl.numVerts(),v=f*u.protoSphere.numIndices()+_*u.protoCyl.numIndices();a.addChainVertArray(c,d,v);var m=u.idPool.getContinuousRange(f);a.addIdRange(m),c.eachAtom(function(c){var f=u.scaleByAtomRadius?S[c.element()]||1:1,_=u.sphereRadius*f,d=u.protoSphere.numVerts()+c.bondCount()*u.protoCyl.numVerts(),v=a.vertArrayWithSpaceFor(d),b=v.numVerts(),p=m.nextId({geom:a,atom:c});u.color.colorFor(c,r,0),u.protoSphere.addTransformed(v,c.pos(),_,r,p),c.eachBond(function(a){a.mid_point(t),s.sub(e,c.pos(),t);var h=s.length(e);s.scale(e,e,1/h),l.buildRotation(o,e,n,i,!1),s.add(t,t,c.pos()),s.scale(t,t,.5),u.protoCyl.addTransformed(v,t,h,u.cylRadius,o,r,r,p,p)});var g=v.numVerts();h.addAssoc(c,v,b,g)})}}();m.ballsAndSticks=function(t,e,r){var n=new d(t,(!0)),i=new c(r.sphereDetail,r.sphereDetail),o=new f(r.arcDetail);r.protoSphere=i,r.protoCyl=o;var s=new Y(e,r.float32Allocator,r.uint16Allocator);return s.addVertAssoc(n),s.setShowRelated(r.showRelated),r.color.begin(t),t.eachChain(function(t){T(s,n,r,t)}),r.color.end(t),s};var M=function(){var t=a.fromValues(0,0,0,1);return function(e,r,n,i){var o=n.atomCount(),s=i.idPool.getContinuousRange(o);e.addIdRange(s);var a=e.addChainVertArray(n,o);a.setDrawAsPoints(!0),n.eachAtom(function(n){var o=a.numVerts();i.color.colorFor(n,t,0);var h=s.nextId({geom:e,atom:n});a.addPoint(n.pos(),t,h);var u=a.numVerts();r.addAssoc(n,a,o,u)})}}();m.points=function(t,e,r){var i=new d(t,(!0));r.color.begin(t);var o=new n(e,r.float32Allocator);return o.setPointSize(r.pointSize),o.addVertAssoc(i),o.setShowRelated(r.showRelated),t.eachChain(function(t){M(o,i,t,r)}),r.color.end(t),o};var F=function(){var t=s.create(),e=a.fromValues(0,0,0,1);return function(r,n,i,o){var s=0,a=i.atomCount(),h=o.idPool.getContinuousRange(a);r.addIdRange(h),i.eachAtom(function(t){var e=t.bonds().length;s+=e?e:3});var u=r.addChainVertArray(i,2*s);i.eachAtom(function(i){var s=u.numVerts(),a=h.nextId({geom:r,atom:i});if(i.bonds().length)i.eachBond(function(r){r.mid_point(t),o.color.colorFor(i,e,0),u.addLine(i.pos(),e,t,e,a,a)});else{var c=.2,l=i.pos();o.color.colorFor(i,e,0),u.addLine([l[0]-c,l[1],l[2]],e,[l[0]+c,l[1],l[2]],e,a,a),u.addLine([l[0],l[1]-c,l[2]],e,[l[0],l[1]+c,l[2]],e,a,a),u.addLine([l[0],l[1],l[2]-c],e,[l[0],l[1],l[2]+c],e,a,a)}var f=u.numVerts();n.addAssoc(i,u,s,f)})}}();m.lines=function(t,e,r){var i=new d(t,(!0));r.color.begin(t);var o=new n(e,r.float32Allocator);return o.setLineWidth(r.lineWidth),o.addVertAssoc(i),o.setShowRelated(r.showRelated),t.eachChain(function(t){F(o,i,t,r)}),r.color.end(t),o};var I=function(t){for(var e=0,r=0;r<t.length;++r)e+=2*(t[r].length()-1);return e},D=function(){var t=a.fromValues(0,0,0,1),e=a.fromValues(0,0,0,1),r=s.create(),n=s.create();return function(i,o,s,a,h,u){o.addAssoc(a,s,0,s.numVerts(),s.numVerts()+1);var c=u.float32Allocator.request(4*h.length()),l=u.idPool.getContinuousRange(h.length());i.addIdRange(l);for(var f,_=l.nextId({geom:i,atom:h.centralAtomAt(0),isTrace:!0}),d=1;d<h.length();++d){u.color.colorFor(h.centralAtomAt(d-1),t,0),c[4*(d-1)+0]=t[0],c[4*(d-1)+1]=t[1],c[4*(d-1)+2]=t[2],c[4*(d-1)+3]=t[3],u.color.colorFor(h.centralAtomAt(d),e,0),h.posAt(r,d-1),h.posAt(n,d),f=l.nextId({geom:i,atom:h.centralAtomAt(d),isTrace:!0}),s.addLine(r,t,n,e,_,f),_=f,f=null;var v=s.numVerts();o.addAssoc(a,s,d,v-1,v+(d===h.length()-1?0:1))}return c[4*h.length()-4]=e[0],c[4*h.length()-3]=e[1],c[4*h.length()-2]=e[2],c[4*h.length()-1]=e[3],o.setPerResidueColors(a,c),a+1}}(),P=function(t,e,r,n,i){for(var o=i.backboneTraces(),s=I(o),a=t.addChainVertArray(i,s),h=0;h<o.length;++h)n=D(t,e,a,n,o[h],r);return n};m.lineTrace=function(t,e,r){var i=new _(t,1,(!0));r.color.begin(t);var o=new n(e,r.float32Allocator);o.setLineWidth(r.lineWidth);var s=0;return t.eachChain(function(t){s=P(o,i,r,s,t)}),o.addVertAssoc(i),o.setShowRelated(r.showRelated),r.color.end(t),o};var V=function(t,e){for(var r=0,n=0;n<t.length;++n)r+=2*(e*(t[n].length()-1)+1);return r},N=function(){var t=s.create(),e=s.create(),r=a.fromValues(0,0,0,1),n=a.fromValues(0,0,0,1);return function(i,o,s,a,h,u){var c,f=u.fullTraceIndex(0),_=a.float32Allocator.request(3*u.length()),d=a.float32Allocator.request(4*u.length()),m=[],b=a.idPool.getContinuousRange(u.length());for(i.addIdRange(b),c=0;c<u.length();++c){var p=u.centralAtomAt(c);u.smoothPosAt(t,c,a.strength),a.color.colorFor(p,d,4*c),_[3*c]=t[0],_[3*c+1]=t[1],_[3*c+2]=t[2],m.push(b.nextId({geom:i,atom:p,isTrace:!0}))}var g=m[0],A=0,y=l.catmullRomSpline(_,u.length(),a.splineDetail,a.strength,!1,a.float32Allocator),C=v(d,a.splineDetail),R=s.numVerts();o.addAssoc(h,s,f,R,R+1);var S=Math.floor(a.splineDetail/2),w=l.catmullRomSplineNumPoints(u.length(),a.splineDetail,!1);for(c=1;w>c;++c){t[0]=y[3*(c-1)],t[1]=y[3*(c-1)+1],t[2]=y[3*(c-1)+2],e[0]=y[3*(c-0)],e[1]=y[3*(c-0)+1],e[2]=y[3*(c-0)+2],r[0]=C[4*(c-1)+0],r[1]=C[4*(c-1)+1],r[2]=C[4*(c-1)+2],r[3]=C[4*(c-1)+3],n[0]=C[4*(c-0)+0],n[1]=C[4*(c-0)+1],n[2]=C[4*(c-0)+2],n[3]=C[4*(c-0)+3];var E=Math.floor((c+S)/a.splineDetail);A=m[Math.min(m.length-1,E)],s.addLine(t,r,e,n,g,A),g=A;var x=s.numVerts();o.addAssoc(h,s,f+c,x-1,x+(c===u.length-1?0:1))}return o.setPerResidueColors(h,d),a.float32Allocator.release(_),a.float32Allocator.release(y),h+1}}(),L=function(t,e,r,n,i){for(var o=n.backboneTraces(),s=V(o,r.splineDetail),a=t.addChainVertArray(n,s),h=0;h<o.length;++h)i=N(t,e,a,r,i,o[h]);return i};m.sline=function(t,e,r){r.color.begin(t);var i=new _(t,r.splineDetail,1,(!0)),o=new n(e,r.float32Allocator);o.addVertAssoc(i),o.setLineWidth(r.lineWidth),o.setShowRelated(r.showRelated);var s=0;return t.eachChain(function(t){s=L(o,i,r,t,s)}),r.color.end(t),o};var O=function(t,e,r){for(var n=0,i=0;i<t.length;++i)n+=t[i].length()*e,n+=(t[i].length()-1)*r;return n},q=function(t,e,r){for(var n=0,i=0;i<t.length;++i)n+=t[i].length()*e,n+=(t[i].length()-1)*r;return n},B=function(t,e,r,n,i){var o=i.backboneTraces(),s=O(o,r.protoSphere.numVerts(),r.protoCyl.numVerts()),a=q(o,r.protoSphere.numIndices(),r.protoCyl.numIndices());t.addChainVertArray(i,s,a);for(var h=0;h<o.length;++h)X(t,e,o[h],n,r),n++;return n};m.trace=function(t,e,r){r.protoCyl=new f(r.arcDetail),r.protoSphere=new c(r.sphereDetail,r.sphereDetail);var n=new Y(e,r.float32Allocator,r.uint16Allocator),i=new _(t,1,(!0));n.addVertAssoc(i),n.setShowRelated(r.showRelated),r.color.begin(t);var o=0;return t.eachChain(function(t){o=B(n,i,r,o,t)}),r.color.end(t),n};var U=function(t,e,r){for(var n=0,i=0;i<t.length;++i){var o=((t[i].length()-1)*r+1)*e,s=Math.ceil((o+2)/65536);n+=o+(s-1)*e,n+=2}return n},k=function(t,e,r){for(var n=0,i=0;i<t.length;++i)n+=(t[i].length()*r-1)*e*6,n+=6*e;return n},z=function(){var t=h.create(),e=s.create(),r=s.create(),n=s.create(),i=s.create(),o=a.create();return function(a,h,u,c){for(var f=1.8*c.radius,_=c.protoCyl.numVerts()+2*c.protoSphere.numVerts(),d=0;d<u.length;++d){var v=u[d],m=c.idPool.getContinuousRange(v.length());a.addIdRange(m);for(var b=0;b<v.length();++b){var p=a.vertArrayWithSpaceFor(_),g=p.numVerts(),A=v.residueAt(b),y=A.name(),C=A.atom("C3'"),R=null;if(R="A"===y||"G"===y||"DA"===y||"DG"===y?A.atom("N1"):A.atom("N3"),null!==R&&null!==C){var S=m.nextId({geom:a,atom:R,isTrace:!0});s.add(i,C.pos(),R.pos()),s.scale(i,i,.5),c.color.colorFor(R,o,0),s.sub(n,R.pos(),C.pos());var w=s.length(n);s.scale(n,n,1/w),l.buildRotation(t,n,r,e,!1),c.protoCyl.addTransformed(p,i,w,f,t,o,o,S,S),c.protoSphere.addTransformed(p,R.pos(),f,o,S),c.protoSphere.addTransformed(p,C.pos(),f,o,S);var E=p.numVerts();h.addAssoc(R,p,g,E)}}}}}(),j=function(t,e,r,n,i,o){for(var s=o.backboneTraces(),a=U(s,4*n.arcDetail,n.splineDetail),h=k(s,4*n.arcDetail,n.splineDetail),u=[],c=n.protoCyl.numVerts()+2*n.protoSphere.numVerts(),l=n.protoCyl.numIndices()+2*n.protoSphere.numIndices(),f=0;f<s.length;++f){var _=s[f];_.residueAt(0).isNucleotide()&&(u.push(_),a+=_.length()*c,h+=_.length()*l)}t.addChainVertArray(o,a,h);for(var d=0;d<s.length;++d)i=W(t,e,s[d],i,n);return z(t,r,u,n),i};m.cartoon=function(t,e,r){r.arrowSkip=Math.floor(3*r.splineDetail/4),r.coilProfile=new u(g,r.arcDetail,1),r.arrowProfile=new u(R,r.arcDetail/2,.1),r.helixProfile=new u(A,r.arcDetail/2,.1),r.strandProfile=new u(A,r.arcDetail/2,.1),r.protoCyl=new f(4*r.arcDetail),r.protoSphere=new c(4*r.arcDetail,4*r.arcDetail);var n=new Y(e,r.float32Allocator,r.uint16Allocator),i=new _(t,r.splineDetail,(!0));n.addVertAssoc(i),n.setShowRelated(r.showRelated),r.color.begin(t);var o=0,s=t.select({anames:["N1","N3"]}),a=new d(s,(!0));return n.addVertAssoc(a),t.eachChain(function(t){o=j(n,i,a,r,o,t)}),r.color.end(t),n},m.surface=function(){var t=s.create(),e=s.create(),r=a.fromValues(.8,.8,.8,1);return function(n,i,o){var a=0;n.getUint32(0),a+=4;var h=n.getUint32(a);a+=4;var u=24,c=u*h+a,l=n.getUint32(c),f=new Y(i,o.float32Allocator,o.uint16Allocator);f.setShowRelated("asym");var _,d=f.addVertArray(h,3*l);for(_=0;h>_;++_)s.set(t,n.getFloat32(a+0),n.getFloat32(a+4),n.getFloat32(a+8)),a+=12,s.set(e,n.getFloat32(a+0),n.getFloat32(a+4),n.getFloat32(a+8)),a+=12,d.addVertex(t,e,r,0);for(a=c+4,_=0;l>_;++_){var v=n.getUint32(a+0),m=n.getUint32(a+4),b=n.getUint32(a+8);a+=12,d.addTriangle(v-1,b-1,m-1)}return f}}();var H=function(){var t=h.create(),e=s.create();return function(r,n,i,o,a,h,u,c,f,_,d){var v=f.coilProfile;"C"===o||f.forceTube?c?l.ortho(i,a):s.cross(i,e,a):"H"===o?v=f.helixProfile:"E"===o?v=f.strandProfile:"A"===o&&(v=f.arrowProfile),l.buildRotation(t,a,i,e,!0),v.addTransformed(r,n,u,t,h,c,_,d)}}(),G=function(){var t=s.create(),e=s.create(),r=s.create();return function(n,i,o,a,h,u,c,l){var f=null,_=null,d=i.length();s.set(r,0,0,0);for(var v=0;d>v;++v){u.push(c.nextId({geom:n,atom:i.centralAtomAt(v),isTrace:!0})),i.smoothPosAt(t,v,l.strength),a[3*v]=t[0],a[3*v+1]=t[1],a[3*v+2]=t[2],i.smoothNormalAt(e,v,l.strength);var m=i.centralAtomAt(v);l.color.colorFor(m,o,4*v),s.dot(e,r)<0&&s.scale(e,e,-1),"E"===i.residueAt(v).ss()&&!l.forceTube&&l.smoothStrands&&(null===f&&(f=v),_=v),"C"===i.residueAt(v).ss()&&null!==f&&(w(a,f,_,d),w(h,f,_,d),f=null,_=null),h[3*v]=a[3*v]+e[0]+r[0],h[3*v+1]=a[3*v+1]+e[1]+r[1],h[3*v+2]=a[3*v+2]+e[2]+r[2],s.copy(r,e)}}}(),W=function(){var t=s.create(),e=s.create(),r=a.fromValues(0,0,0,1),n=s.create(),h=s.create();
return function(u,c,f,_,d){var m=U([f],4*d.arcDetail,d.splineDetail),b=d.float32Allocator.request(3*f.length()),p=d.float32Allocator.request(4*f.length()),g=d.float32Allocator.request(3*f.length()),A=[],y=d.idPool.getContinuousRange(f.length());u.addIdRange(y),G(u,f,p,b,g,A,y,d);var C=u.vertArrayWithSpaceFor(m),R=l.catmullRomSpline(b,f.length(),d.splineDetail,d.strength,!1,d.float32Allocator),S=l.catmullRomSpline(g,f.length(),d.splineDetail,d.strength,!1,d.float32Allocator);c.setPerResidueColors(_,p);var w=d.radius*(f.residueAt(0).isAminoacid()?1:1.8),E=v(p,d.splineDetail);s.set(t,R[3]-R[0],R[4]-R[1],R[5]-R[2]),s.set(e,R[0],R[1],R[2]),s.set(n,S[0]-R[0],S[1]-R[1],S[2]-R[2]),s.normalize(t,t),s.normalize(n,n),a.set(r,E[0],E[1],E[2],E[3]);var x=C.numVerts();C.addVertex(e,[-t[0],-t[1],-t[2]],r,A[0]);var T=f.residueAt(0).ss();H(C,e,n,T,t,r,w,!0,d,0,A[0]),i(C,x,4*d.arcDetail);var M=C.numVerts(),F=0;c.addAssoc(_,C,F,x,M),F+=1;for(var I=Math.floor(d.splineDetail/2),D=l.catmullRomSplineNumPoints(f.length(),d.splineDetail,!1),P=4*d.arcDetail,V=1,N=D;N>V;++V){var L=3*V,O=4*V,q=3*(V+1),B=3*(V-1);s.set(e,R[L],R[L+1],R[L+2]),V===N-1?s.set(t,R[L]-R[B],R[L+1]-R[B+1],R[L+2]-R[B+2]):s.set(t,R[q]-R[B],R[q+1]-R[B+1],R[q+2]-R[B+2]),s.normalize(t,t),a.set(r,E[O],E[O+1],E[O+2],E[O+3]);var k=0,z=V+d.splineDetail/2,j=Math.floor(z/d.splineDetail),W=Math.floor((z-1)/d.splineDetail),X=Math.floor((z+d.arrowSkip)/d.splineDetail),Y=!1,K=f.residueAt(j).ss();if(!d.forceTube){if(j!==W){var J=f.residueAt(W).ss();if("C"===J&&("H"===K||"E"===K)){s.set(h,S[B]-R[B],S[B+1]-R[B+1],S[B+2]-R[B+2]),s.normalize(h,h);var Q=2*Math.PI/(4*d.arcDetail),$=l.signedAngle(n,h,t);k=Math.round($/Q),k=(k+4*d.arcDetail)%(4*d.arcDetail)}}if(X!==j&&X<f.length()){var Z=f.residueAt(X).ss();"C"===Z&&"E"===K&&(Y=!0)}}s.set(n,S[3*V]-R[L],S[L+1]-R[L+1],S[L+2]-R[L+2]),s.normalize(n,n),x=C.numVerts();var tt=Math.floor((V+I)/d.splineDetail),et=A[Math.min(A.length-1,tt)];H(C,e,n,K,t,r,w,!1,d,k,et);var rt=V===N-1?1:P;C.numVerts()+rt>C.maxVerts()&&(M=C.numVerts(),c.addAssoc(_,C,F,x,M),C=u.vertArrayWithSpaceFor(rt),x=0,H(C,e,n,K,t,r,w,!0,d,0,et)),Y&&(c.addAssoc(_,C,F,x,M),H(C,e,n,"A",t,r,w,!1,d,0,et),V+=d.arrowSkip),M=C.numVerts(),V===N-1&&(M+=1),c.addAssoc(_,C,F,x,M),F+=1,Y&&(F+=d.arrowSkip)}return C.addVertex(e,t,r,A[A.length-1]),o(C,x,4*d.arcDetail),d.float32Allocator.release(g),d.float32Allocator.release(b),_+1}}(),X=function(){var t=h.create(),e=s.create(),r=s.create(),n=s.create(),i=s.create(),o=s.create(),u=s.create(),c=a.fromValues(0,0,0,1),f=a.fromValues(0,0,0,1);return function(a,h,_,d,v){if(0!==_.length()){var m=v.idPool.getContinuousRange(_.length());a.addIdRange(m),v.color.colorFor(_.centralAtomAt(0),c,0);var b=O([_],v.protoSphere.numVerts(),v.protoCyl.numVerts()),p=b,g=a.vertArrayWithSpaceFor(b),A=g.maxVerts(),y=g.numVerts();_.posAt(o,0);var C=m.nextId({geom:a,atom:_.centralAtomAt(0),isTrace:!0}),R=0;v.protoSphere.addTransformed(g,o,v.radius,c,C);var S=null;h.addAssoc(d,g,0,y,S);var w=v.float32Allocator.request(4*_.length());w[0]=c[0],w[1]=c[1],w[2]=c[2],w[3]=c[3];for(var E=v.protoCyl.numVerts()+v.protoSphere.numVerts(),x=1;x<_.length();++x){R=m.nextId({geom:a,atom:_.centralAtomAt(x),isTrace:!0}),_.posAt(o,x-1),_.posAt(u,x),v.color.colorFor(_.centralAtomAt(x),f,0),w[4*x+0]=f[0],w[4*x+1]=f[1],w[4*x+2]=f[2],w[4*x+3]=f[3],s.sub(e,u,o);var T=s.length(e);s.scale(e,e,1/T),l.buildRotation(t,e,r,n,!1),s.copy(i,o),s.add(i,i,u),s.scale(i,i,.5),E>A-g.numVerts()&&(g=a.vertArrayWithSpaceFor(p)),p-=E;var M=g.numVerts();v.protoCyl.addTransformed(g,i,T,v.radius,t,c,f,C,R),S=g.numVerts(),S-=(S-M)/2,v.protoSphere.addTransformed(g,u,v.radius,f,R),C=R,h.addAssoc(d,g,x,y,S),y=S,s.copy(c,f)}h.setPerResidueColors(d,w),h.addAssoc(d,g,_.length()-1,y,g.numVerts())}}}();return m}(g,A),S=function(){function t(t,e,r,n,i,o){H.call(this,t);var s=o||{};this._={},this._.fillStyle=s.fillStyle||"#000",this._.backgroundAlpha=s.backgroundAlpha||0,this._.fontSize=s.fontSize||24,this._.font=s.font||"Verdana",this._.fontStyle=s.fontStyle||"normal",this._.fontColor=s.fontColor||"#000",this._cn=100,this._bB=n,this._ej=this._b.createBuffer(),this._h=new Float32Array(30),this._d3(e,r,i);var a=.5,h=.5;this._h[0]=n[0],this._h[1]=n[1],this._h[2]=n[2],this._h[3]=-a,this._h[4]=-h,this._h[5]=n[0],this._h[6]=n[1],this._h[7]=n[2],this._h[8]=a,this._h[9]=h,this._h[10]=n[0],this._h[11]=n[1],this._h[12]=n[2],this._h[13]=a,this._h[14]=-h,this._h[15]=n[0],this._h[16]=n[1],this._h[17]=n[2],this._h[18]=-a,this._h[19]=-h,this._h[20]=n[0],this._h[21]=n[1],this._h[22]=n[2],this._h[23]=-a,this._h[24]=h,this._h[25]=n[0],this._h[26]=n[1],this._h[27]=n[2],this._h[28]=a,this._h[29]=h}function e(t){for(var e=1;t>e;)e*=2;return e}return n.derive(t,H,{updateProjectionIntervals:function(){},updateSquaredSphereRadius:function(t,e){return e},_cU:function(t){t.fillStyle=this._.fontColor,t.textAlign="left",t.textBaseline="bottom",t.font=this._.fontStyle+" "+this._.fontSize+"px "+this._.font},_d3:function(t,r,n){this._cU(r);var i=r.measureText(n).width,o=24;t.width=e(i),t.height=e(o),r.fillStyle=this._.fillStyle,r.globalAlpha=this._.backgroundAlpha,r.fillRect(0,0,t.width,t.height),this._cU(r),r.globalAlpha=1,r.lineWidth=.5,r.lineStyle="none",r.fillText(n,0,t.height),r.strokeText(n,0,t.height),this._cQ=this._b.createTexture(),this._dO(this._cQ,t),this._dI=i/t.width,this._dH=o/t.height,this._k=i,this._l=o},_dO:function(t,e){var r=this._b;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0),r.bindTexture(r.TEXTURE_2D,t),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.generateMipmap(r.TEXTURE_2D),r.bindTexture(r.TEXTURE_2D,null)},bind:function(){var t=this._b;t.bindBuffer(t.ARRAY_BUFFER,this._ej),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this._cQ),this._p||(t.bufferData(t.ARRAY_BUFFER,this._h,t.STATIC_DRAW),this._p=!0)},draw:function(t,e,r,n){if(this._U&&"normal"===n){var i=e.text;t.bind(i),this.bind();var o=this._b,s=t.upsamplingFactor();o.uniform1f(o.getUniformLocation(i,"xScale"),this._dI),o.uniform1f(o.getUniformLocation(i,"yScale"),this._dH),o.uniform1f(o.getUniformLocation(i,"width"),2*s*this._k/t.viewportWidth()),o.uniform1f(o.getUniformLocation(i,"height"),2*s*this._l/t.viewportHeight()),o.uniform1i(o.getUniformLocation(i,"sampler"),0);var a=o.getAttribLocation(i,"attrCenter");o.enableVertexAttribArray(a),o.vertexAttribPointer(a,3,o.FLOAT,!1,20,0);var h=o.getAttribLocation(i,"attrCorner");o.vertexAttribPointer(h,2,o.FLOAT,!1,20,12),o.enableVertexAttribArray(h),o.enable(o.BLEND),o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA),o.drawArrays(o.TRIANGLES,0,6),o.disableVertexAttribArray(a),o.disableVertexAttribArray(h),o.disable(o.BLEND)}}}),t}(),w=function(r){"use strict";function i(){this._e=[],this._E=[],this._x=0}function o(t,e,n,o,s){H.call(this,e),this._C=n,this._J=o,this._D=new i,this._d0=new r.ProtoSphere(8,8),this._d1=new r.ProtoCylinder(8),this._2=null,this._8=[],this._er=s,this._p=!1,this._bH=null}function s(t,e,r){for(var n=0;r-1>n;++n)t.addTriangle(e,e+1+n,e+2+n);t.addTriangle(e,e+r,e+1)}function a(t,e,r){for(var n=e+r,i=0;r-1>i;++i)t.addTriangle(n,e+i+1,e+i);t.addTriangle(n,e,e+r-1)}var h=t.vec3,u=t.mat3,c=e.forceRGB,f=100;return i.prototype={numVerts:function(){return this._x},addVertex:function(t,e,r,n){this._x+=1,this._e.push(t[0],t[1],t[2],e[0],e[1],e[2],r[0],r[1],r[2],r[3],n,0)},addTriangle:function(t,e,r){this._E.push(t,e,r)},numIndices:function(){return this._E.length},indexData:function(){return this._E},vertData:function(){return this._e}},n.derive(o,H,{updateProjectionIntervals:function(){},updateSquaredSphereRadius:function(t,e){return e},addTube:function(){var t=h.create(),e=h.create(),r=h.create(),n=h.create(),i=u.create();return function(o,u,f,_){_=_||{};var d=c(_.color||"white"),v=!0;void 0!==_.cap&&(v=_.cap),h.sub(n,u,o);var m=h.length(n);if(h.normalize(n,n),h.add(t,o,u),h.scale(t,t,.5),l.buildRotation(i,n,e,r,!1),v){var b=this._D.numVerts();this._D.addVertex(o,[-n[0],-n[1],-n[2]],d,0),s(this._D,b,8)}var p=void 0!==_.userData?_.userData:null,g=this._c8({center:t,userData:p,geom:this});if(this._d1.addTransformed(this._D,t,m,f,i,d,d,g,g),v){var A=this._D.numVerts();this._D.addVertex(u,n,d,0),a(this._D,A-8,8)}this._p=!1}}(),_c8:function(t){return this._bH&&this._bH.hasLeft()||(this._bH=this._er.getContinuousRange(f),this._8.push(this._bH)),this._bH.nextId(t)},destroy:function(){H.prototype.destroy.call(this);for(var t=0;t<this._8.length;++t)this._8[t].recycle()},addSphere:function(t,e,r){r=r||{};var n=c(r.color||"white"),i=void 0!==r.userData?r.userData:null,o=this._c8({center:t,userData:i,geom:this});this._d0.addTransformed(this._D,t,e,n,o),this._p=!1},_d2:function(){this._p=!0,null!==this._2&&this._2.destroy(),this._2=new W(this._b,this._D.numVerts(),this._D.numIndices(),this._C,this._J),this._2.setIndexData(this._D.indexData()),this._2.setVertData(this._D.vertData())},draw:function(t,e,r,n){if(this._U){this._p||this._d2();var i=this.shaderForStyleAndPass(e,r,n);if(i){t.bind(i),this._b.uniform1i(i.symId,255);var o=this._2;o.bind(i),o.draw(),o.releaseAttribs(i)}}},shaderForStyleAndPass:function(t,e,r){if("normal"===r)return"hemilight"===e?t.hemilight:t.phong;if("select"===r)return t.select;if("outline"===r)return t.outline;var n=t[r];return void 0!==n?n:null}}),o}(y),E=function(){"use strict";function e(t,e,r){this._cy=t,this._cc=e,this._bc=r,this._eS=r,this._bw=Date.now(),this._de=!1,this._cA=!1}function r(t,r,n){e.call(this,d.clone(t),d.clone(r),n),this._1=d.clone(t)}function i(t,r,n){var i=m.create(),o=m.create();m.fromMat4(i,t),m.fromMat4(o,r);var s=v.create(),a=v.create();v.fromMat3(s,i),v.fromMat3(a,o),this._1=m.create(),e.call(this,s,a,n)}function o(t,r){e.call(this,null,null,r),this._ca=d.clone(t),this.setLooping(!0),this._c2=0}function s(t,r){var n=1e3*(2*Math.PI/r);e.call(this,null,null,n),this._ca=d.clone(t),this.setLooping(!0),this._dS=r,this._c1=0}function a(){this._bt=[]}function h(t,e,n){return new r(t,e,n)}function u(t,e,r){return new i(t,e,r)}function c(t,r,n){return new e(t,r,n)}function f(t,e){return new s(t,e)}function _(){return new o([0,1,0],2e3)}var d=t.vec3,v=t.quat,m=t.mat3;return e.prototype={setLooping:function(t){this._de=t},step:function(t){var e,r=Date.now(),n=r-this._bw;if(0===this._bc)e=1;else if(this._de){var i=Math.floor(n/this._bc);e=(n-i*this._bc)/this._bc}else n=Math.min(this._bc,n),e=n/this._bc,this._cA=1===e;return this.apply(t,e),this._cA},apply:function(t,e){var r=(1-Math.cos(e*Math.PI))/2;this._1=this._cy*(1-r)+this._cc*r,t.setZoom(this._1)},finished:function(){return this._cA}},n.derive(r,e,{apply:function(t,e){var r=(1-Math.cos(e*Math.PI))/2;d.lerp(this._1,this._cy,this._cc,r),t.setCenter(this._1)}}),n.derive(i,e,{apply:function(){var t=v.create();return function(e,r){v.slerp(t,this._cy,this._cc,r),m.fromQuat(this._1,t),e.setRotation(this._1)}}()}),n.derive(o,e,{apply:function(){var t=m.create(),e=m.create();return function(r,n){m.fromMat4(e,r.rotation());var i=.2*Math.sin(2*n*Math.PI),o=i-this._c2;this._c2=i,l.axisRotation(t,this._ca,o),m.mul(e,t,e),r.setRotation(e)}}()}),n.derive(s,e,{apply:function(){var t=m.create(),e=m.create();return function(r,n){m.fromMat4(e,r.rotation());var i=2*Math.PI*(n-this._c1);this._c1=n,l.axisRotation(t,this._ca,i),m.mul(e,t,e),r.setRotation(e)}}(),setSpeed:function(t){this._dS=t,this._bc=1e3*(2*Math.PI/t)},setAxis:function(t){this._ca=t}}),a.prototype={run:function(t){var e=Date.now();return this._bt=this._bt.filter(function(r){return!r.step(t,e)}),this._bt.length>0},add:function(t){this._bt.push(t)},remove:function(t){this._bt=this._bt.filter(function(e){return e!==t})}},{AnimationControl:a,move:h,rotate:u,zoom:c,rockAndRoll:_,spin:f}}(),x=function(){"use strict";function t(t,e){this.near=t,this.far=e}function e(t){t=t||{},this._bj=t.near||.1,this._ba=t.far||400}function r(){this._ba=100}return e.prototype.update=function(){return new t(this._bj,this._ba)},r.prototype.update=function(e,r){for(var n=r.center(),i=null,o=0;o<e.length;++o){var s=e[o];s.visible()&&(i=s.updateSquaredSphereRadius(n,i))}if(null===i)return null;i=Math.sqrt(i);var a=r.zoom(),h=1.05*(i+a),u=.1;return new t(u,h)},{FixedSlab:e,AutoSlab:r,Slab:t}}(),T=function(r,i,o,s,a,h,u,c,f,_,d,v){"use strict";function m(){return/(iPad|iPhone|iPod)/g.test(navigator.userAgent)}function b(){return/Android/gi.test(navigator.userAgent)}function p(t){var e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT),r=!!e.precision;return r&&(m()||b())}function g(t,e){return t=t||"auto","fixed"===t?new x.FixedSlab(e):"auto"===t?new x.AutoSlab(e):null}function A(t,e,r,n,i,o,s){this._bB=n,this._dQ=t,this._d6=e,this._dR=r,this._ef=i,this._ee=o,this._ex=s}function y(t,e){this._=this._em(e,t),this._b3=!1,this._m=[],this._F=t,this._ch=!1,this._6=!1,this._eg=null,this._c7=new r,this._W=null,this._bg=null,this.listenerMap={},this._N=new v.AnimationControl,this._en(),this._ct(),this.quality(this._.quality),null!==this._.click&&this.on("click",this._.click),null!==this._.doubleClick&&this.on("doubleClick",this._.doubleClick),"complete"===document.readyState||"loaded"===document.readyState||"interactive"===document.readyState?this._di():document.addEventListener("DOMContentLoaded",n.bind(this,this._di))}function C(t,e,r){return e in t?t[e]:r}function R(t){return t.atomDoubleClick?t.atomDoubleClick:t.atomDoubleClicked?t.atomDoubleClicked:t.doubleClick?t.doubleClick:"center"}function S(t){return t.atomClick?t.atomClick:t.atomClicked?t.atomClicked:t.click?t.click:null}var w='<div style="vertical-align:middle; text-align:center;"><h1>WebGL not supported</h1><p>Your browser does not support WebGL. You might want to try Chrome, Firefox, IE 11, or newer versions of Safari</p><p>If you are using a recent version of one of the above browsers, your graphic card might be blocked. Check the browser documentation for details on how to unblock it.</p></div>',E=t.vec3,T=t.mat3,M=t.mat4,F=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}();return A.prototype={symIndex:function(){return this._dR},target:function(){return this._dQ},pos:function(){return this._bB},connectivity:function(){return this._ex},node:function(){return this._d6},transform:function(){return this._ee},object:function(){return this._ef}},y.prototype={_em:function(t,r){t=t||{},this._du=t.extensions||[],this._du.forEach(function(e){null!==e.optionOverrides&&n.update(t,e.optionOverrides())});var i={width:t.width||500,height:t.height||500,animateTime:t.animateTime||0,antialias:t.antialias,forceManualAntialiasing:C(t,"forceManualAntialiasing",!0),quality:C(t,"quality","low"),style:C(t,"style","hemilight"),background:e.forceRGB(t.background||"white"),slabMode:g(t.slabMode),outline:C(t,"outline",!0),outlineColor:e.forceRGB(C(t,"outlineColor","black")),outlineWidth:C(t,"outlineWidth",1.5),selectionColor:e.forceRGB(C(t,"selectionColor","#3f3"),.7),fov:C(t,"fov",45),doubleClick:R(t),click:S(t),fog:C(t,"fog",!0),transparency:C(t,"transparency","alpha")},o=r.getBoundingClientRect();return"auto"===i.width&&(i.width=o.width),"auto"===i.height&&(i.height=o.height),i},_cC:function(){this._6&&(this._6=!1,this._d.setViewportSize(this._c.viewportWidth(),this._c.viewportHeight()),this._cl.resize(this._.width,this._.height))},resize:function(t,e){(t!==this._.width||e!==this._.height)&&(this._c.resize(t,e),this._6=!0,this._.width=t,this._.height=e,this.requestRedraw())},fitParent:function(){var t=this._F.getBoundingClientRect();this.resize(t.width,t.height)},gl:function(){return this._c.gl()},ok:function(){return this._b3},options:function(t,r){if(void 0!==r)if(this._[t]=r,"fog"===t)this._d.fog(r),this.requestRedraw();else if("fov"===t)this._d.setFieldOfViewY(r*Math.PI/180);else if("selectionColor"===t)this._d.setSelectionColor(e.forceRGB(r,.7));else if("outlineColor"===t)this._d.setOutlineColorColor(e.forceRGB(r));else if("outlineWidth"===t)this._d.setOutlineWidth(r+0);else if("transparency"===t){var n="screendoor"===r;this._d.setScreenDoorTransparency(n)}return this._[t]},quality:function(t){return void 0===t?this._.quality:(this._.quality=t,"high"===t&&(this._.arcDetail=4,this._.sphereDetail=16,this._.splineDetail=8),"medium"===t&&(this._.arcDetail=2,this._.sphereDetail=10,this._.splineDetail=5),"low"===t&&(this._.arcDetail=2,this._.sphereDetail=8,this._.splineDetail=3),this._.quality)},imageData:function(){return this._c.imageData()},_el:function(){var t={width:this._.width,height:this._.height};this._cl=new o(this._c.gl(),t)},_di:function(){if(!this._c.initGL())return this._F.removeChild(this._c.domElement()),this._F.innerHTML=w,this._F.style.width=this._.width+"px",this._F.style.height=this._.height+"px",!1;this._el(),this._eO=this._bO.getContext("2d"),this._C=new s(Float32Array),this._J=new s(Uint16Array),this._d=new a(this._c.gl()),this._d.setUpsamplingFactor(this._c.superSamplingFactor()),this._d.setOutlineWidth(this._.outlineWidth),this._d.setOutlineEnabled(this._.outline);var t="screendoor"===this._.transparency;this._d.setScreenDoorTransparency(t),this._d.fog(this._.fog),this._d.setFogColor(this._.background),this._d.setOutlineColor(this._.outlineColor),this._d.setSelectionColor(this._.selectionColor),this._d.setFieldOfViewY(this._.fov*Math.PI/180),this._b1.setCam(this._d);var e=this._c,r=p(e.gl())?"highp":"mediump";this._cf={hemilight:e.initShader(h.HEMILIGHT_VS,h.PRELUDE_FS+h.HEMILIGHT_FS,r),phong:e.initShader(h.HEMILIGHT_VS,h.PRELUDE_FS+h.PHONG_FS,r),outline:e.initShader(h.OUTLINE_VS,h.PRELUDE_FS+h.OUTLINE_FS,r),lines:e.initShader(h.LINES_VS,h.PRELUDE_FS+h.LINES_FS,r),text:e.initShader(h.TEXT_VS,h.TEXT_FS,r),selectLines:e.initShader(h.SELECT_LINES_VS,h.SELECT_LINES_FS,r),select:e.initShader(h.SELECT_VS,h.SELECT_FS,r)},e.gl().getExtension("EXT_frag_depth")&&(this._cf.spheres=e.initShader(h.SPHERES_VS,h.PRELUDE_FS+h.SPHERES_FS,r),this._cf.selectSpheres=e.initShader(h.SELECT_SPHERES_VS,h.PRELUDE_FS+h.SELECT_SPHERES_FS,r)),this._eD=n.bind(this,this._eu),this._eQ=new u(this._c.domElement(),this,this._d);var i=this;return this._du.forEach(function(t){t.init(i)}),this._b3||(this._b3=!0,this._b7({name:"viewerReadyEvent"},"viewerReady",this)),!0},requestRedraw:function(){this._ch||(this._ch=!0,F(this._eD))},boundingClientRect:function(){return this._c.domElement().getBoundingClientRect()},_cD:function(t){for(var e=0,r=this._m.length;e!==r;++e)this._m[e].draw(this._d,this._cf,this._.style,t)},_en:function(){if(m()||b())return void(this._bm=document);var t=document.createElement("div");t.setAttribute("style","overflow:hidden;width:0;height:0"),this._bm=document.createElement("textarea"),this._F.appendChild(t),t.appendChild(this._bm),this._bm.focus()},focus:function(){this._bm!==document&&this._bm.focus()},_ct:function(){var t={antialias:this._.antialias,forceManualAntialiasing:this._.forceManualAntialiasing,height:this._.height,width:this._.width,backgroundColor:this._.background};this._c=new i.Canvas(this._F,t),this._bO=document.createElement("canvas"),this._bO.style.display="none",this._F.appendChild(this._bO),this._b1=new c(this._c,this,this._d,this._.animateTime),this._c.domElement().addEventListener("mousedown",n.bind(this,this.focus))},translate:function(){var t=E.create(),e=M.create();return function(r,n){return n|=0,M.transpose(e,this._d.rotation()),E.transformMat4(t,r,e),E.sub(t,this._d.center(),t),0===n?(this._d.setCenter(t),void this.requestRedraw()):(this._N.add(v.move(this._d.center(),E.clone(t),n)),void this.requestRedraw())}}(),rotate:function(){var t=E.create(),e=T.create(),r=M.create();return function(n,i,o){return o|=0,E.normalize(t,n),l.axisRotation(e,t,i),M.fromMat3(r,e),M.mul(r,r,this._d.rotation()),0===o?(this._d.setRotation(r),void this.requestRedraw()):(this._N.add(v.rotate(this._d.rotation(),r,o)),void this.requestRedraw())}}(),setRotation:function(t,e){if(e|=0,0===e)return this._d.setRotation(t),void this.requestRedraw();var r;9===t.length?(r=M.create(),M.fromMat3(r,t)):r=M.clone(t),this._N.add(v.rotate(this._d.rotation(),r,e)),this.requestRedraw()},setCamera:function(t,e,r,n){n|=0,this.setCenter(e,n),this.setRotation(t,n),this.setZoom(r,n)},_eG:function(){var t=this._N.run(this._d);t&&this.requestRedraw()},_eu:function(){if(null!==this._c){this._ch=!1,this._eG(),this._c.bind(),this._cC();var t=this._c.gl();t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT);var e=this._.slabMode.update(this._m,this._d);null!==e&&this._d.setNearFar(e.near,e.far),t.enable(t.CULL_FACE),this._.outline&&(t.cullFace(t.BACK),t.enable(t.CULL_FACE),this._cD("outline")),t.cullFace(t.FRONT),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),this._cD("normal")}},setCenter:function(t,e){return e|=0,0===e?void this._d.setCenter(t):(this._N.add(v.move(this._d.center(),E.clone(t),e)),void this.requestRedraw())},zoom:function(){return this._d.zoom()},setZoom:function(t,e){return e|=0,0===e?void this._d.setZoom(t):(this._N.add(v.zoom(this._d.zoom(),t,e)),void this.requestRedraw())},centerOn:function(t,e){this.setCenter(t.center(),e)},clear:function(){for(var t=0;t<this._m.length;++t)this._m[t].destroy();this._m=[]},on:function(t,e){if("keypress"===t||"keydown"===t||"keyup"===t)return void this._bm.addEventListener(t,e,!1);if("viewpointChanged"===t)return void this._d.addOnCameraChanged(e);("mousemove"===t||"mousedown"===t||"mouseup"===t)&&this._c.domElement().addEventListener(t,e,!1);var r=this.listenerMap[t];if("undefined"==typeof r&&(r=[],this.listenerMap[t]=r),"center"===e){var i=n.bind(this._b1,this._b1._ez);r.push(i)}else r.push(e);this._b3&&"viewerReady"===t&&e(this,null)},_b7:function(t,e,r){var n=this.listenerMap[e];n&&n.forEach(function(e){e(r,t)})},RENDER_MODES:["sline","lines","trace","lineTrace","cartoon","tube","spheres","ballsAndSticks","points"],renderAs:function(t,e,r,n){for(var i=!1,o=0;o<this.RENDER_MODES.length;++o)if(this.RENDER_MODES[o]===r){i=!0;break}return i?this[r](t,e,n):void 0},_0:function(t,e){return t=this._cw(t),t.showRelated=t.showRelated||"asym",t.showRelated&&"asym"!==t.showRelated&&null===e.assembly(t.showRelated)&&(t.showRelated="asym"),t},_cw:function(t){return t=n.copy(t),t.float32Allocator=this._C,t.uint16Allocator=this._J,t.idPool=this._c7,t},lineTrace:function(t,r,n){var i=this._0(n,r);i.color=i.color||e.uniform([1,0,1]),i.lineWidth=i.lineWidth||4;var o=f.lineTrace(r,this._c.gl(),i);return this.add(t,o)},spheres:function(t,r,n){var i=this._0(n,r);i.color=i.color||e.byElement(),i.sphereDetail=this.options("sphereDetail"),i.radiusMultiplier=i.radiusMultiplier||1;var o;return o=this._c.gl().getExtension("EXT_frag_depth")?f.billboardedSpheres(r,this._c.gl(),i):f.spheres(r,this._c.gl(),i),this.add(t,o)},sline:function(t,r,n){var i=this._0(n,r);i.color=i.color||e.uniform([1,0,1]),i.splineDetail=i.splineDetail||this.options("splineDetail"),i.strength=i.strength||1,i.lineWidth=i.lineWidth||4;var o=f.sline(r,this._c.gl(),i);return this.add(t,o)},cartoon:function(t,r,n){var i=this._0(n,r);i.color=i.color||e.bySS(),i.strength=i.strength||1,i.splineDetail=i.splineDetail||this.options("splineDetail"),i.arcDetail=i.arcDetail||this.options("arcDetail"),i.radius=i.radius||.3,i.forceTube=i.forceTube||!1,i.smoothStrands=void 0===i.smoothStrands||i.smoothStrands;var o=f.cartoon(r,this._c.gl(),i),s=this.add(t,o);return s},surface:function(t,e,r){var n=this._cw(r),i=f.surface(e,this._c.gl(),n);return this.add(t,i)},tube:function(t,e,r){return r=r||{},r.forceTube=!0,this.cartoon(t,e,r)},ballsAndSticks:function(t,r,n){var i=this._0(n,r);i.color=i.color||e.byElement(),i.cylRadius=i.radius||i.cylRadius||.1,i.sphereRadius=i.radius||i.sphereRadius||.2,i.arcDetail=2*(i.arcDetail||this.options("arcDetail")),i.sphereDetail=i.sphereDetail||this.options("sphereDetail"),i.scaleByAtomRadius=C(i,"scaleByAtomRadius",!0);var o=f.ballsAndSticks(r,this._c.gl(),i);return this.add(t,o)},lines:function(t,r,n){var i=this._0(n,r);i.color=i.color||e.byElement(),i.lineWidth=i.lineWidth||4;var o=f.lines(r,this._c.gl(),i);return this.add(t,o)},points:function(t,r,n){var i=this._0(n,r);i.color=i.color||e.byElement(),i.pointSize=i.pointSize||1;var o=f.points(r,this._c.gl(),i);return this.add(t,o)},trace:function(t,r,n){var i=this._0(n,r);i.color=i.color||e.uniform([1,0,0]),i.radius=i.radius||.3,i.arcDetail=2*(i.arcDetail||this.options("arcDetail")),i.sphereDetail=i.sphereDetail||this.options("sphereDetail");var o=f.trace(r,this._c.gl(),i);return this.add(t,o)},_cM:function(t,e,r){r.eachAtom(function(r){for(var n=r.pos(),i=0;3>i;++i)e[i].update(E.dot(n,t[i]))});for(var n=0;3>n;++n)e[n].extend(1.5)},fitTo:function(t,e){var r=this._d.mainAxes(),i=[new n.Range,new n.Range,new n.Range];if(t instanceof H)t.updateProjectionIntervals(r[0],r[1],r[2],i[0],i[1],i[2]);else if(void 0!==t.eachAtom)this._cM(r,i,t);else if(void 0!==t.length)for(var o=0;o<t.length;++o)this._cM(r,i,t[o]);this._ds(r,i,e)},_ds:function(t,e,r){if(!(e[0].empty()||e[1].empty()||e[2].empty())){var n=e[0].center(),i=e[1].center(),o=e[2].center(),s=[n*t[0][0]+i*t[1][0]+o*t[2][0],n*t[0][1]+i*t[1][1]+o*t[2][1],n*t[0][2]+i*t[1][2]+o*t[2][2]],a=this._d.fieldOfViewY(),h=this._d.aspectRatio(),u=e[0].length()/h,c=e[1].length(),l=.5*Math.max(u,c),f=l/Math.tan(.5*a),_=f+.5*e[2].length(),d=.5,v=Math.max(f-d,.1),m=2*d+f+e[2].length();this._d.setNearFar(v,m);var b=void 0===r?this._.animateTime:0|r;this.setCamera(this._d.rotation(),s,_,b),this.requestRedraw()}},autoZoom:function(t){var e=this._d.mainAxes(),r=[new n.Range,new n.Range,new n.Range];this.forEach(function(t){t.visible()&&t.updateProjectionIntervals(e[0],e[1],e[2],r[0],r[1],r[2])}),this._ds(e,r,t)},slabInterval:function(){},autoSlab:function(){var t=this._._eR.update(this._m,this._d);null!==t&&this._d.setNearFar(t.near,t.far),this.requestRedraw()},rockAndRoll:function(t){return void 0===t?null!==this._bg:t?(null===this._bg&&(this._bg=v.rockAndRoll(),this._N.add(this._bg),this.requestRedraw()),!0):(this._N.remove(this._bg),this._bg=null,this.requestRedraw(),!1)},spin:function(t,e){return void 0===t?null!==this._W:t===!1?(this._N.remove(this._W),this._W=null,this.requestRedraw(),!1):(t===!0&&(t=Math.PI/8),e=e||[0,1,0],null===this._W?(this._W=v.spin(e,t),this._N.add(this._W)):(this._W.setSpeed(t),this._W.setAxis(e)),this.requestRedraw(),!0)},slabMode:function(t,e){e=e||{};var r=g(t,e),n=r.update(this._m,this._d);null!==n&&this._d.setNearFar(n.near,n.far),this._.slabMode=r,this.requestRedraw()},label:function(t,e,r,n){var i=new _(this._c.gl(),this._bO,this._eO,r,e,n);return this.add(t,i),i},customMesh:function(t,e){var r=this._cw(e),n=new d(t,this._c.gl(),r.float32Allocator,r.uint16Allocator,r.idPool);return this.add(t,n),n},_et:function(){var t=this._c.gl();t.clearColor(0,0,0,0),t.disable(t.BLEND),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.clearColor(this._.background[0],this._.background[1],this._.background[2],1),t.cullFace(t.FRONT),t.enable(t.CULL_FACE),this._cD("select")},pick:function(){return function(t){this._cl.bind(),this._et();var e=new Uint8Array(4),r=this._c.gl();r.readPixels(t.x,this._.height-t.y,1,1,r.RGBA,r.UNSIGNED_BYTE,e),this._cl.release(),e.data&&(e=e.data);var n=e[0]|e[1]<<8|e[2]<<16,i=e[3],o=this._c7.objectForId(n);if(void 0===o)return null;var s=E.create(),a=null,h=null,u="unknown";return 255!==i?(a=o.atom,h=o.geom.symWithIndex(i),E.transformMat4(s,o.atom.pos(),h),u=o.isTrace?"trace":"full"):void 0!==o.atom?(a=o.atom,s=o.atom.pos(),u=o.isTrace?"trace":"full"):(a=o.userData,s=o.center),new A(a,o.geom,255>i?i:null,s,o,h,u)}}(),add:function(t,e){return e.name(t),this._m.push(e),this._m.sort(function(t,e){return t.order()-e.order()}),this.requestRedraw(),e},_dl:function(t){var e=t.replace(".","\\.").replace("*",".*");return new RegExp("^"+e+"$")},forEach:function(){var t,e="*";2===arguments.length?(t=arguments[1],e=arguments[0]):t=arguments[0];for(var r=this._dl(e),n=0;n<this._m.length;++n){var i=this._m[n];r.test(i.name())&&t(i,n)}},rotation:function(){return this._d.rotation()},center:function(){return this._d.center()},get:function(t){for(var e=0;e<this._m.length;++e)if(this._m[e].name()===t)return this._m[e];return null},hide:function(t){this.forEach(t,function(t){t.hide()})},show:function(t){this.forEach(t,function(t){t.show()})},rm:function(t){for(var e=[],r=this._dl(t),n=0;n<this._m.length;++n){var i=this._m[n];r.test(i.name())?i.destroy():e.push(i)}this._m=e},all:function(){return this._m},isWebGLSupported:function(){return this._c.isWebGLSupported()},destroy:function(){this.clear(),this._c.destroy(),this._c=null}},y.prototype.addListener=y.prototype.on,{Viewer:function(t,e){return new y(t,e)},isWebGLSupported:i.isWebGLSupported}}(r,i,o,s,a,h,u,c,R,S,w,E),M=function(){"use strict";function t(t,e){this._j=t||[],this._co=e||[]}function e(t){this._L=t,this._cx=[]}return t.prototype={addChain:function(t){this._j.push(t)},chains:function(){return this._j},addMatrix:function(t){this._co.push(t)},matrices:function(){return this._co},matrix:function(t){return this._co[t]}},e.prototype={name:function(){return this._L},generators:function(){return this._cx},generator:function(t){return this._cx[t]},addGenerator:function(t){this._cx.push(t)}},{SymGenerator:t,Assembly:e}}(),F=function(){"use strict";function e(){}function r(t,r,n,i,o,s,a,h,u){e.call(this),this._bA={},this._t=t,this._cI=[],this._ei=!!s,this._L=r,this._bB=n,this._cu=o,this._bb=i,this._d4=void 0!==a?a:null,this._dP=void 0!==h?h:null,this._dT=0|u}function i(t,r){e.call(this),this._dV=t,this._A=r,this._cI=[]}var o=t.vec3;return e.prototype={bondCount:function(){return this.bonds().length},eachBond:function(t){for(var e=this.bonds(),r=0,n=e.length;n>r;++r)t(e[r])},isConnectedTo:function(t){if(null===t)return!1;for(var e=t.full(),r=this.full(),n=this.bonds(),i=0,o=n.length;o>i;++i){var s=n[i];if(s.atom_one()===r&&s.atom_two()===e||s.atom_one()===e&&s.atom_two()===r)return!0}return!1}},n.derive(r,e,{addBond:function(t){this._cI.push(t)},name:function(){return this._L},bonds:function(){return this._cI},residue:function(){return this._t},structure:function(){return this._t.structure()},full:function(){return this},qualifiedName:function(){return this.residue().qualifiedName()+"."+this.name()},pos:function(){return this._bB},setPos:function(t){o.copy(this._bB,t)},element:function(){return this._bb},index:function(){return this._cu},occupancy:function(){return this._d4},tempFactor:function(){return this._dP},serial:function(){return this._dT},isHetatm:function(){return this._ei},prop:function(t){var e=this[t];if(void 0!==e)return e.call(this);var r=this._bA[t];return void 0===r?0:r},setProp:function(t,e){this._bA[t]=e}}),n.derive(i,e,{full:function(){return this._A},name:function(){return this._A.name()},pos:function(){return this._A.pos()},element:function(){return this._A.element()},residue:function(){return this._dV},bonds:function(){return this._A.bonds()},index:function(){return this._A.index()},occupancy:function(){return this._A.occupancy()},tempFactor:function(){return this._A.tempFactor()},serial:function(){return this._A.serial()},qualifiedName:function(){return this._A.qualifiedName()},isHetatm:function(){return this._A.isHetatm()},prop:function(t){return this._A.prop(t)},setProp:function(t,e){this._A.setProp(t,e)}}),{Atom:r,AtomView:i}}(),I=function(e){"use strict";function r(){}function i(t,e,n,i){r.call(this),this._L=e,this._d5=n,this._ek=i,this._r=[],this._cR="C",this._M=t,this._dg=!1,this._df=!1,this._cu=t.residues().length,this._bA={}}function o(t,e){r.call(this),this._ey=t,this._r=[],this._t=e}var s=t.vec3,a=e.Atom,h=e.AtomView;return r.prototype={isWater:function(){return"HOH"===this.name()||"DOD"===this.name()},eachAtom:function(t,e){e|=0;for(var r=0;r<this._r.length;r+=1){if(t(this._r[r],e)===!1)return!1;e+=1}return e},qualifiedName:function(){var t=this.chain().name()+"."+this.name()+this.num();return"\0"===this.insCode()?t:t+this.insCode()},atom:function(t){if("string"==typeof t){for(var e=0;e<this._r.length;++e)if(this._r[e].name()===t)return this._r[e];
return null}return t>=this._r.length||0>t?null:this._r[t]},centralAtom:function(){return this.isAminoacid()?this.atom("CA"):this.isNucleotide()?this.atom("C3'"):null},center:function(){var t=0,e=s.create();return this.eachAtom(function(r){s.add(e,e,r.pos()),t+=1}),t>0&&s.scale(e,e,1/t),e},isAminoacid:function(){return this._dg},isNucleotide:function(){return this._df}},n.derive(i,r,{_ev:function(){this._df=null!==this.atom("P")&&null!==this.atom("C3'"),this._dg=null!==this.atom("N")&&null!==this.atom("CA")&&null!==this.atom("C")&&null!==this.atom("O")},name:function(){return this._L},insCode:function(){return this._ek},num:function(){return this._d5},full:function(){return this},addAtom:function(t,e,r,n,i,o,s){var h=new a(this,t,e,r,this.structure().nextAtomIndex(),n,i,o,0|s);return this._r.push(h),h},ss:function(){return this._cR},setSS:function(t){this._cR=t},index:function(){return this._cu},atoms:function(){return this._r},chain:function(){return this._M},structure:function(){return this._M.structure()},prop:function(t){var e=this[t];if(void 0!==e)return e.call(this);var r=this._bA[t];return void 0===r?0:r},setProp:function(t,e){this._bA[t]=e}}),n.derive(o,r,{addAtom:function(t,e){if(e)for(var r=0;r<this._r.length;++r){var n=this._r[r];if(n.index()===t.index())return n}var i=new h(this,t.full());return this._r.push(i),i},removeAtom:function(t){var e=this._r.length;return this._r=this._r.filter(function(e){return e.index()!==t.index()}),e!==this._r.length},full:function(){return this._t},num:function(){return this._t.num()},insCode:function(){return this._t.insCode()},ss:function(){return this._t.ss()},index:function(){return this._t.index()},chain:function(){return this._ey},name:function(){return this._t.name()},atoms:function(){return this._r},qualifiedName:function(){return this._t.qualifiedName()},containsResidue:function(t){return this._t.full()===t.full()},isAminoacid:function(){return this._t.isAminoacid()},isNucleotide:function(){return this._t.isNucleotide()},isWater:function(){return this._t.isWater()},prop:function(t){return this._t.prop(t)},setProp:function(t,e){this._t.setProp(t,e)}}),{ResidueView:o,Residue:i}}(F),D=function(){"use strict";function e(){this._v=[]}function r(t,e,r){this._b4=t,this._9=e,this._dm=r,this._cr=0===this._9,this._cs=this._b4.length()===this._dm;var n=this._dm-this._9;this._cs||++n,this._cr||(++n,this._9-=1),this._b2=n}var n=t.vec3;return e.prototype={push:function(t){this._v.push(t)},length:function(){return this._v.length},residueAt:function(t){return this._v[t]},posAt:function(t,e){return n.copy(t,this._v[e].centralAtom().pos()),t},normalAt:function(t,e){var r=this._v[e];return r.isAminoacid()&&n.sub(t,r.atom("O").pos(),r.atom("C").pos()),n.normalize(t,t),t},centralAtomAt:function(t){return this._v[t].centralAtom()},tangentAt:function(){var t=n.create(),e=n.create();return function(r,i){i>0?this.posAt(t,i-1):this.posAt(t,i),i<this._v.length-1?this.posAt(e,i+1):this.posAt(e,i),n.sub(r,e,t)}}(),fullTraceIndex:function(t){return t},residues:function(){return this._v},subsets:function(t){for(var e=0,n=0,i=[];n<t.length&&e<this._v.length;){for(var o=t[n].full().index();this._v.length>e&&this._v[e].index()<o;)++e;if(e>=this._v.length)break;for(var s=this._v[e].index();t.length>n&&t[n].full().index()<s;)++n;if(n>=t.length)break;for(var a=e;t.length>n&&this._v.length>e&&t[n].full().index()===this._v[e].index();)++n,++e;var h=e;i.push(new r(this,a,h))}return i}},e.prototype.smoothPosAt=e.prototype.posAt,e.prototype.smoothNormalAt=e.prototype.normalAt,r.prototype={length:function(){return this._b2},residueAt:function(t){return this._b4.residueAt(this._9+t)},residues:function(){for(var t=[],e=0;e<this._b2;++e)t.push(this.residueAt(e));return t},_dh:function(){var t=n.create(),e=n.create();return function(r,i,o,s){return this.tangentAt(t,i),this.tangentAt(e,o),n.scale(t,t,s),n.scale(e,e,s),l.cubicHermiteInterpolate(r,this.centralAtomAt(i).pos(),t,this.centralAtomAt(o).pos(),e,.5,0),r}}(),smoothPosAt:function(){return function(t,e,r){if(0===e&&!this._cr)return this._dh(t,e,e+1,r);if(e===this._b2-1&&!this._cs)return this._dh(t,e-1,e,r);var i=this.centralAtomAt(e);return n.copy(t,i.pos()),t}}(),smoothNormalAt:function(){return function(t,e){return this._b4.normalAt(t,e+this._9),t}}(),posAt:function(t,e){var r=this.centralAtomAt(e),i=null;return n.copy(t,r.pos()),0!==e||this._cr||(i=this.centralAtomAt(e+1),n.add(t,t,i.pos()),n.scale(t,t,.5)),e!==this._b2-1||this._cs||(i=this.centralAtomAt(e-1),n.add(t,t,i.pos()),n.scale(t,t,.5)),t},centralAtomAt:function(t){return this.residueAt(t).centralAtom()},fullTraceIndex:function(t){return this._9+t},tangentAt:function(t,e){return this._b4.tangentAt(t,e+this._9)}},{TraceSubset:r,BackboneTrace:e}}(),P=function(e,r){"use strict";function i(t,e){return t<<8|e.charCodeAt(0)}function o(t,e){return t.num()<e.num()}function s(t){return{num:function(){return t}}}function a(){}function h(t,e){a.call(this),this._g=t,this._L=e,this._bs=[],this._q=[],this._5=!0}function u(t,e,r){var n,i;if(t?(n=e.atom("C"),i=r.atom("N")):(n=e.atom("O3'"),i=r.atom("P")),n.isConnectedTo(i))return!1;var o=_.sqrDist(n.pos(),i.pos());return Math.abs(o-2.25)>1}function c(t,e){e.length()<2||t.push(e)}function l(t,e,r){if(0===t.length)return!0;if(!e)return!1;var n=i(r.num(),r.insCode()),o=t[t.length-1],s=i(o.num(),o.insCode());return n>s}function f(t,e){a.call(this),this._M=e,this._q=[],this._ed=t,this._by={},this._5=!0}var _=t.vec3,d=e.Residue,v=e.ResidueView;return a.prototype={eachAtom:function(t,e){e|=0;for(var r=0;r<this._q.length;r+=1)if(e=this._q[r].eachAtom(t,e),e===!1)return!1;return e},atomCount:function(){for(var t=0,e=this.residues(),r=0;r<e.length;++r)t+=e[r].atoms().length;return t},eachResidue:function(t){for(var e=0;e<this._q.length;e+=1)if(t(this._q[e])===!1)return!1},residues:function(){return this._q},structure:function(){return this._g},asView:function(){var t=this.structure().createEmptyView();return t.addChain(this,!0),t},residueByRnum:function(t){var e=this.residues();if(this._5){var r=n.binarySearch(e,s(t),o);return-1===r?null:e[r]}for(var i=0;i<e.length;++i)if(e[i].num()===t)return e[i];return null},residuesInRnumRange:function(t,e){var r,i,a=[],h=this.residues();if(this._5===!0){var u=n.indexFirstLargerEqualThan(h,s(t),o);if(-1===u)return a;var c=n.indexLastSmallerEqualThan(h,s(e),o);if(-1===c)return a;for(r=u;c>=r;++r)a.push(this._q[r])}else for(r=0,i=h.length;r!==i;++r){var l=h[r];l.num()>=t&&l.num()<=e&&a.push(l)}return a},prop:function(t){return this[t]()}},n.derive(h,a,{name:function(){return this._L},full:function(){return this},addResidue:function(t,e,r){r=r||"\0";var n=new d(this,t,e,r);return this._5=l(this._q,this._5,n),this._q.push(n),n},assignSS:function(t,e,r){for(var n=i(t[0],t[1]),o=i(e[0],e[1]),s=1;s<this._q.length-1;++s){var a=this._q[s],h=i(a.num(),a.insCode());n>h||h>=o||a.setSS(r)}},eachBackboneTrace:function(t){this._eB();for(var e=0;e<this._bs.length;++e)t(this._bs[e])},_eB:function(){if(!(this._bs.length>0)){for(var t=new r.BackboneTrace,e=null,n=0;n<this._q.length;n+=1){var i=this._q[n],o=i.isAminoacid(),s=i.isNucleotide();if(e===!0&&!o||e===!1&&!s||null===e&&!s&&!o)c(this._bs,t),e=null,t=new r.BackboneTrace;else if(0!==t.length()){var a=this._q[n-1];u(e,a,i)&&(c(this._bs,t),t=new r.BackboneTrace),t.push(i)}else t.push(i),e=i.isAminoacid()}c(this._bs,t)}},backboneTraces:function(){var t=[];return this.eachBackboneTrace(function(e){t.push(e)}),t}}),n.derive(f,a,{addResidue:function(t,e){var r=new v(this,t.full());if(this._5=l(this._q,this._5,t),this._q.push(r),this._by[t.full().index()]=r,e)for(var n=t.atoms(),i=0;i<n.length;++i)r.addAtom(n[i].full(),!1);return r},addAtom:function(t){var e=this._by[t.residue().full().index()];return void 0===e&&(e=this.addResidue(t.residue())),e.addAtom(t,!0)},removeAtom:function(t,e){var r=this._by[t.residue().full().index()];if(void 0===r)return!1;var n=r.removeAtom(t);return n&&0===r.atoms().length&&e&&(delete this._by[t.residue().full().index()],this._q=this._q.filter(function(t){return t!==r})),n},containsResidue:function(t){var e=this._by[t.full().index()];return void 0!==e&&e.full()===t.full()},eachBackboneTrace:function(t){for(var e=this._M.backboneTraces(),r=0;r<e.length;++r)for(var n=e[r].subsets(this._q),i=0;i<n.length;++i)t(n[i])},backboneTraces:function(){var t=[];return this.eachBackboneTrace(function(e){t.push(e)}),t},full:function(){return this._M},name:function(){return this._M.name()},structure:function(){return this._ed}}),{Chain:h,ChainView:f}}(I,D),V=function(){"use strict";var e=t.vec3,r=function(t,r){var n={atom_one:t,atom_two:r};return{atom_one:function(){return n.atom_one},atom_two:function(){return n.atom_two},mid_point:function(t){return t||(t=e.create()),e.add(t,n.atom_one.pos(),n.atom_two.pos()),e.scale(t,t,.5),t}}};return{Bond:r}}(),N=function(){function t(t,e){for(var r=0;r<e.length;++r)if(!e[r](t))return!1;return!0}function e(t){var e=[];return void 0!==t.aname&&e.push(function(e){return e.name()===t.aname}),void 0!==t.hetatm&&e.push(function(e){return e.isHetatm()===t.hetatm}),void 0!==t.anames&&e.push(function(e){for(var r=e.name(),n=0;n<t.anames.length;++n)if(r===t.anames[n])return!0;return!1}),e}function r(t){var e=[];if(void 0!==t.rname&&e.push(function(e){return e.name()===t.rname}),void 0!==t.rnames&&e.push(function(e){for(var r=e.name(),n=0;n<t.rnames.length;++n)if(r===t.rnames[n])return!0;return!1}),void 0!==t.rnums){for(var r={},n=0;n<t.rnums.length;++n)r[t.rnums[n]]=!0;e.push(function(t){var e=t.num();return r[e]===!0})}return void 0!==t.rnum&&e.push(function(e){return e.num()===t.rnum}),void 0!==t.rtype&&e.push(function(e){return e.ss()===t.rtype}),e}function n(t){var e=[];return void 0!==t.cname&&(t.chain=t.cname),void 0!==t.cnames&&(t.chains=t.cnames),void 0!==t.chain&&e.push(function(e){return e.name()===t.chain}),void 0!==t.chains&&e.push(function(e){for(var r=e.name(),n=0;n<t.chains.length;++n)if(r===t.chains[n])return!0;return!1}),e}function i(t,e){var r=t.residues();e.rnumRange&&(r=t.residuesInRnumRange(e.rnumRange[0],e.rnumRange[1]));var n,i,o=[];if(void 0!==e.rindexRange){for(n=e.rindexRange[0],i=Math.min(r.length-1,e.rindexRange[1]);i>=n;++n)o.push(r[n]);return o}if(e.rindices&&void 0!==e.rindices.length){for(o=[],n=0;n<e.rindices.length;++n)o.push(r[e.rindices[n]]);return o}return r}function o(o,s,a){var h=r(a),u=e(a),c=n(a);a.rindex&&(a.rindices=[a.rindex]);for(var l=0;l<o._j.length;++l){var f=o._j[l];if(t(f,c))for(var _=i(f,a),d=null,v=0;v<_.length;++v)if(t(_[v],h)){d||(d=s.addChain(f,!1));for(var m=null,b=_[v].atoms(),p=0;p<b.length;++p)t(b[p],u)&&(m||(m=d.addResidue(_[v],!1)),m.addAtom(b[p]))}}return s}function s(t,e){for(var r=0;r<t._j.length;++r){var n=t._j[r],i=n.backboneTraces();if(0!==i.length)for(var o=e.addChain(n),s=0;s<i.length;++s)for(var a=i[s].residues(),h=0;h<a.length;++h)o.addResidue(a[h],!0)}return e}return{dict:o,polymer:s}}(),L=K=function(e,r,i){"use strict";function o(t){var e=m[t.toUpperCase()];return void 0!==e?e:1.5}function s(t,e,r){var n=e.atom("C"),i=r.atom("N");if(n&&i){var o=f.sqrDist(n.pos(),i.pos());1.6*1.6>o&&t.connect(i,n)}}function a(t,e,r){var n=e.atom("O3'"),i=r.atom("P");if(n&&i){var o=f.sqrDist(n.pos(),i.pos());1.7*1.7>o&&t.connect(n,i)}}function h(){}function u(){h.call(this),this._j=[],this._T=[],this._c9=0}function c(t){h.call(this),this._db=t,this._j=[]}var f=t.vec3,_=e.Chain,d=e.ChainView,v=r.Bond,m={H:.31,HE:.28,LI:1.28,BE:.96,B:.84,C:.76,N:.71,O:.66,F:.57,NE:.58,NA:1.66,MG:1.41,AL:1.21,SI:1.11,P:1.07,S:1.05,CL:1.02,AR:1.06,K:2.03,CA:1.76,SC:1.7,TI:1.6,V:1.53,CR:1.39,MN:1.39,FE:1.32,CO:1.26,NI:1.24,CU:1.32,ZN:1.22,GA:1.22,GE:1.2,AS:1.19,SE:1.2,BR:1.2,KR:1.16,RB:2.2,SR:1.95,Y:1.9,ZR:1.75,NB:1.64,MO:1.54,TC:1.47,RU:1.46,RH:1.42,PD:1.39,AG:1.45,CD:1.44,IN:1.42,SN:1.39,SB:1.39,TE:1.38,I:1.39,XE:1.4,CS:2.44,BA:2.15,LA:2.07,CE:2.04,PR:2.03,ND:2.01,PM:1.99,SM:1.98,EU:1.98,GD:1.96,TB:1.94,DY:1.92,HO:1.92,ER:1.89,TM:1.9,YB:1.87,LU:1.87,HF:1.75,TA:1.7,W:1.62,RE:1.51,OS:1.44,IR:1.41,PT:1.36,AU:1.36,HG:1.32,TL:1.45,PB:1.46,BI:1.48,PO:1.4,AT:1.5,RN:1.5,FR:2.6,RA:2.21,AC:2.15,TH:2.06,PA:2,U:1.96,NP:1.9,PU:1.87,AM:1.8,CM:1.69};return h.prototype={eachResidue:function(t){for(var e=0;e<this._j.length;e+=1)if(this._j[e].eachResidue(t)===!1)return!1},eachAtom:function(t,e){e|=0;for(var r=0;r<this._j.length;r+=1)if(e=this._j[r].eachAtom(t,e),e===!1)return!1},residueCount:function(){for(var t=this.chains(),e=0,r=0;r<t.length;++r)e+=t[r].residues().length;return e},eachChain:function(t){for(var e=this.chains(),r=0;r<e.length;++r)if(t(e[r])===!1)return},atomCount:function(){for(var t=this.chains(),e=0,r=0;r<t.length;++r)e+=t[r].atomCount();return e},atoms:function(){var t=[];return this.eachAtom(function(e){t.push(e)}),t},atom:function(t){var e=t.split("."),r=this.chain(e[0]);if(null===r)return null;var n=r.residueByRnum(parseInt(e[1],10));return null===n?null:n.atom(e[2])},center:function(){var t=f.create(),e=0;return this.eachAtom(function(r){f.add(t,t,r.pos()),e+=1}),e&&f.scale(t,t,1/e),t},boundingSphere:function(){var t=this.center(),e=0;return this.eachAtom(function(r){e=Math.max(e,f.sqrDist(t,r.pos()))}),new l.Sphere(t,Math.sqrt(e))},backboneTraces:function(){for(var t=this.chains(),e=[],r=0;r<t.length;++r)Array.prototype.push.apply(e,t[r].backboneTraces());return e},select:function(t){return"protein"===t?this.residueSelect(function(t){return t.isAminoacid()}):"water"===t?this.residueSelect(function(t){return t.isWater()}):"ligand"===t?this.residueSelect(function(t){return!t.isAminoacid()&&!t.isWater()}):"polymer"===t?i.polymer(this,new c(this)):i.dict(this,new c(this),t||{})},residueSelect:function(t){for(var e=new c(this.full()),r=0;r<this._j.length;++r)for(var n=this._j[r],i=null,o=n.residues(),s=0;s<o.length;++s)t(o[s])&&(i||(i=e.addChain(n,!1)),i.addResidue(o[s],!0));return e},atomSelect:function(t){for(var e=new c(this.full()),r=0;r<this._j.length;++r)for(var n=this._j[r],i=null,o=n.residues(),s=0;s<o.length;++s)for(var a=null,h=o[s],u=h.atoms(),l=0;l<u.length;++l)t(u[l])&&(i||(i=e.addChain(n,!1)),a||(a=i.addResidue(h,!1)),a.addAtom(u[l]));return e},assembly:function(t){for(var e=this.assemblies(),r=0;r<e.length;++r)if(e[r].name()===t)return e[r];return null},chainsByName:function(t){for(var e={},r=this.chains(),n=0;n<r.length;++n)e[r[n].name()]=r[n];for(var i=[],o=0;o<t.length;++o){var s=e[t[o]];void 0!==s&&i.push(s)}return i},selectWithin:function(){var t=f.create();return function(e,r){r=r||{};var n=r.radius||4,i=n*n,o=!!r.matchResidues,s=[];e.eachAtom(function(t){s.push(t)});for(var a=new c(this.full()),h=null,u=null,l=this.chains(),_=!1,d=0;d<l.length;++d){var v=l[d].residues();u=null;for(var m=0;m<v.length;++m){h=null,_=!1;for(var b=v[m].atoms(),p=0;p<b.length&&!_;++p)for(var g=0;g<s.length;++g)if(f.sub(t,b[p].pos(),s[g].pos()),!(f.sqrLen(t)>i)){if(u||(u=a.addChain(l[d].full(),!1)),h||(h=u.addResidue(v[m].full(),o)),o){_=!0;break}h.addAtom(b[p].full());break}}}return a}}(),createEmptyView:function(){return new c(this.full())}},n.derive(u,h,{addAssembly:function(t){this._T.push(t)},setAssemblies:function(t){this._T=t},assemblies:function(){return this._T},chains:function(){return this._j},full:function(){return this},containsResidue:function(t){return t.full().structure()===this},chainByName:function(t){for(var e=0;e<this._j.length;++e)if(this._j[e].name()===t)return this._j[e];return null},chain:function(t){return this.chainByName(t)},nextAtomIndex:function(){var t=this._c9;return this._c9+=1,t},addChain:function(t){var e=new _(this,t);return this._j.push(e),e},connect:function(t,e){var r=new v(t,e);return t.addBond(r),e.addBond(r),r},deriveConnectivity:function(){var t=this,e=null;this.eachResidue(function(r){for(var n,i=r.atoms(),h=i.length,u=0;h>u;u+=1)for(var c=i[u],l=c.pos(),_=o(c.element()),d=0;u>d;d+=1){var v=i[d],m=o(v.element());n=f.sqrDist(l,v.pos());var b=_+m-.3,p=_+m+.3;p*p>n&&n>b*b&&t.connect(c,v)}r._ev(),null!==e&&(r.isAminoacid()&&e.isAminoacid()&&s(t,e,r),r.isNucleotide()&&e.isNucleotide()&&a(t,e,r)),e=r})}}),n.derive(c,h,{full:function(){return this._db},assemblies:function(){return this._db.assemblies()},addChain:function(t,e){var r=new d(this,t.full());if(this._j.push(r),e)for(var n=t.residues(),i=0;i<n.length;++i)r.addResidue(n[i],!0);return r},addAtom:function(t){var e=this.chain(t.residue().chain().name());return null===e&&(e=this.addChain(t.residue().chain())),e.addAtom(t)},removeAtom:function(t,e){if(null===t)return!1;var r=this.chain(t.residue().chain().name());if(null===r)return!1;var n=r.removeAtom(t,e);return n&&0===r.residues().length&&(this._j=this._j.filter(function(t){return t!==r})),n},containsResidue:function(t){if(!t)return!1;var e=this.chain(t.chain().name());return!!e&&e.containsResidue(t)},addResidues:function(t,e){var r=this,n={};return t.forEach(function(t){var i=t.chain().name();"undefined"==typeof n[i]&&(n[i]=r.addChain(t.chain(),!1)),n[i].addResidue(t,e)}),n},chains:function(){return this._j},chain:function(t){for(var e=0;e<this._j.length;++e)if(this._j[e].name()===t)return this._j[e];return null}}),{MolView:c,Mol:u}}(P,V,N),O=function(){function t(t){function e(t,e){return t=Math.abs(t),e=Math.abs(e),t>e?t*Math.sqrt(1+e*e/t/t):0==e?t:e*Math.sqrt(1+t*t/e/e)}var r,n=Math.pow(2,-52),i=1e-64/n,o=50,s=0,a=0,h=0,u=0,c=0,l=t,f=l.length,_=l[0].length;if(_>f)throw"Need more rows than columns";var d=new Array(_),v=new Array(_);for(a=0;_>a;a++)d[a]=v[a]=0;for(var m=[],a=0;_>a;++a){var b=[];m.push([]);for(var h=0;_>h;++h)b.push(0);m.push(b)}var p=0,g=0,A=0,y=0,C=0,R=0,S=0;for(a=0;_>a;a++){for(d[a]=g,S=0,c=a+1,h=a;f>h;h++)S+=l[h][a]*l[h][a];if(i>=S)g=0;else for(p=l[a][a],g=Math.sqrt(S),p>=0&&(g=-g),A=p*g-S,l[a][a]=p-g,h=c;_>h;h++){for(S=0,u=a;f>u;u++)S+=l[u][a]*l[u][h];for(p=S/A,u=a;f>u;u++)l[u][h]+=p*l[u][a]}for(v[a]=g,S=0,h=c;_>h;h++)S+=l[a][h]*l[a][h];if(i>=S)g=0;else{for(p=l[a][a+1],g=Math.sqrt(S),p>=0&&(g=-g),A=p*g-S,l[a][a+1]=p-g,h=c;_>h;h++)d[h]=l[a][h]/A;for(h=c;f>h;h++){for(S=0,u=c;_>u;u++)S+=l[h][u]*l[a][u];for(u=c;_>u;u++)l[h][u]+=S*d[u]}}C=Math.abs(v[a])+Math.abs(d[a]),C>y&&(y=C)}for(a=_-1;-1!=a;a+=-1){if(0!=g){for(A=g*l[a][a+1],h=c;_>h;h++)m[h][a]=l[a][h]/A;for(h=c;_>h;h++){for(S=0,u=c;_>u;u++)S+=l[a][u]*m[u][h];for(u=c;_>u;u++)m[u][h]+=S*m[u][a]}}for(h=c;_>h;h++)m[a][h]=0,m[h][a]=0;m[a][a]=1,g=d[a],c=a}for(a=_-1;-1!=a;a+=-1){for(c=a+1,g=v[a],h=c;_>h;h++)l[a][h]=0;if(0!=g){for(A=l[a][a]*g,h=c;_>h;h++){for(S=0,u=c;f>u;u++)S+=l[u][a]*l[u][h];for(p=S/A,u=a;f>u;u++)l[u][h]+=p*l[u][a]}for(h=a;f>h;h++)l[h][a]=l[h][a]/g}else for(h=a;f>h;h++)l[h][a]=0;l[a][a]+=1}for(n*=y,u=_-1;-1!=u;u+=-1)for(var w=0;o>w;w++){var E=!1;for(c=u;-1!=c;c+=-1){if(Math.abs(d[c])<=n){E=!0;break}if(Math.abs(v[c-1])<=n)break}if(!E){s=0,S=1;var x=c-1;for(a=c;u+1>a&&(p=S*d[a],d[a]=s*d[a],!(Math.abs(p)<=n));a++)for(g=v[a],A=e(p,g),v[a]=A,s=g/A,S=-p/A,h=0;f>h;h++)C=l[h][x],R=l[h][a],l[h][x]=C*s+R*S,l[h][a]=-C*S+R*s}if(R=v[u],c==u){if(0>R)for(v[u]=-R,h=0;_>h;h++)m[h][u]=-m[h][u];break}if(w>=o-1)throw"Error: no convergence.";for(y=v[c],C=v[u-1],g=d[u-1],A=d[u],p=((C-R)*(C+R)+(g-A)*(g+A))/(2*A*C),g=e(p,1),p=0>p?((y-R)*(y+R)+A*(C/(p-g)-A))/y:((y-R)*(y+R)+A*(C/(p+g)-A))/y,s=1,S=1,a=c+1;u+1>a;a++){for(g=d[a],C=v[a],A=S*g,g=s*g,R=e(p,A),d[a-1]=R,s=p/R,S=A/R,p=y*s+g*S,g=-y*S+g*s,A=C*S,C*=s,h=0;_>h;h++)y=m[h][a-1],R=m[h][a],m[h][a-1]=y*s+R*S,m[h][a]=-y*S+R*s;for(R=e(p,A),v[a-1]=R,s=p/R,S=A/R,p=s*g+S*C,y=-S*g+s*C,h=0;f>h;h++)C=l[h][a-1],R=l[h][a],l[h][a-1]=C*s+R*S,l[h][a]=-C*S+R*s}d[c]=0,d[u]=p,v[u]=y}for(a=0;a<v.length;a++)v[a]<n&&(v[a]=0);for(a=0;_>a;a++)for(h=a-1;h>=0;h--)if(v[h]<v[a]){for(s=v[h],v[h]=v[a],v[a]=s,u=0;u<l.length;u++)r=l[u][a],l[u][a]=l[u][h],l[u][h]=r;for(u=0;u<m.length;u++)r=m[u][a],m[u][a]=m[u][h],m[u][h]=r;a=h}return{U:l,S:v,V:m}}return t}(),q=function(){"use strict";function e(t){if(void 0===t||null===t||"all"===t)return null;if("backbone"===t)return{CA:!0,C:!0,O:!0,N:!0};if(void 0!==t.substr){for(var e={},r=t.split(","),n=0;n<r.length;++n)e[r[n].trim()]=!0;return e}for(var e={},n=0;n<t.length;++n)e[t[n]]=!0;return e}function r(t,e,r,n,i){for(var o=t.atoms(),s=e.atoms(),a=0;a<o.length;++a){var h=o[a];if(null===i||i[h.name()]===!0)for(var u=0;u<s.length;++u){var c=s[u];if(c.name()===h.name()){r.push(h),n.push(c);break}}}}function n(t,n,i,o){for(var s=t.full().createEmptyView(),a=n.full().createEmptyView(),h=Math.min(t.chains().length,n.chains().length),u=e(i),c=0;h>c;++c){var l=t.chains()[c],f=n.chains()[c],_=o(l,f),d=_[0],v=_[1];if(d.length!==v.length)return null;for(var m=s.addChain(l),b=a.addChain(f),p=0;p<d.length;++p){var g=d[p],A=v[p],y=[],C=[];if(r(g,A,y,C,u),0!==y.length)for(var R=m.addResidue(g),S=b.addResidue(A),w=0;w<y.length;++w)R.addAtom(y[w]),S.addAtom(C[w])}}return[s,a]}function i(t,e,r){return n(t,e,r,function(t,e){return[t.residues(),e.residues()]})}function o(t,e,r){return n(t,e,r,function(t,e){for(var r=[],n=[],i=t.residues(),o=0;o<i.length;++o){var s=e.residueByRnum(i[o].num());null!==s&&(r.push(i[o]),n.push(s))}return[r,n]})}var s=t.vec3,a=t.mat3,h=(t.quat,function(t,e){if(s.set(e,0,0,0),0!==t.length){for(var r=0;r<t.length;++r){var n=t[r];s.add(e,e,n.pos())}s.scale(e,e,1/t.length)}}),u=function(){var t=s.create(),e=s.create();return function(r,n,i,o,a){a[0]=0,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=0,a[6]=0,a[7]=0,a[8]=0;for(var h=0;h<n.length;++h){s.sub(t,r[h].pos(),i),s.sub(e,n[h].pos(),o);var u=t,c=e;a[0]+=u[0]*c[0],a[1]+=u[0]*c[1],a[2]+=u[0]*c[2],a[3]+=u[1]*c[0],a[4]+=u[1]*c[1],a[5]+=u[1]*c[2],a[6]+=u[2]*c[0],a[7]+=u[2]*c[1],a[8]+=u[2]*c[2]}}}(),c=function(){var t=s.create(),e=s.create(),r=s.create(),n=a.create(),i=a.create(),o=a.create(),c=a.create(),l=a.create();return function(f,_){var d=f.atoms(),v=_.atoms();if(h(v,t),h(d,e),d.length!==v.length)return!1;if(d.length<3)return!1;u(d,v,e,t,i);var m=[[i[0],i[1],i[2]],[i[3],i[4],i[5]],[i[6],i[7],i[8]]],b=O(m);c[0]=b.U[0][0],c[1]=b.U[0][1],c[2]=b.U[0][2],c[3]=b.U[1][0],c[4]=b.U[1][1],c[5]=b.U[1][2],c[6]=b.U[2][0],c[7]=b.U[2][1],c[8]=b.U[2][2];var p=a.determinant(c);l[0]=b.V[0][0],l[1]=b.V[0][1],l[2]=b.V[0][2],l[3]=b.V[1][0],l[4]=b.V[1][1],l[5]=b.V[1][2],l[6]=b.V[2][0],l[7]=b.V[2][1],l[8]=b.V[2][2];var g=a.determinant(l);a.identity(o),0>p*g&&(o[8]=-1,a.mul(c,c,o)),a.mul(n,a.transpose(l,l),c);for(var A=f.full().atoms(),y=0;y<A.length;++y){var C=A[y];s.sub(r,C.pos(),e),s.transformMat3(r,r,n),s.add(r,t,r),C.setPos(r)}return!0}}();return{superpose:c,matchResiduesByNum:o,matchResiduesByIndex:i,parseAtomNames:e,addAtomsPresentInBoth:r}}(),B=K=function(e){"use strict";function r(t){for(var e=0;e<t.length();++e)s(t,e)?t.residueAt(e).setSS("H"):a(t,e)?t.residueAt(e).setSS("E"):t.residueAt(e).setSS("C")}function n(t){for(var e=t.chains(),n=0;n<e.length;++n){var i=e[n];i.eachBackboneTrace(r)}}var i=t.vec3,o=function(){var t=i.create(),e=i.create();return function(r,n,o,s){for(var a=Math.max(0,n-2);n>=a;++a)for(var h=2;5>h;++h)if(!(a+h>=r.length())){var u=i.dist(r.posAt(t,a),r.posAt(e,a+h));if(Math.abs(u-o[h-2])>s)return!1}return!0}}(),s=function(t,e){var r=[5.45,5.18,6.37],n=2.1;return o(t,e,r,n)},a=function(t,e){var r=[6.1,10.4,13],n=1.42;return o(t,e,r,n)};return{Mol:K.Mol,MolView:K.MolView,assignHelixSheet:n,superpose:e.superpose,matchResiduesByIndex:e.matchResiduesByIndex,matchResiduesByNum:e.matchResiduesByNum}}(q),U=function(e){"use strict";function r(){this._T={},this._1=null}function n(t){if(" "!==t[0]){var e=t.trim();if(4===e.length){for(var r=0,n=e.charCodeAt(r);4>r&&(65>n||n>122||n>90&&97>n);)++r,n=e.charCodeAt(r);return e[r]}var i=e.charCodeAt(0);return i>=48&&57>=i?e[1]:e.substr(0,2)}return t[1]}function i(t){this._cv=[],this._ce=[],this._cG=[],this._cg={},this._bS=!1,this._g=new K.Mol,this._cW=new r,this._bd=null,this._br=null,this._ew=null,this._={},this._.conectRecords=!!t.conectRecords}function o(t){return t.split(/\r\n|\r|\n/g)}function s(t,e){for(var r=e||{},n=o(t),s=new i(r),a=[],h=0;h<n.length;h++){var u=s.processLine(n[h]);if(u===s.ERROR)return null;if(u!==s.CONTINUE){var c=s.finish();if(null!==c&&a.push(c),u!==s.MODEL_COMPLETE||!r.loadAllModels)break}}var l=s.finish();return null!==l&&a.push(l),r.loadAllModels?a:a[0]}function a(){this._g=new K.Mol,this._bT(),this._bR=!1}function h(){this._g=new K.Mol,this._bT(),this._bR=!1}function u(t){for(var e=new a,r=o(t),n=0;n<r.length&&e.processLine(r[n]);n++);var i=e.finish();return i}function c(t){for(var e=new h,r=o(t),n=0;n<r.length&&e.processLine(r[n]);n++);var i=e.finish();return i}function l(t,e){var r=new XMLHttpRequest;r.open("GET",t,!0),r.onload=function(){r.response&&e(r.response)},r.send(null)}function f(t,e,r){l(t,function(t){var n=s(t,r);e(n)})}function _(t,e){l(t,function(t){var r=u(t);e(r)})}function d(t,e){l(t,function(t){var r=c(t);e(r)})}var v=t.vec3,m=t.mat4;return r.prototype={assemblies:function(){var t=[];for(var e in this._T)this._T.hasOwnProperty(e)&&t.push(this._T[e]);return t},assembly:function(t){return this._T[t]},nextLine:function(t){if(t=t.substr(11),"B"===t[0]&&"BIOMOLECULE:"===t.substr(0,12)){var r=t.substr(13).trim();return this._dy=new e.Assembly(r),void(this._T[r]=this._dy)}if("APPLY THE FOLLOWING TO CHAINS:"!==t.substr(0,30)&&"                   AND CHAINS:"!==t.substr(0,30)){if("  BIOMT"===t.substr(0,7)){for(var n=parseInt(t[7],10)-1,i=0;" "!==t[12+i];)i+=1;var o=parseFloat(t.substr(13+i,9)),s=parseFloat(t.substr(23+i,9)),a=parseFloat(t.substr(33+i,9)),h=parseFloat(t.substr(43+i,14));return this._bq[0+n]=o,this._bq[4+n]=s,this._bq[8+n]=a,this._bq[12+n]=h,void(2===n&&(this._cF.addMatrix(this._bq),this._bq=m.create()))}}else{var u=t.substr(30).split(",");"A"===t[0]&&(this._cF=new e.SymGenerator,this._dy.addGenerator(this._cF)),this._bq=m.create();for(var c=0;c<u.length;++c){var l=u[c].trim();l.length&&this._cF.addChain(l)}}}},i.prototype={CONTINUE:1,MODEL_COMPLETE:2,FILE_END:3,ERROR:4,parseHelixRecord:function(t){var e=parseInt(t.substr(21,4),10),r=" "===t[25]?"\0":t[25],n=parseInt(t.substr(33,4),10),i=" "===t[37]?"\0":t[37],o=t[19];return this._cv.push({first:[e,r],last:[n,i],chainName:o}),!0},parseRosettaAnnotation:function(t){if(t.length<5)return this.CONTINUE;var e=t[5],r=parseInt(t.substr(0,5).trim(),10);if(isNaN(r))return this.ERROR;var n="C";("H"===e||"E"===e)&&(n=e),1!==this._g.chains().length;var i=this._bd.residueByRnum(r);return null===i?this.CONTINUE:(i.setSS(n),this.CONTINUE)},parseSheetRecord:function(t){var e=parseInt(t.substr(22,4),10),r=" "===t[26]?"\0":t[26],n=parseInt(t.substr(33,4),10),i=" "===t[37]?"\0":t[37],o=t[21];return this._ce.push({first:[e,r],last:[n,i],chainName:o}),!0},parseAndAddAtom:function(t){var e=t[16];if(" "!==e&&"A"!==e)return!0;var r="H"===t[0],i=t[21],o=t.substr(17,3).trim(),s=t.substr(12,4),a=s.trim(),h=parseInt(t.substr(22,4),10);h!==h&&(h=1);var u=" "===t[26]?"\0":t[26],c=!1,l=!1;this._bd&&this._bd.name()===i||(l=!0,c=!0),this._br&&this._br.num()===h&&this._br.insCode()===u||(c=!0),l&&(this._bd=this._g.chain(i)||this._g.addChain(i)),c&&(this._br=this._bd.addResidue(o,h,u));for(var f=v.create(),_=0;3>_;++_)f[_]=parseFloat(t.substr(30+8*_,8));var d=t.substr(76,2).trim();""===d&&(d=n(s));var m=parseFloat(t.substr(54,6).trim()),b=parseFloat(t.substr(60,6).trim()),p=parseInt(t.substr(6,5).trim(),10),g=this._br.addAtom(a,f,d,r,isNaN(m)?null:m,isNaN(b)?null:b,p);return this._.conectRecords&&(this._cg[p]=g),!0},parseConectRecord:function(t){for(var e=parseInt(t.substr(6,5).trim(),10),r=[],n=0;4>n;++n){var i=parseInt(t.substr(11+5*n,6).trim(),10);isNaN(i)||i>e||r.push(i)}return this._cG.push({from:e,to:r}),!0},processLine:function(t){var e=t.substr(0,6);if("ATOM  "===e||"HETATM"===e)return this.parseAndAddAtom(t)?this.CONTINUE:this.ERROR;if("REMARK"===e){var r=t.substr(7,3);return"350"===r&&this._cW.nextLine(t),this.CONTINUE}return"HELIX "===e?this.parseHelixRecord(t)?this.CONTINUE:this.ERROR:"SHEET "===e?this.parseSheetRecord(t)?this.CONTINUE:this.ERROR:this._.conectRecords&&"CONECT"===e?this.parseConectRecord(t)?this.CONTINUE:this.ERROR:"END   "===e?this.FILE_END:"ENDMDL"===e?this.MODEL_COMPLETE:"complete:"===t.substr(0,9)?(this._bS=!0,this.CONTINUE):this._bS?0===t.trim().length?(this._bS=!1,this.CONTINUE):this.parseRosettaAnnotation(t):this.CONTINUE},finish:function(){if(null===this._bd)return null;var t,e=null;for(t=0;t<this._ce.length;++t){var r=this._ce[t];e=this._g.chain(r.chainName),e&&e.assignSS(r.first,r.last,"E")}for(t=0;t<this._cv.length;++t){var n=this._cv[t];e=this._g.chain(n.chainName),e&&e.assignSS(n.first,n.last,"H")}this._g.setAssemblies(this._cW.assemblies()),this._.conectRecords&&this._eE(this._g),this._g.deriveConnectivity();var i=this._g;return this._g=new K.Mol,this._bd=null,this._br=null,this._ew=null,this._bS=!1,i},_eE:function(t){for(var e=0;e<this._cG.length;++e)for(var r=this._cG[e],n=this._cg[r.from],i=0;i<r.to.length;++i){var o=this._cg[r.to[i]];t.connect(n,o)}}},a.prototype={processLine:function(t){var e=this._bf;if(3>e){if(0===e){var r=t.trim();if(0===r.length)return!1;this._cP=r}return this._bR=!1,this._bf++,!0}if(3===e){if(this._cB=parseInt(t.substr(0,3).trim(),10),this._dv=parseInt(t.substr(3,3).trim(),10),isNaN(this._cB)||isNaN(this._dv))return!1;this._bf++;var n=""+(this._g.chains().length+1);this._Q=this._g.addChain(n),this._P=this._Q.addResidue(this._cP,1)}if(4===e){for(var i=[0,0,0],o=0;3>o;++o)if(i[o]=parseFloat(t.substr(10*o,10).trim()),isNaN(i[o]))return!1;var s=t.substr(31,3).trim();this._P.addAtom(s,i,s,!1),this._dE++,this._dE===this._cB&&this._bf++}if(5===e){var a=parseInt(t.substr(0,3).trim(),10)-1,h=parseInt(t.substr(3,3).trim(),10)-1;if(isNaN(a)||isNaN(h))return!1;var u=this._P.atoms();this._g.connect(u[a],u[h]),this._dC++,this._dC===this._dv&&this._bf++}return"M  END"===t.substr(0,6)&&(this._bR=!0,this._bf++),"$$$$"===t.substr(0,4)&&this._bT(),!0},_bT:function(){this._bf=0,this._P=null,this._Q=null,this._cB=null,this._eT=null,this._dE=0,this._dC=0,this._cP=""},finish:function(){return this._bR?this._g:null}},h.prototype={processLine:function(t){if(0===t.length||"*"===t[0])return!0;if(t.length<52)return!0;for(var e=t.substr(16,5),r=parseInt(t.substr(6,4).trim(),10),n=t.substr(11,3).trim(),i=v.create(),o=0;3>o;++o)i[o]=parseFloat(t.substr(20+10*o,10).trim());var s=t[51];return(null===this._Q||this._Q.name()!==s)&&(this._P=null,this._Q=this._g.chain(s),null===this._Q&&(this._Q=this._g.addChain(s))),(null===this._P||this._P.num()!==r)&&(this._P=this._Q.addResidue(n,r)),this._P.addAtom(e.trim(),i,e[0],!1,1,0),!0},_bT:function(){this._P=null,this._Q=null},finish:function(){return this._g.deriveConnectivity(),this._g}},{pdb:s,sdf:u,crd:c,Remark350Reader:r,fetchPdb:f,fetchSdf:_,fetchCrd:d,guessAtomElementFromName:n}}(M),k=function(){"use strict";var e=t.vec3,r=t.mat3,n=function(){var t=e.create(),r=e.create();return function(n,i){e.set(t,0,0,0);var o=0;n.eachCentralAtom(function(r,n){e.add(t,t,n),o+=1}),0!==o&&(e.scale(t,t,1/o),i[0]=0,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=0,i[6]=0,i[7]=0,i[8]=0,n.eachCentralAtom(function(n,o){e.sub(r,o,t);var s=r[0],a=r[1],h=r[2];i[0]+=a*a+h*h,i[1]-=s*a,i[2]-=s*h,i[5]-=a*h,i[4]+=s*s+h*h,i[8]+=s*s+a*a}),i[3]=i[1],i[6]=i[2],i[7]=i[5])}}(),i=function(){var t=r.create(),i=r.create(),o=e.create(),s=e.create(),a=e.create(),h=e.create(),u=e.create(),c=e.create(),f=e.create();return function(_){n(_,t);var d=l.diagonalizer(t);r.fromQuat(i,d);var v=!0;_.eachCentralAtom(function(t,r){e.transformMat3(a,r,i),v?(e.copy(o,a),e.copy(s,a),v=!1):(e.min(o,o,a),e.max(s,s,a))}),e.sub(h,s,o);var m=[[h[0],0],[h[1],1],[h[2],2]];m.sort(function(t,e){return e[0]-t[0]});var b=m[0][1],p=m[1][1];e.set(u,i[b+0],i[b+3],i[b+6]),e.set(c,i[p+0],i[p+3],i[p+6]),e.cross(f,u,c);var g=r.create();return g[0]=u[0],g[1]=c[0],g[2]=f[0],g[3]=u[1],g[4]=c[1],g[5]=f[1],g[6]=u[2],g[7]=c[2],g[8]=f[2],g}}();return{principalAxes:i}}(),z=function(){"use strict";function e(t){this._g=t,this._dn=[]}function r(t,r){var n=new e(t),i=String.fromCharCode(r.getUint8(4))+String.fromCharCode(r.getUint8(5))+String.fromCharCode(r.getUint8(6))+String.fromCharCode(r.getUint8(7)),o="DROC"===i,s=92,a=r.getUint32(s,o);s+=4;var h,u="";for(h=0;a>h;++h)u+=String.fromCharCode(r.getUint8(s)),
s+=1;var c=r.getUint32(8,o),l=r.getUint32(84,o),f=!1;0!==l&&(f=0!==r.getUint32(48,o)),s+=8;var _=r.getUint32(s,o);for(s+=8,h=0;c>h;++h){var d=new Float32Array(3*_);f&&(s+=56);for(var v=0;3>v;++v){s+=4;for(var m=0;_>m;++m){var b=r.getFloat32(s,o);d[3*m+v]=b,s+=4}s+=4}n.addFrame(d)}return n}function n(t,e){var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(){r.response&&e(new DataView(r.response))},r.send(null)}function i(t,e,i){n(t,function(t){var n=r(e,t);i(n)})}var o=t.vec3;return e.prototype={addFrame:function(t){this._dn.push(t)},useFrame:function(t){var e=this._dn[t];this._g.eachAtom(function(t,r){var n=3*r;o.set(t.pos(),e[n+0],e[n+1],e[n+2])})}},{CoordGroup:e,fetchDcd:i}}(),j=function(){"use strict";return{Viewer:T.Viewer,isWebGLSupported:T.isWebGLSupported,io:U,traj:z,color:e,mol:K,rgb:{setColorPalette:e.setColorPalette,hex2rgb:e.hex2rgb},vec3:t.vec3,vec4:t.vec4,mat3:t.mat3,mat4:t.mat4,quat:t.quat,viewpoint:k}}()})}})});
//# sourceMappingURL=pv_viewer.js.map